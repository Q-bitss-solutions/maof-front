import{I as h}from"./InputBase-76d53701.js";import{B as V}from"./fetchApi-f7a148df.js";import{S as w}from"./SelectBase-00d6335c.js";import{f as y}from"./resident-ef81afaf.js";import{f as F}from"./contract-5e7c25e1.js";import{_ as B}from"./PDF-a4bdfbbc.js";import{_ as x,m as U,b as g,o as b,c as v,e as d,d as c,t as k,h as N}from"./index-0101a678.js";const A={name:"FormAssignResident",props:{editMode:{type:Boolean,default:!1},assingResident:{type:Object,default:()=>({})}},components:{InputBase:h,ButtonBase:V,SelectBase:w},setup(p,{emit:n}){const i=U({assingResident:{id_contrato:"",id_residente:"",fecha_inicio_asignacion:"",archivo_asignacion:""},fileName:"",fileURl:"",listResident:[],listContract:[]});let e=new FormData;p.editMode&&(i.assingResident=p.assingResident,i.fileURl=i.assingResident.archivo_asignacion,i.fileName=i.assingResident.archivo_asignacion.split("/"),delete i.assingResident.archivo_asignacion,e.append("id_contrato",i.assingResident.id_contrato),e.append("id_residente",i.assingResident.id_residente),e.append("fecha_inicio_asignacion",i.assingResident.fecha_inicio_asignacion));const R=async()=>{e.append("id_contrato",i.assingResident.id_contrato),e.append("id_residente",i.assingResident.id_residente),e.append("fecha_inicio_asignacion",i.assingResident.fecha_inicio_asignacion),n("submit",e)},_=async()=>{const{data:a}=await F();i.listContract=a.map(s=>({value:s.id_contrato,label:s.numero_contrato,idAreaRevisora:s.id_area_revisora})),i.listContract.sort((s,o)=>s.label>o.label?1:s.label<o.label?-1:0),t()},t=async()=>{let a={},s={};const o=i.listContract.filter(f=>f.value==i.assingResident.id_contrato);if(o.length>0){s=o[0];const{idAreaRevisora:f}=s;a={id_area_revisora:f};const{data:C}=await y(a);i.listResident=C.map(l=>({value:l.id_residente,label:l.nombre_completo})),i.listResident.sort((l,u)=>l.label>u.label?1:l.label<u.label?-1:0)}},r=a=>{e.append("archivo_asignacion",a.target.files[0])},m=async()=>{window.open(`${i.fileURl}`,"_blank")};return _(),{app:i,formData:e,sendForm:R,getContracts:_,getResident:t,fileUpload:r,downloadFile:m}}},D={class:"max-w-xl mx-auto"},M={key:0,class:"flex flex-row justify-end"};function S(p,n,i,e,R,_){const t=g("select-base"),r=g("input-base"),m=g("button-base");return b(),v("div",D,[d(t,{id:"id_contrato",label:"Contrato",options:e.app.listContract,modelValue:e.app.assingResident.id_contrato,"onUpdate:modelValue":n[0]||(n[0]=a=>e.app.assingResident.id_contrato=a),class:"mb-3",onChange:n[1]||(n[1]=a=>e.getResident(e.app.assingResident.id_contrato))},null,8,["options","modelValue"]),d(t,{id:"id_residente",label:"Residente",options:e.app.listResident,class:"mb-3",modelValue:e.app.assingResident.id_residente,"onUpdate:modelValue":n[2]||(n[2]=a=>e.app.assingResident.id_residente=a)},null,8,["options","modelValue"]),d(r,{id:"fecha_inicio_asignacion",label:"Fecha de asignación del Residente",type:"date",class:"mb-3",modelValue:e.app.assingResident.fecha_inicio_asignacion,"onUpdate:modelValue":n[3]||(n[3]=a=>e.app.assingResident.fecha_inicio_asignacion=a)},null,8,["modelValue"]),c("div",null,[c("div",null,[d(r,{id:"archivo_asignacion",label:"Carga oficio de designación",type:"file",class:"mb-3",accept:"application/pdf",onChange:e.fileUpload},null,8,["onChange"])]),i.editMode===!0?(b(),v("div",M,[c("span",null,k(e.app.fileName[5]),1),c("img",{src:B,class:"w-12 h-12",onClick:n[4]||(n[4]=(...a)=>e.downloadFile&&e.downloadFile(...a))})])):N("",!0)]),d(m,{label:"Guardar",onClick:e.sendForm,class:"mr-0 ml-auto"},null,8,["onClick"])])}const H=x(A,[["render",S]]);export{H as F};
