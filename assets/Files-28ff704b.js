import{F as q}from"./FormResident-f81aeea2.js";import{A as V}from"./ArrowBack-d9027e34.js";import{T as U}from"./TitleBar-4aceab6d.js";import{I as L}from"./InputBase-76d53701.js";import{T as Y}from"./TableBase-0bea4fd3.js";import{B as H}from"./fetchApi-f7a148df.js";import{L as J}from"./LogoutComponent-16cf5774.js";import{f as K,g as M,h as Q,i as W}from"./residentEstimate-9627171c.js";import{_ as k,o as f,c as p,d as i,t as A,q as X,u as Z,a as $,m as ee,r as n,b as m,e as r,g as te,h as y}from"./index-0101a678.js";import{S as c}from"./sweetalert2.all-281a79b7.js";import"./SelectBase-00d6335c.js";import"./reviewArea-b6ba2221.js";import"./users-6acb5469.js";const ae={name:"Banner",props:{title:{type:String,default:""}}},ie={class:"relative isolate flex-1 items-center gap-x-6 overflow-hidden bg-gray-50 px-4 py-1.5 sm:px-2.5 sm:before:flex"},oe=i("div",{class:"absolute left-[max(-7rem,calc(50%-52rem))] top-1/2 -z-10 -translate-y-1/2 transform-gpu blur-2xl","aria-hidden":"true"},[i("div",{class:"aspect-[577/310] w-[36.0625rem] bg-gradient-to-r from-[#808080] to-[#808080] opacity-30",style:{"clip-path":"polygon(74.8% 41.9%, 97.2% 73.2%, 100% 34.9%, 92.5% 0.4%, 87.5% 0%, 75% 28.6%, 58.5% 54.6%, 50.1% 56.8%, 46.9% 44%, 48.3% 17.4%, 24.7% 53.9%, 0% 27.9%, 11.9% 74.2%, 24.9% 54.1%, 68.6% 100%, 74.8% 41.9%)"}})],-1),se=i("div",{class:"absolute left-[max(45rem,calc(50%+8rem))] top-1/2 -z-10 -translate-y-1/2 transform-gpu blur-2xl","aria-hidden":"true"},[i("div",{class:"aspect-[577/310] w-[36.0625rem] bg-gradient-to-r from-[#808080] to-[#808080] opacity-30",style:{"clip-path":"polygon(74.8% 41.9%, 97.2% 73.2%, 100% 34.9%, 92.5% 0.4%, 87.5% 0%, 75% 28.6%, 58.5% 54.6%, 50.1% 56.8%, 46.9% 44%, 48.3% 17.4%, 24.7% 53.9%, 0% 27.9%, 11.9% 74.2%, 24.9% 54.1%, 68.6% 100%, 74.8% 41.9%)"}})],-1),ne={class:"text-3xl text-center"};function re(O,_,w,e,a,x){return f(),p("div",ie,[oe,se,i("div",null,[i("h2",ne,A(w.title),1)])])}const le=k(ae,[["render",re]]),ce={name:"FilesResidentEstimate",components:{FormResident:q,ArrowBack:V,TitleBar:U,InputBase:L,TableBase:Y,ButtonBase:H,Banner:le,LogoutComponent:J},setup(){const O=X(),_=Z(),w=$(),e=[{label:"Id",field:"id_archivo_estimacion"},{label:"Nombre archivo",field:"ruta_archivo_residente"},{label:"Descripción",field:"descripcion_archivo"}],a=ee({file:{id_estimacion:"",file:"",descripcionFile:""},data:{},filesById:[],loading:!0,filesResidente:[],filesAreaRevisora:[],filesFinanzas:[],filesDGPOP:[]}),x=n([]),R=n([]),E=n([]),B=n([]),F=n([]),{rol:o}=w.getAuthData,d=n([]),u=n(!1),v=n(!1),h=n(!1),b=n(!1),z=n([]),P=async()=>{a.loading=!0;const{data:t}=await K(O.params.residentEstimateId);a.data=t,a.file.id_estimacion=t.id_estimacion,g.append("id_estimacion",a.file.id_estimacion),a.loading=!1,d.value=C(a.data.estatus_semaforo),S(),z.value=j(a.data.estatus_estimacion),D()},D=async()=>{const{data:t}=await M(a.file.id_estimacion);x.value=t,t.residente&&(R.value=t.residente),t.area_Revisora&&(E.value=t.area_Revisora),t.finanzas&&(B.value=t.finanzas),t.dgpop&&(F.value=t.dgpop)},N=async t=>{await updateResident(t),c.fire("¡Éxito!","Residente actualizado con éxito!","success"),_.push({name:"Resident"})};let g=new FormData;const I=async()=>{try{const{value:t}=await c.fire({title:"Subir Archivo",input:"file",showCancelButton:!0,reverseButtons:!0,inputAttributes:{accept:"application/pdf","aria-label":"Upload your profile picture"}});if(t!=null){const{value:s}=await c.fire({title:"Descripción del archivo",input:"text",showCancelButton:!0,reverseButtons:!0,inputValidator:l=>{if(!l)return"El campo es requerido"}});if(s!==void 0){a.file.descripcionFile=s,a.file.file=t,g.append("archivo_estimacion ",a.file.file),g.append("descripcion_archivo ",a.file.descripcionFile);try{await Q(g),D(),c.fire("¡Éxito!","!Archivo guardado con éxito!","success"),a.file.file="",a.file.descripcionFile=""}catch(l){c.fire("Error",`${l.response.data.detail}`,"error")}}}else t===null&&c.fire("No selesccionaste ningun archivo","Agrega uno para continuar","warning")}catch{}},C=t=>{var s=!1;return t==="Residente"&&o=="Residente"&&(s=!0),t==="Area Revisora"&&o.includes("Área revisora")&&(s=!0),(t==="Finanzas"||t==="DGPOP")&&o.includes("Finanzas")&&(s=!0),s},S=()=>{o=="Residente"&&(u.value=!0,v.value=!1,h.value=!1,b.value=!1),o.includes("Área revisora")&&(u.value=!1,v.value=!0,h.value=!1,b.value=!1),o.includes("Finanzas")&&(u.value=!1,v.value=!1,h.value=!0,b.value=!0)},j=t=>{var s=null;return t==="Pagada"?(u.value=!0,v.value=!0,h.value=!0,b.value=!0,s=[{label:"Descargar",action:async l=>{window.open(`${l.archivo_estimacion}`,"_blank")}}]):s=[{label:"Descargar",action:async l=>{window.open(`${l.archivo_estimacion}`,"_blank")}},{label:"Eliminar",action:async l=>{console.log("files: ",l),c.fire({title:"¿Estás seguro que desea eliminar el documento?",text:"Esto quitará el documento",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Si, Eliminar!",reverseButtons:!0}).then(async G=>{if(G.isConfirmed)try{await W(l.id_archivo_estimacion),await D(),c.fire("Eliminado!","El documento se eliminó","success")}catch(T){c.fire("Error",`${T.response.data.detail}`,"error")}})}}],s};return P(),{app:a,filesById:x,saveResident:N,featureOptions:z,formData:g,headers:e,fileUpload:I,filesResidente:R,filesAreaRevisora:E,filesDGPOP:F,filesFinanzas:B,canAddNew:d,canEditResidente:u,canEditAreaRevisora:v,canEditFinanzas:h,canEditPago:b}}},de={class:"px-4 mt-10"},fe={class:"flex justify-between"},ue={class:"px-4"},me={class:"flex flex-row justify-between"},pe={class:"font-bold text-lg"},_e={class:"font-bold text-lg w-128 text-center"},ve={class:"flex content-start justify-end items-center mb-10"},he={class:"items-center justify-center"},be=i("h1",{class:"font-bold text-lg text-center"}," Número de la Estimación ",-1),ge={class:"text-center font-semibold text-lg numEstimacion"},ye={key:1,class:"flex flex-col py-px"},we={key:2},xe={key:3},Re={key:4};function Ee(O,_,w,e,a,x){const R=m("arrow-back"),E=m("logout-component"),B=m("title-bar"),F=m("button-base"),o=m("banner"),d=m("table-base");return f(),p("main",de,[i("div",fe,[r(R),r(E)]),r(B,{title:"Estimación Residente",subtitle:"Archivos"}),i("section",ue,[i("div",me,[i("div",pe,A(e.app.data.numero_contrato),1),i("div",_e," Objeto: "+A(e.app.data.objeto_contrato),1),i("div",ve,[i("div",he,[be,i("p",ge,A(e.app.data.num_consecutivo_estimacion),1)])])]),e.canAddNew?(f(),te(F,{key:0,label:"Nuevo",onClick:_[0]||(_[0]=u=>e.fileUpload()),class:"mr-0 ml-auto mb-5"})):y("",!0),e.filesResidente.length?(f(),p("div",ye,[r(o,{title:"Documentos de Residente"}),r(d,{options:e.featureOptions,headers:e.headers,data:e.filesResidente,showOptions:e.canEditResidente,tableName:"residente"},null,8,["options","headers","data","showOptions"])])):y("",!0),e.filesAreaRevisora.length?(f(),p("div",we,[r(o,{title:"Documentos de Área Revisora"}),r(d,{options:e.featureOptions,headers:e.headers,data:e.filesAreaRevisora,showOptions:e.canEditAreaRevisora,tableName:"area-revisora"},null,8,["options","headers","data","showOptions"])])):y("",!0),e.filesFinanzas.length?(f(),p("div",xe,[r(o,{title:"Documentos de Finanzas"}),r(d,{options:e.featureOptions,headers:e.headers,data:e.filesFinanzas,showOptions:e.canEditFinanzas,tableName:"finanzas"},null,8,["options","headers","data","showOptions"])])):y("",!0),e.filesDGPOP.length?(f(),p("div",Re,[r(o,{title:"Documentos de Registro de Pago"}),r(d,{options:e.featureOptions,headers:e.headers,data:e.filesDGPOP,showOptions:e.canEditPago,tableName:"pago"},null,8,["options","headers","data","showOptions"])])):y("",!0)])])}const Ge=k(ce,[["render",Ee]]);export{Ge as default};
