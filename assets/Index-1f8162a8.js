import{T as G}from"./TableUsers-1250f953.js";import{A as H}from"./ArrowBack-d9027e34.js";import{H as J}from"./HomePage-dc81efef.js";import{S as E}from"./SelectBase-00d6335c.js";import{B as k,a as P}from"./fetchApi-f7a148df.js";import{_ as A,m as K,s as M,b,o as _,c as g,e as c,d as n,F as I,f as S,t as x,h as V,g as B,n as Q,u as W,r as U}from"./index-0101a678.js";import{T as X}from"./TitleBar-4aceab6d.js";import{I as Y}from"./InputBase-76d53701.js";import{f as j}from"./contract-5e7c25e1.js";import{f as Z}from"./resident-ef81afaf.js";import{a as $}from"./SICTUnits-3f505476.js";import{k as ee}from"./residentEstimate-9627171c.js";import{S as D}from"./sweetalert2.all-281a79b7.js";import{u as te,c as w,a as T}from"./index-44a73b62.js";import{b as ae}from"./project-b898753b.js";import{c as oe}from"./consultas-33221ba2.js";import{L as se}from"./LogoutComponent-16cf5774.js";const le={name:"FormProject",props:{editMode:{type:Boolean,default:!1},project:{type:Object,default:()=>({})}},components:{InputBase:Y,ButtonBase:k,SelectBase:E},setup(f,{emit:o}){const e=K({busqueda:{id_contrato:"",id_residente:"",mes_estimacion:"",año_estimacion:"",estatus_estimacion:"",unidad_maof:"",dias_transcurridos:[],fechas_autorizacion:[]},listMesEstimacion:[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiempbre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}],diasInicio:"",diasFin:"",fechaInicio:"",fechaFin:"",listAnios:[],listC_CC_CM:[],listResident:[],listUnitMAOF:[],listStatusEstimate:[]}),a=M(()=>({diasFin:{minValue:w.withMessage("El valor mínimo es 1",T(1)),customValidation:w.withMessage("El valor de días inicio debe ser menor que días fin",d=>e.diasInicio!==""&&e.diasFin!==""?e.diasInicio<e.diasFin:!0)},diasInicio:{minValue:w.withMessage("El valor mínimo es 0",T(0)),customValidation:w.withMessage("El valor de días inicio debe ser menor que días fin",d=>e.diasInicio!==""&&e.diasFin!==""?e.diasInicio<e.diasFin:!0)}})),v=te(a,e),h=M(()=>{const{id_contrato:d,id_residente:t,mes_estimacion:l,año_estimacion:i,estatus_estimacion:u,unidad_maof:y}=e.busqueda,{diasInicio:C,diasFin:N,fechaInicio:z,fechaFin:L}=e;return!d&&!t&&!l&&!i&&!u&&!y&&!C&&!N&&!z&&!L}),r=async()=>{const{data:d}=await j();e.listC_CC_CM=d.map(t=>({value:t.id_contrato,label:t.numero_contrato})),e.listC_CC_CM.sort((t,l)=>t.label>l.label?1:t.label<l.label?-1:0)},m=async()=>{const{data:d}=await Z();e.listResident=d.map(t=>({value:t.id_residente,label:t.nombre_completo})),e.listResident.sort((t,l)=>t.label>l.label?1:t.label<l.label?-1:0)},p=async()=>{const{data:d}=await $();e.listUnitMAOF=d.map(t=>({value:t.id_unidad_maof,label:t.unidad})),e.listUnitMAOF.sort((t,l)=>t.label>l.label?1:t.label<l.label?-1:0)},s=async()=>{const{data:d}=await ee();e.listStatusEstimate=d.map(t=>({value:t.clave_estatus_estimacion,label:t.estatus_estimacion})),e.listStatusEstimate.sort((t,l)=>t.label>l.label?1:t.label<l.label?-1:0)},F=d=>{for(let t=0;t<d;t++)e.listAnios.push({value:2023+t,label:`${2023+t}`})},q=async()=>{if(await v.value.$validate())e.diasInicio!==""&&(e.busqueda.dias_transcurridos.push(e.diasInicio),e.diasInicio=""),e.diasFin!==""&&(e.busqueda.dias_transcurridos.push(e.diasFin),e.diasFin=""),e.fechaInicio!==""&&(e.busqueda.fechas_autorizacion.push(e.fechaInicio),e.fechaInicio=""),e.fechaFin!==""&&(e.busqueda.fechas_autorizacion.push(e.fechaFin),e.fechaFin=""),o("submit",e.busqueda);else{let t="";v.value.$errors.forEach(l=>{t=l.$message}),D.fire("¡Error!",`${t}`,"error")}};return r(),m(),p(),s(),F(10),{app:e,isFormEmpty:h,v$:v,sendForm:q,getC_CC_CM:r,getResident:m,getUnitMAOF:p,getStatusEstimate:s,generateAnios:F}}},ie={class:"max-w-6xl pb-10 grow"},ne=n("p",{class:"w-[17rem]"},"*Contrato, Convenio de Colaboración, Convenio Modificatorio",-1),re={class:"grid grid-cols-2"},de={class:"grid"},ue={class:"grid grid-cols-2 pt-3"};function ce(f,o,e,a,v,h){const r=b("select-base"),m=b("input-base"),p=b("button-base");return _(),g("div",ie,[ne,c(r,{id:"clave_cartera",label:"C, CC, CM*",options:a.app.listC_CC_CM,class:"mb-3",modelValue:a.app.busqueda.id_contrato,"onUpdate:modelValue":o[0]||(o[0]=s=>a.app.busqueda.id_contrato=s)},null,8,["options","modelValue"]),c(r,{id:"nombre_proyecto",label:"Residente",options:a.app.listResident,class:"mb-3",modelValue:a.app.busqueda.id_residente,"onUpdate:modelValue":o[1]||(o[1]=s=>a.app.busqueda.id_residente=s)},null,8,["options","modelValue"]),c(r,{id:"nombre_proyecto",label:"Mes de la Estimación",options:a.app.listMesEstimacion,class:"mb-3",modelValue:a.app.busqueda.mes_estimacion,"onUpdate:modelValue":o[2]||(o[2]=s=>a.app.busqueda.mes_estimacion=s)},null,8,["options","modelValue"]),c(r,{id:"nombre_proyecto",label:"Año de la Estimación",options:a.app.listAnios,class:"mb-3",modelValue:a.app.busqueda.año_estimacion,"onUpdate:modelValue":o[3]||(o[3]=s=>a.app.busqueda.año_estimacion=s)},null,8,["options","modelValue"]),c(r,{id:"nombre_proyecto",label:"Estatus de la Estimación",class:"mb-3",options:a.app.listStatusEstimate,modelValue:a.app.busqueda.estatus_estimacion,"onUpdate:modelValue":o[4]||(o[4]=s=>a.app.busqueda.estatus_estimacion=s)},null,8,["options","modelValue"]),c(r,{id:"nombre_proyecto",label:"Unidad MAOF responsable",options:a.app.listUnitMAOF,class:"mb-3",modelValue:a.app.busqueda.unidad_maof,"onUpdate:modelValue":o[5]||(o[5]=s=>a.app.busqueda.unidad_maof=s)},null,8,["options","modelValue"]),n("div",re,[c(m,{id:"dias_inicio",label:"Días transcurridos del",type:"number",class:"grow",modelValue:a.app.diasInicio,"onUpdate:modelValue":o[6]||(o[6]=s=>a.app.diasInicio=s)},null,8,["modelValue"]),c(m,{id:"dias_fin",label:"al",type:"number",class:"flex-auto",modelValue:a.app.diasFin,"onUpdate:modelValue":o[7]||(o[7]=s=>a.app.diasFin=s)},null,8,["modelValue"])]),n("div",de,[a.v$.diasInicio.$error?(_(!0),g(I,{key:0},S(a.v$.diasInicio.$errors,s=>(_(),g("span",{key:s,class:"text-red font-semibold text-center ml-80"},x(s.$message),1))),128)):V("",!0),a.v$.diasFin.$error?(_(!0),g(I,{key:1},S(a.v$.diasFin.$errors,s=>(_(),g("span",{key:s,class:"text-red font-semibold text-center ml-80"},x(s.$message),1))),128)):V("",!0)]),n("div",ue,[c(m,{id:"fecha_inicio",label:"Autorización entre",type:"date",class:"grow",modelValue:a.app.fechaInicio,"onUpdate:modelValue":o[8]||(o[8]=s=>a.app.fechaInicio=s)},null,8,["modelValue"]),c(m,{id:"fecha_fin",label:"y",type:"date",class:"",modelValue:a.app.fechaFin,"onUpdate:modelValue":o[9]||(o[9]=s=>a.app.fechaFin=s)},null,8,["modelValue"])]),c(p,{label:"Buscar",onClick:a.sendForm,class:"mr-0 ml-auto mt-5",disabled:a.isFormEmpty},null,8,["onClick","disabled"])])}const R=A(le,[["render",ce]]),O=f=>P({url:"/agenda_estimacion/filtros/",method:"GET",params:f||{}}),me=f=>P({url:"/agenda_estimacion/busqueda/",method:"GET",params:f||{}}),fe="/maof-front/assets/Filter-fb6d2bbc.png";const pe={props:{filtro:{type:Object,required:!0},getDocsByType:{type:Function,required:!0},saveFiltro:{type:Function,required:!0},esperandoAccion:{type:Function,required:!1}},components:{SelectBase:E,ButtonBase:k}},be={class:"flex justify-start items-center pb-10"},_e=n("img",{src:fe,alt:"filter",class:"w-10 items-center"},null,-1);function ve(f,o,e,a,v,h){const r=b("select-base"),m=b("button-base");return _(),g("div",be,[_e,c(r,{label:"Filtros",class:"text-center w-48 mr-10",id:"filtros",options:e.filtro.listFiltros,modelValue:e.filtro.tipoDocumento,"onUpdate:modelValue":o[0]||(o[0]=p=>e.filtro.tipoDocumento=p),onChange:o[1]||(o[1]=p=>e.getDocsByType(e.filtro.tipoDocumento))},null,8,["options","modelValue"]),e.filtro.listDocsFiltrados!==""&&e.filtro.tipoDocumento!==""?(_(),B(r,{key:0,label:"",class:"text-center w-48 ml-36",id:"filtrosDocs",options:e.filtro.listDocsFiltrados,modelValue:e.filtro.filtroDocValue,"onUpdate:modelValue":o[2]||(o[2]=p=>e.filtro.filtroDocValue=p)},null,8,["options","modelValue"])):V("",!0),e.filtro.listDocsFiltrados!==""&&e.filtro.tipoDocumento!==""?(_(),B(m,{key:1,label:"Aplicar",class:Q(["border-gray text-black hover:bg-white hover:text-red",{"ml-[36rem]":e.filtro.tipoDocumento==="1"," ml-[3.7rem]":e.filtro.tipoDocumento!=="1"&&e.filtro.filtroDocValue===""," ml-[0rem]":e.filtro.tipoDocumento!=="1"&&e.filtro.filtroDocValue!==""}]),onClick:o[3]||(o[3]=p=>e.saveFiltro(e.filtro.filtroDocValue,e.filtro.tipoDocumento)),disabled:e.filtro.filtroDocValue===""},null,8,["class","disabled"])):V("",!0),e.filtro.tipoDocumento==="4"?(_(),B(m,{key:2,label:"Aplicar",class:"ml-40 border-gray text-black hover:bg-white hover:text-red",onClick:o[4]||(o[4]=p=>e.esperandoAccion())})):V("",!0)])}const ge=A(pe,[["render",ve]]),ye="/maof-front/assets/Search-94489079.png",he={components:{ButtonBase:k,FormConsultaBusqueda:R},props:{showBusquedaValue:{type:Boolean,required:!0},showBusqueda:{type:Function,required:!0},saveBusqueda:{type:Function,required:!0}}},Fe={class:"flex justify-start items-center pt-10"},Ve=n("img",{src:ye,alt:"filter",class:"w-10 items-center"},null,-1),qe=n("h1",{class:"text-center font-bold text-lg"},"Búsqueda",-1),Ce={class:"flex justify-center"};function xe(f,o,e,a,v,h){const r=b("button-base"),m=b("form-consulta-busqueda");return _(),g(I,null,[n("div",Fe,[Ve,qe,c(r,{label:"Criterio de búsqueda",class:"ml-5 border-gray text-black hover:bg-white hover:text-red",onClick:e.showBusqueda},null,8,["onClick"])]),n("div",Ce,[e.showBusquedaValue?(_(),B(m,{key:0,onSubmit:e.saveBusqueda,class:"mt-20"},null,8,["onSubmit"])):V("",!0)])],64)}const we=A(he,[["render",xe]]);const Be={name:"UsersRolesMAOFIndex",components:{TableBase:G,ArrowBack:H,HomePage:J,ButtonBase:k,TitleBar:X,SelectBase:E,FormConsultaBusqueda:R,Filtro:ge,Busqueda:we,LogoutComponent:se},setup(){const f=W(),o=oe(),e=U({filtro:{tipoDocumento:"",listFiltros:[{value:2,label:"Contrato o Convenio de Colaboración"},{value:3,label:"Convenio Modificatorio"},{value:1,label:"Proyecto / Cartera de inversión"}],listDocsFiltrados:[],filtroDocValue:"",data:{pendientes:[],pagados:[],totales:[]}},loading:!0});let a=U(!1);const v=(t,l)=>{switch(l){case"pendientes":t.length>0?(o.addPendientes(t),f.push({name:"ConsultasPedientesMAOF"})):D.fire("No hay estimaciones","Intenta con otro filtro","warning");break;case"pagadas":t.length>0?(o.addPagados(t),f.push({name:"ConsultasPagadosMAOF"})):D.fire("No hay estimaciones","Intenta con otro filtro","warning");break;case"totales":t.length>0?(o.addTotal(t),f.push({name:"ConsultasTotalesMAOF"})):D.fire("No hay estimaciones","Intenta con otro filtro","warning");break;default:console.log("opcion invalida");break}},h=async t=>{switch(a.value===!0&&(a.value=!1),t){case"1":e.value.filtro.listDocsFiltrados=[],e.value.filtro.filtroDocValue="",r();break;case"2":e.value.filtro.listDocsFiltrados=[],e.value.filtro.filtroDocValue="",m(t);break;case"3":e.value.filtro.listDocsFiltrados=[],e.value.filtro.filtroDocValue="",m(t);break;case"4":e.value.filtro.listDocsFiltrados=[],e.value.filtro.filtroDocValue="";break;default:console.log("No se encontro nada");break}},r=async()=>{const{data:t}=await ae();e.value.filtro.listDocsFiltrados=t.map(l=>({value:l.id_proyecto,label:`${l.clave_cartera}-${l.nombre_proyecto}`}))},m=async t=>{const{data:l}=await j();t==="2"&&(l.forEach(i=>{i.id_tipo_contrato!==3&&e.value.filtro.listDocsFiltrados.push({value:i.id_contrato,label:i.numero_contrato})}),e.value.filtro.listDocsFiltrados.sort((i,u)=>i.label>u.label?1:i.label<u.label?-1:0)),t==="3"&&(l.forEach(i=>{i.id_tipo_contrato===3&&e.value.filtro.listDocsFiltrados.push({value:i.id_contrato,label:i.numero_contrato})}),e.value.filtro.listDocsFiltrados.sort((i,u)=>i.label>u.label?1:i.label<u.label?-1:0))},p=()=>{e.value.filtro.tipoDocumento="",e.value.filtro.filtroDocValue="",a.value=!a.value},s=(t,l,i)=>{o.addPendientes(t),o.addPagados(l),o.addTotal(i)},F=async()=>{e.value.loading=!0;const{data:t}=await O();e.value.filtro.data.totales=t.total,e.value.filtro.data.pagados=t.pagadas,e.value.filtro.data.pendientes=t.pendiente,s(t.pendiente,t.pagadas,t.total),e.value.loading=!1},q=async t=>{const l=Object.entries(t).filter(([u,y])=>Array.isArray(y)?y.length>0:y!=="").reduce((u,[y,C])=>(Array.isArray(C)?u[y]=C.join(","):u[y]=C,u),{}),{data:i}=await me(l);o.addBusqueda(i),f.push({name:"ConsultasBusquedaMAOF"})},d=async(t,l)=>{e.value.loading=!0;let i={};l==="1"?i={id_proyecto:t}:(l==="2"||l==="3")&&(i={id_contrato:t});const{data:u}=await O(i);e.value.filtro.data.totales=u.total,e.value.filtro.data.pagados=u.pagadas,e.value.filtro.data.pendientes=u.pendiente,s(u.pendiente,u.pagadas,u.total),e.value.loading=!1};return F(),{app:e,showBusquedaValue:a,getStatusEstimations:v,showBusqueda:p,saveBusqueda:q,saveFiltro:d,getDocsByType:h,getProjects:r,getContracts:m,getFiltroDefault:F,infoToStore:s}}},De={class:"px-4 mt-10"},ke={class:"flex justify-between"},Ae={class:"px-4"},Ie={key:0,class:"flex justify-center text-3xl"},Ee={class:"text-center"},Me=n("h1",{class:"text-center"},"Pendientes",-1),Se={class:"text-center"},Ue=n("h1",{class:"text-center"},"Pagadas",-1),Te={class:"text-center"},Oe=n("h1",{class:"text-center"},"Total",-1),Pe={class:"flex flex-col mt-20"};function je(f,o,e,a,v,h){const r=b("arrow-back"),m=b("home-page"),p=b("logout-component"),s=b("title-bar"),F=b("Filtro"),q=b("Busqueda");return _(),g("main",De,[n("div",ke,[c(r),n("div",null,[c(m),c(p)])]),c(s,{title:"Consulta MAOF",subtitle:"Agenda de Estimaciones"}),n("section",Ae,[a.app.loading?V("",!0):(_(),g("div",Ie,[n("div",{class:"px-10 text-red cursor-pointer",onClick:o[0]||(o[0]=d=>a.getStatusEstimations(a.app.filtro.data.pendientes,"pendientes"))},[n("p",Ee,x(a.app.filtro.data.pendientes.length),1),Me]),n("div",{class:"px-10 text-green cursor-pointer",onClick:o[1]||(o[1]=d=>a.getStatusEstimations(a.app.filtro.data.pagados,"pagadas"))},[n("p",Se,x(a.app.filtro.data.pagados.length),1),Ue]),n("div",{class:"px-10 cursor-pointer",onClick:o[2]||(o[2]=d=>a.getStatusEstimations(a.app.filtro.data.totales,"totales"))},[n("p",Te,x(a.app.filtro.data.totales.length),1),Oe])])),n("div",Pe,[c(F,{filtro:a.app.filtro,getDocsByType:a.getDocsByType,saveFiltro:a.saveFiltro},null,8,["filtro","getDocsByType","saveFiltro"]),c(q,{showBusquedaValue:a.showBusquedaValue,showBusqueda:a.showBusqueda,saveBusqueda:a.saveBusqueda},null,8,["showBusquedaValue","showBusqueda","saveBusqueda"])])])])}const ot=A(Be,[["render",je]]);export{ot as default};
