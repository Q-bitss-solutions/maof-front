import{I as A}from"./InputBase-33838ec4.js";import{B as S}from"./ButtonBase-e9b6588b.js";import{S as F}from"./SelectBase-a4a56be3.js";import{T}from"./TextAreaBase-25822eed.js";import{f as z,a as D}from"./contract-9db6c95e.js";import{s as O,a as q}from"./residentEstimate-90f0c25e.js";import{f as G}from"./SCIT_Employees-57fd3fce.js";import{_ as R,u as N,k as L,q as P,a as p,o as s,c as r,b as c,e as k,f as _,g as n,F as u,d as b,t as V}from"./index-6b6e47c4.js";import{S as y}from"./sweetalert2.all-281a79b7.js";import{u as Q,r as E,c as l,m as g,a as x}from"./index-9a05e0bb.js";import{A as H,T as J}from"./TitleBar-9ddf3f8e.js";import{s as K}from"./resident-05a896af.js";const W={name:"FormResidentEstimate",props:{editMode:{type:Boolean,default:!1},residentEstimate:{type:Object,default:()=>({})}},components:{InputBase:A,ButtonBase:S,SelectBase:F,TextAreaBase:T},setup(d,{emit:t}){const m=N(),e=L({residentEstimate:{id_contrato:"",fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",importe_obra_ejecutada:"",importe_pagar:"",grado_avance_obra:"",porcentaje_avance_estimacion:"",porcentaje_avance_estimacion_acumulado:"",porcentaje_Avance_fisico:"",porcensaje_avance_financiero:"",observaciones_residente:""},fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",contratoName:"",fileInfo:{type:Object,default:()=>({})},listReviewAreas:[],listEmpleados:[],listContrato:[]}),h=P(()=>({porcentaje_avance_estimacion:{required:E,maxValue:l.withMessage("El valor maximo es %100",g(100)),minValue:l.withMessage("El valor minimo es %0",x(0))},porcentaje_avance_estimacion_acumulado:{required:E,maxValue:l.withMessage("El valor maximo es %100",g(100)),minValue:l.withMessage("El valor minimo es %0",x(0))},porcentaje_Avance_fisico:{required:E,maxValue:l.withMessage("El valor maximo es %100",g(100)),minValue:l.withMessage("El valor minimo es %0",x(0))},porcensaje_avance_financiero:{required:E,maxValue:l.withMessage("El valor maximo es %100",g(100)),minValue:l.withMessage("El valor minimo es %0",x(0))},grado_avance_obra:{required:E,maxValue:l.withMessage("El valor maximo es %100",g(100)),minValue:l.withMessage("El valor minimo es %0",x(0))}})),j=Q(h,e.residentEstimate);d.editMode&&(e.resident=d.resident,e.resident.fecha_inicio_residente=d.resident.fecha_inicio_residente.split("-").reverse().join("-"));const f=()=>{var i=new Date().toLocaleTimeString("en-GB");console.log(i),e.residentEstimate.fecha_recepcion_info_contratista=e.fecha_recepcion_info_contratista+" "+i,e.residentEstimate.fecha_autorizacion_contratista=e.fecha_autorizacion_contratista+" "+i,e.residentEstimate.fecha_periodo_inicio_estimacion=e.fecha_periodo_inicio_estimacion+" "+i,e.residentEstimate.fecha_periodo_fin_estimacion=e.fecha_periodo_fin_estimacion+" "+i,y.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async M=>{if(M.isConfirmed)try{await j.value.$validate()?(await O(e.residentEstimate),y.fire({title:"Registro dado de alta",text:"¿Desea ingresar los documentos?",icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No",reverseButtons:!0}).then(async U=>{if(U.isConfirmed){const{data:B}=await q(),I=B.length-1;e.fileInfo=B[I],console.log("fileInfo: ",e.fileInfo.id_estimacion),m.push({name:"FilesResidentEstimate",params:{residentEstimateId:e.fileInfo.id_estimacion}})}else m.push({name:"ResidentEstimate"})})):y.fire("Error","Revisa bien los datos","error")}catch(C){console.log("error: ",C.response.data.detail),y.fire("Error",`${C.response.data.detail}`,"error")}})},o=async()=>{const{data:a}=await z();e.listContrato=a.map(i=>({value:i.id_contrato,label:i.numero_contrato,name:i.nombre_proyecto})),console.log("app.listContrato:",e.listContrato)},v=async a=>{const{data:i}=await D(a);e.contratoName=i.nombre_proyecto},w=async()=>{const{data:a}=await G(e.idAreaRevisora);e.listEmpleados=a.map(i=>({value:i.empleado_sict,label:i.nombre_completo}))};return o(),{app:e,sendForm:f,getContratos:o,getEmpleadosSICT:w,getName:v,v$:j}}},X=c("div",{class:"flex content-start justify-end items-center mb-10"},[c("div",{class:"items-center justify-center"},[c("h1",{class:"font-bold text-lg"}," Número de la Estimación "),c("p",{class:"text-center font-semibold text-lg"}," 1 ")])],-1),Y={class:"max-w-xl mx-auto"},Z={class:"flex flex-row"};function $(d,t,m,e,h,j){const f=p("select-base"),o=p("input-base"),v=p("text-area-base"),w=p("button-base");return s(),r(u,null,[X,c("div",Y,[m.editMode!==!0?(s(),k(f,{key:0,id:"id_contrato",label:"Número de Contrato(de origen)",options:e.app.listContrato,modelValue:e.app.residentEstimate.id_contrato,"onUpdate:modelValue":t[0]||(t[0]=a=>e.app.residentEstimate.id_contrato=a),class:"mb-3",onChange:t[1]||(t[1]=a=>e.getName(e.app.residentEstimate.id_contrato))},null,8,["options","modelValue"])):_("",!0),m.editMode!==!0?(s(),k(o,{key:1,id:"id_area_revisora",label:"Objeto del Contrato",type:"text",modelValue:e.app.contratoName,"onUpdate:modelValue":t[2]||(t[2]=a=>e.app.contratoName=a),class:"mb-3",disabled:""},null,8,["modelValue"])):_("",!0),n(o,{id:"fecha_recepcion_info_contratista",label:"Fecha de recepción de información del Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_recepcion_info_contratista,"onUpdate:modelValue":t[3]||(t[3]=a=>e.app.fecha_recepcion_info_contratista=a)},null,8,["modelValue"]),n(o,{id:"fecha_autorizacion_contratista",label:"Fecha de autorización al Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_autorizacion_contratista,"onUpdate:modelValue":t[4]||(t[4]=a=>e.app.fecha_autorizacion_contratista=a)},null,8,["modelValue"]),c("div",Z,[c("div",null,[n(o,{id:"fecha_periodo_inicio_estimacion",label:"Período de la Estimación",type:"date",modelValue:e.app.fecha_periodo_inicio_estimacion,"onUpdate:modelValue":t[5]||(t[5]=a=>e.app.fecha_periodo_inicio_estimacion=a)},null,8,["modelValue"])]),c("div",null,[n(o,{id:"fecha_periodo_fin_estimacion",label:"al",type:"date",class:"pt-2",modelValue:e.app.fecha_periodo_fin_estimacion,"onUpdate:modelValue":t[6]||(t[6]=a=>e.app.fecha_periodo_fin_estimacion=a)},null,8,["modelValue"])])]),n(o,{id:"importe_obra_ejecutada",label:"Importe de la obra ejecutada",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_obra_ejecutada,"onUpdate:modelValue":t[7]||(t[7]=a=>e.app.residentEstimate.importe_obra_ejecutada=a)},null,8,["modelValue"]),n(o,{id:"importe_pagar",label:"Importe a pagar",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_pagar,"onUpdate:modelValue":t[8]||(t[8]=a=>e.app.residentEstimate.importe_pagar=a)},null,8,["modelValue"]),n(o,{id:"grado_avance_obra",label:"% de grado de avance",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.grado_avance_obra,"onUpdate:modelValue":t[9]||(t[9]=a=>e.app.residentEstimate.grado_avance_obra=a)},null,8,["modelValue"]),e.v$.grado_avance_obra.$error?(s(!0),r(u,{key:2},b(e.v$.grado_avance_obra.$errors,a=>(s(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},V(a.$message),1))),128)):_("",!0),n(o,{id:"porcentaje_avance_estimacion",label:"% de avance de la Estimación",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion,"onUpdate:modelValue":t[10]||(t[10]=a=>e.app.residentEstimate.porcentaje_avance_estimacion=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion.$error?(s(!0),r(u,{key:3},b(e.v$.porcentaje_avance_estimacion.$errors,a=>(s(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},V(a.$message),1))),128)):_("",!0),n(o,{id:"porcentaje_avance_estimacion_acumulado",label:"% de avance de la Estimación acumulado",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion_acumulado,"onUpdate:modelValue":t[11]||(t[11]=a=>e.app.residentEstimate.porcentaje_avance_estimacion_acumulado=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion_acumulado.$error?(s(!0),r(u,{key:4},b(e.v$.porcentaje_avance_estimacion_acumulado.$errors,a=>(s(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},V(a.$message),1))),128)):_("",!0),n(o,{id:"porcentaje_Avance_fisico",label:"% de avance físico",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_Avance_fisico,"onUpdate:modelValue":t[12]||(t[12]=a=>e.app.residentEstimate.porcentaje_Avance_fisico=a)},null,8,["modelValue"]),e.v$.porcentaje_Avance_fisico.$error?(s(!0),r(u,{key:5},b(e.v$.porcentaje_Avance_fisico.$errors,a=>(s(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},V(a.$message),1))),128)):_("",!0),n(o,{id:"porcensaje_avance_financiero",label:"% de avance financiero",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcensaje_avance_financiero,"onUpdate:modelValue":t[13]||(t[13]=a=>e.app.residentEstimate.porcensaje_avance_financiero=a)},null,8,["modelValue"]),e.v$.porcensaje_avance_financiero.$error?(s(!0),r(u,{key:6},b(e.v$.porcensaje_avance_financiero.$errors,a=>(s(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},V(a.$message),1))),128)):_("",!0),n(v,{id:"fecha_inicio_proyecto",label:"Observaciones del Residente",class:"mb-3",modelValue:e.app.residentEstimate.observaciones_residente,"onUpdate:modelValue":t[14]||(t[14]=a=>e.app.residentEstimate.observaciones_residente=a)},null,8,["modelValue"]),n(w,{label:"Guardar",onClick:e.sendForm,class:"mr-0 ml-auto"},null,8,["onClick"])])],64)}const ee=R(W,[["render",$]]),ae={name:"NewResident",components:{FormResidentEstimate:ee,ArrowBack:H,TitleBar:J},setup(){const d=N();return{saveResident:async m=>{await K(m),y.fire("¡Éxito!","Residente guardado con éxito!","success"),d.push({name:"Resident"})}}}},te={class:"px-4 mt-10"},oe={class:"px-4"};function ne(d,t,m,e,h,j){const f=p("arrow-back"),o=p("title-bar"),v=p("form-resident-estimate");return s(),r("main",te,[n(f),n(o,{title:"Estimación Residente",subtitle:"Nuevo"}),c("section",oe,[n(v,{onSubmit:e.saveResident},null,8,["onSubmit"])])])}const be=R(ae,[["render",ne]]);export{be as default};
