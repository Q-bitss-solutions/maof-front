import{I as z}from"./InputBase-aa03d9ee.js";import{B as A}from"./ButtonBase-b74c4a37.js";import{S as F}from"./SelectBase-af5b6c60.js";import{T as I}from"./TextAreaBase-65da7864.js";import{T as M}from"./fetchApi-cb905fd6.js";import{s as U,c as N}from"./residentEstimate-4377f026.js";import{_ as B,u as k,k as C,q as T,a as x,o as i,c as s,b as c,t as d,g as r,F as u,d as v,f as p,l as S,e as D}from"./index-3b5ad1a8.js";import{S as g}from"./sweetalert2.all-281a79b7.js";import{u as $,c as m,m as E,a as h}from"./index-bc06567d.js";import{A as L}from"./ArrowBack-5fbdef8c.js";import{a as O}from"./contract-eba43625.js";const q={name:"FormResidentEstimate",props:{editMode:{type:Boolean,default:!1},residentEstimate:{type:Object,default:()=>({})}},components:{InputBase:z,ButtonBase:A,SelectBase:F,TextAreaBase:I},setup(f){const t=k(),o=C({residentEstimate:{id_contrato:"",fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",importe_obra_ejecutada:"",importe_pagar:"",grado_avance_obra:"",porcentaje_avance_estimacion:"",porcentaje_avance_estimacion_acumulado:"",porcentaje_Avance_fisico:"",porcensaje_avance_financiero:""},fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",contratoName:"",fileInfo:{type:Object,default:()=>({})},listReviewAreas:[],listEmpleados:[],listContrato:[]}),a=()=>{let _=new Date;var e=("0"+_.getDate()).slice(-2),y=("0"+(_.getMonth()+1)).slice(-2),V=_.getFullYear(),j=V+"-"+y+"-"+e;return!(o.fecha_autorizacion_contratista>j)},b=T(()=>({porcentaje_avance_estimacion:{maxValue:m.withMessage("El valor maximo es 100%",E(100)),minValue:m.withMessage("El valor minimo es 0%",h(0))},porcentaje_avance_estimacion_acumulado:{maxValue:m.withMessage("El valor maximo es 100%",E(100)),minValue:m.withMessage("El valor minimo es 0%",h(0))},porcentaje_Avance_fisico:{maxValue:m.withMessage("El valor maximo es 100%",E(100)),minValue:m.withMessage("El valor minimo es 0%",h(0))},porcensaje_avance_financiero:{maxValue:m.withMessage("El valor maximo es 100%",E(100)),minValue:m.withMessage("El valor minimo es 0%",h(0))},grado_avance_obra:{maxValue:m.withMessage("El valor maximo es 100%",E(100)),minValue:m.withMessage("El valor minimo es 0%",h(0))},fecha_autorizacion_contratista:{fechaActualFunction:m.withMessage("La fecha es mayor al dia de hoy",a)}}));f.editMode&&(o.residentEstimate=f.residentEstimate);const l=$(b,o.residentEstimate);return{app:o,sendForm:()=>{var e=new Date().toLocaleTimeString("en-GB");o.residentEstimate.fecha_recepcion_info_contratista=o.fecha_recepcion_info_contratista+" "+e,o.fecha_autorizacion_contratista===""?delete o.residentEstimate.fecha_autorizacion_contratista:o.residentEstimate.fecha_autorizacion_contratista=o.fecha_autorizacion_contratista+" "+e,o.residentEstimate.fecha_periodo_inicio_estimacion=o.fecha_periodo_inicio_estimacion+" "+e,o.residentEstimate.fecha_periodo_fin_estimacion=o.fecha_periodo_fin_estimacion+" "+e,g.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async y=>{if(y.isConfirmed)try{await l.value.$validate()?(delete o.residentEstimate.num_consecutivo_estimacion,await U(o.residentEstimate),g.fire({title:"Registro dado de alta",text:"¿Desea ingresar los documentos?",icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí",cancelButtonText:"No",reverseButtons:!0}).then(async j=>{if(j.isConfirmed){const{data:w}=await N(),R=w.length-1;o.fileInfo=w[R],t.push({name:"FilesResidentEstimate",params:{residentEstimateId:o.fileInfo.id_estimacion}})}else t.push({name:"ResidentEstimate"})})):g.fire("Error","Revisa bien los datos","error")}catch(V){g.fire("Error",`${V.response.data.detail}`,"error")}})},v$:l}}},G={class:"flex flex-row justify-between"},P={class:"font-bold text-lg"},Y={class:"font-bold text-lg w-128"},H={class:"flex content-start justify-end items-center mb-10"},J={class:"items-center justify-center"},K=c("h1",{class:"font-bold text-lg"}," Número de la Estimación ",-1),Q={class:"text-center font-semibold text-lg numEstimacion"},W={class:"max-w-xl mx-auto"},X={class:"flex flex-row"};function Z(f,t,o,a,b,l){const n=x("input-base"),_=x("button-base");return i(),s(u,null,[c("div",G,[c("div",P,d(a.app.residentEstimate.numero_contrato),1),c("div",Y," Objeto: "+d(a.app.residentEstimate.objeto_contrato),1),c("div",H,[c("div",J,[K,c("p",Q,d(a.app.residentEstimate.num_consecutivo_estimacion),1)])])]),c("div",W,[r(n,{id:"fecha_recepcion_info_contratista",label:"Fecha de recepción de información del Contratista",type:"date",class:"mb-3",modelValue:a.app.fecha_recepcion_info_contratista,"onUpdate:modelValue":t[0]||(t[0]=e=>a.app.fecha_recepcion_info_contratista=e)},null,8,["modelValue"]),r(n,{id:"fecha_autorizacion_contratista",label:"Fecha de autorización al Contratista",type:"date",class:"mb-3",modelValue:a.app.fecha_autorizacion_contratista,"onUpdate:modelValue":t[1]||(t[1]=e=>a.app.fecha_autorizacion_contratista=e)},null,8,["modelValue"]),a.v$.fecha_autorizacion_contratista.$error?(i(!0),s(u,{key:0},v(a.v$.fecha_autorizacion_contratista.$errors,e=>(i(),s("span",{key:e,class:"text-red font-semibold text-center ml-80"},d(e.$message),1))),128)):p("",!0),c("div",X,[c("div",null,[r(n,{id:"fecha_periodo_inicio_estimacion",label:"Período de la Estimación",type:"date",modelValue:a.app.fecha_periodo_inicio_estimacion,"onUpdate:modelValue":t[2]||(t[2]=e=>a.app.fecha_periodo_inicio_estimacion=e)},null,8,["modelValue"])]),c("div",null,[r(n,{id:"fecha_periodo_fin_estimacion",label:"al",type:"date",class:"pt-2",modelValue:a.app.fecha_periodo_fin_estimacion,"onUpdate:modelValue":t[3]||(t[3]=e=>a.app.fecha_periodo_fin_estimacion=e)},null,8,["modelValue"])])]),r(n,{id:"importe_obra_ejecutada",label:"Importe de la obra ejecutada",type:"number",class:"mb-3",modelValue:a.app.residentEstimate.importe_obra_ejecutada,"onUpdate:modelValue":t[4]||(t[4]=e=>a.app.residentEstimate.importe_obra_ejecutada=e)},null,8,["modelValue"]),r(n,{id:"importe_pagar",label:"Importe a pagar",type:"number",class:"mb-3",modelValue:a.app.residentEstimate.importe_pagar,"onUpdate:modelValue":t[5]||(t[5]=e=>a.app.residentEstimate.importe_pagar=e)},null,8,["modelValue"]),r(n,{id:"grado_avance_obra",label:"% de grado de avance",type:"number",class:"mb-3",modelValue:a.app.residentEstimate.grado_avance_obra,"onUpdate:modelValue":t[6]||(t[6]=e=>a.app.residentEstimate.grado_avance_obra=e)},null,8,["modelValue"]),a.v$.grado_avance_obra.$error?(i(!0),s(u,{key:1},v(a.v$.grado_avance_obra.$errors,e=>(i(),s("span",{key:e,class:"text-red font-semibold text-center ml-80"},d(e.$message),1))),128)):p("",!0),r(n,{id:"porcentaje_avance_estimacion",label:"% de avance de la Estimación",type:"number",class:"mb-3",modelValue:a.app.residentEstimate.porcentaje_avance_estimacion,"onUpdate:modelValue":t[7]||(t[7]=e=>a.app.residentEstimate.porcentaje_avance_estimacion=e)},null,8,["modelValue"]),a.v$.porcentaje_avance_estimacion.$error?(i(!0),s(u,{key:2},v(a.v$.porcentaje_avance_estimacion.$errors,e=>(i(),s("span",{key:e,class:"text-red font-semibold text-center ml-80"},d(e.$message),1))),128)):p("",!0),r(n,{id:"porcentaje_avance_estimacion_acumulado",label:"% de avance de la Estimación acumulado",type:"number",class:"mb-3",modelValue:a.app.residentEstimate.porcentaje_avance_estimacion_acumulado,"onUpdate:modelValue":t[8]||(t[8]=e=>a.app.residentEstimate.porcentaje_avance_estimacion_acumulado=e)},null,8,["modelValue"]),a.v$.porcentaje_avance_estimacion_acumulado.$error?(i(!0),s(u,{key:3},v(a.v$.porcentaje_avance_estimacion_acumulado.$errors,e=>(i(),s("span",{key:e,class:"text-red font-semibold text-center ml-80"},d(e.$message),1))),128)):p("",!0),r(n,{id:"porcentaje_Avance_fisico",label:"% de avance físico",type:"number",class:"mb-3",modelValue:a.app.residentEstimate.porcentaje_Avance_fisico,"onUpdate:modelValue":t[9]||(t[9]=e=>a.app.residentEstimate.porcentaje_Avance_fisico=e)},null,8,["modelValue"]),a.v$.porcentaje_Avance_fisico.$error?(i(!0),s(u,{key:4},v(a.v$.porcentaje_Avance_fisico.$errors,e=>(i(),s("span",{key:e,class:"text-red font-semibold text-center ml-80"},d(e.$message),1))),128)):p("",!0),r(n,{id:"porcensaje_avance_financiero",label:"% de avance financiero",type:"number",class:"mb-3",modelValue:a.app.residentEstimate.porcensaje_avance_financiero,"onUpdate:modelValue":t[10]||(t[10]=e=>a.app.residentEstimate.porcensaje_avance_financiero=e)},null,8,["modelValue"]),a.v$.porcensaje_avance_financiero.$error?(i(!0),s(u,{key:5},v(a.v$.porcensaje_avance_financiero.$errors,e=>(i(),s("span",{key:e,class:"text-red font-semibold text-center ml-80"},d(e.$message),1))),128)):p("",!0),r(_,{label:"Guardar",onClick:a.sendForm,class:"mr-0 ml-auto"},null,8,["onClick"])])],64)}const ee=B(q,[["render",Z]]),ae={name:"NewResidentbyId",components:{FormResidentEstimate:ee,ArrowBack:L,TitleBar:M},setup(){const f=S(),t=k(),o=C({residentEstimate:{id_contrato:"",num_consecutivo_estimacion:"",numero_contrato:"",objeto_contrato:""},loading:!0}),a=async()=>{o.loading=!0;const{data:l}=await O(f.params.residentEstimateId);o.residentEstimate.num_consecutivo_estimacion=l.contador_siguiente_estimacion,o.residentEstimate.numero_contrato=l.numero_contrato,o.residentEstimate.id_contrato=l.id_contrato,o.residentEstimate.objeto_contrato=l.objeto_contrato,o.loading=!1},b=async l=>{await updateResident(l),g.fire("¡Éxito!","!Estimación residente actualizado con éxito!","success"),t.push({name:"Resident"})};return a(),{app:o,saveResident:b}}},te={class:"px-4 mt-10"},oe={class:"px-4"};function ie(f,t,o,a,b,l){const n=x("arrow-back"),_=x("title-bar"),e=x("form-resident-estimate");return i(),s("main",te,[r(n),r(_,{title:"Estimación Residente",subtitle:"Nuevo"}),c("section",oe,[a.app.loading?p("",!0):(i(),D(e,{key:0,residentEstimate:a.app.residentEstimate,"edit-mode":""},null,8,["residentEstimate"]))])])}const ve=B(ae,[["render",ie]]);export{ve as default};
