import{I as B}from"./InputBase-be73efb9.js";import{B as z}from"./ButtonBase-51a1f46b.js";import{S as A}from"./SelectBase-2ae14bdf.js";import{T as k}from"./TextAreaBase-0dd26439.js";import{u as R,d as F,e as M}from"./residentEstimate-9fc98e42.js";import{_ as T,u as U,k as S,q as I,a as C,o as s,c as r,b as _,t as v,g as n,F as E,d as h,f as b,e as N}from"./index-33280006.js";import{S as l}from"./sweetalert2.all-281a79b7.js";import{u as q,c as d,m as g,a as y}from"./index-25aa3b5b.js";const D={name:"FormResidentEstimate",props:{editMode:{type:Boolean,default:!1},residentEstimate:{type:Object,default:()=>({})}},components:{InputBase:B,ButtonBase:z,SelectBase:A,TextAreaBase:k},setup(u){const i=U(),t=S({residentEstimate:{id_contrato:"",fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",importe_obra_ejecutada:"",importe_pagar:"",grado_avance_obra:"",porcentaje_avance_estimacion:"",porcentaje_avance_estimacion_acumulado:"",porcentaje_Avance_fisico:"",porcensaje_avance_financiero:"",observaciones_residente:""},fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",contratoName:"",estatus_semaforo:"",fileInfo:{type:Object,default:()=>({})},listReviewAreas:[],listEmpleados:[],listContrato:[]}),e=m=>{let o=[];return o=m.split(" "),o=o[0].split("-"),o=o[0]+"-"+o[1]+"-"+o[2],m=o,m},j=()=>{let m=new Date;var o=("0"+m.getDate()).slice(-2),x=("0"+(m.getMonth()+1)).slice(-2),p=m.getFullYear(),V=p+"-"+x+"-"+o;return!(t.fecha_autorizacion_contratista>V)},w=I(()=>({porcentaje_avance_estimacion:{maxValue:d.withMessage("El valor maximo es 100%",g(100)),minValue:d.withMessage("El valor minimo es 0%",y(0))},porcentaje_avance_estimacion_acumulado:{maxValue:d.withMessage("El valor maximo es 100%",g(100)),minValue:d.withMessage("El valor minimo es 0%",y(0))},porcentaje_Avance_fisico:{maxValue:d.withMessage("El valor maximo es 100%",g(100)),minValue:d.withMessage("El valor minimo es 0%",y(0))},porcensaje_avance_financiero:{maxValue:d.withMessage("El valor maximo es 100%",g(100)),minValue:d.withMessage("El valor minimo es 0%",y(0))},grado_avance_obra:{maxValue:d.withMessage("El valor maximo es 100%",g(100)),minValue:d.withMessage("El valor minimo es 0%",y(0))},fecha_autorizacion_contratista:{fechaActualFunction:d.withMessage("La fecha es mayor al dia de hoy",j)}})),f=q(w,u.residentEstimate);return u.editMode&&(t.residentEstimate=u.residentEstimate,t.estatus_semaforo=u,t.fecha_recepcion_info_contratista=e(u.residentEstimate.fecha_recepcion_info_contratista),u.residentEstimate.fecha_autorizacion_contratista===null?t.fecha_autorizacion_contratista=null:t.fecha_autorizacion_contratista=e(u.residentEstimate.fecha_autorizacion_contratista),t.fecha_periodo_inicio_estimacion=e(u.residentEstimate.fecha_periodo_inicio_estimacion),t.fecha_periodo_fin_estimacion=e(u.residentEstimate.fecha_periodo_fin_estimacion)),{app:t,editForm:()=>{var o=new Date().toLocaleTimeString("en-GB");t.residentEstimate.fecha_recepcion_info_contratista=t.fecha_recepcion_info_contratista+" "+o,t.fecha_autorizacion_contratista===null||t.fecha_autorizacion_contratista===""?t.residentEstimate.fecha_autorizacion_contratista=null:t.residentEstimate.fecha_autorizacion_contratista=t.fecha_autorizacion_contratista+" "+o,t.residentEstimate.fecha_periodo_inicio_estimacion=t.fecha_periodo_inicio_estimacion+" "+o,t.residentEstimate.fecha_periodo_fin_estimacion=t.fecha_periodo_fin_estimacion+" "+o,l.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async x=>{if(x.isConfirmed)try{await f.value.$validate()?(await R(t.residentEstimate),l.fire("¡Éxito!","Actualización con éxito!","success"),i.push({name:"ResidentEstimate"})):l.fire("Error","Revisa bien los datos","error")}catch(p){l.fire("Error",`${p.response.data.detail}`,"error")}})},deleteForm:()=>{l.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async m=>{if(m.isConfirmed)try{await F(t.residentEstimate,t.residentEstimate.id_estimacion),l.fire("¡Éxito!","Actualización con éxito!","success"),i.push({name:"ResidentEstimate"})}catch(o){l.fire("Error",`${o.response.data.detail}`,"error")}})},sendReviewArea:()=>{var o=new Date().toLocaleTimeString("en-GB");t.fecha_autorizacion_contratista===null?t.residentEstimate.fecha_autorizacion_contratista=null:t.residentEstimate.fecha_autorizacion_contratista=t.fecha_autorizacion_contratista+" "+o,l.fire({title:"Se realizará el envio de la Estimación al área revisora",icon:"question",showCancelButton:!0,text:"¿Está usted seguro?",cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async x=>{if(x.isConfirmed)try{const{value:p}=await l.fire({input:"textarea",inputLabel:"Observaciones",inputPlaceholder:"Escribe tus observaciones...",inputAttributes:{"aria-label":"Type your message here"},showCancelButton:!0,reverseButtons:!0,inputValidator:V=>{if(!V)return"El campo es requerido"}});p!==void 0?(t.residentEstimate.observaciones_residente=p,await M(t.residentEstimate),l.fire("¡Éxito!","Estimación enviada al área revisora con éxito!","success"),i.push({name:"ResidentEstimate"})):l.fire("No agregaste ninguna observacion","Agrega uno para continuar","warning")}catch(p){l.fire("Error",`${p.response.data.detail}`,"error")}})},goToArchivos:()=>i.push({name:"FilesResidentEstimate",params:{residentEstimateId:t.residentEstimate.id_estimacion}}),formatFecha:e,v$:f}}},L={class:"flex flex-row justify-between"},O={class:"font-bold text-lg"},G={class:"font-bold text-lg w-128"},P={class:"flex content-start justify-end items-center mb-10"},Y={class:"items-center justify-center"},H=_("h1",{class:"font-bold text-lg text-center"}," Número de la Estimación ",-1),J={class:"text-center font-semibold text-lg numEstimacion"},K={class:"max-w-xl mx-auto"},Q={class:"flex flex-row"},W={key:0,class:"flex justify-between items-center py-4"},X={key:1,class:"flex justify-between items-center py-4"};function Z(u,i,t,e,j,w){const f=C("button-base"),c=C("input-base");return s(),r(E,null,[_("div",L,[_("div",O,v(e.app.residentEstimate.numero_contrato),1),_("div",G," Objeto: "+v(e.app.residentEstimate.objeto_contrato),1),_("div",P,[_("div",Y,[H,_("p",J,v(e.app.residentEstimate.num_consecutivo_estimacion),1)])])]),n(f,{label:"Archivos",onClick:e.goToArchivos,class:"mb-3 mr-0 ml-auto"},null,8,["onClick"]),_("div",K,[n(c,{id:"fecha_recepcion_info_contratista",label:"Fecha de recepción de información del Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_recepcion_info_contratista,"onUpdate:modelValue":i[0]||(i[0]=a=>e.app.fecha_recepcion_info_contratista=a)},null,8,["modelValue"]),n(c,{id:"fecha_autorizacion_contratista",label:"Fecha de autorización al Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_autorizacion_contratista,"onUpdate:modelValue":i[1]||(i[1]=a=>e.app.fecha_autorizacion_contratista=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"]),e.v$.fecha_autorizacion_contratista.$error?(s(!0),r(E,{key:0},h(e.v$.fecha_autorizacion_contratista.$errors,a=>(s(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},v(a.$message),1))),128)):b("",!0),_("div",Q,[_("div",null,[n(c,{id:"fecha_periodo_inicio_estimacion",label:"Período de la Estimación",type:"date",modelValue:e.app.fecha_periodo_inicio_estimacion,"onUpdate:modelValue":i[2]||(i[2]=a=>e.app.fecha_periodo_inicio_estimacion=a)},null,8,["modelValue"])]),_("div",null,[n(c,{id:"fecha_periodo_fin_estimacion",label:"al",type:"date",class:"pt-2",modelValue:e.app.fecha_periodo_fin_estimacion,"onUpdate:modelValue":i[3]||(i[3]=a=>e.app.fecha_periodo_fin_estimacion=a)},null,8,["modelValue"])])]),n(c,{id:"importe_obra_ejecutada",label:"Importe de la obra ejecutada",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_obra_ejecutada,"onUpdate:modelValue":i[4]||(i[4]=a=>e.app.residentEstimate.importe_obra_ejecutada=a)},null,8,["modelValue"]),n(c,{id:"importe_pagar",label:"Importe a pagar",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_pagar,"onUpdate:modelValue":i[5]||(i[5]=a=>e.app.residentEstimate.importe_pagar=a)},null,8,["modelValue"]),n(c,{id:"grado_avance_obra",label:"% de grado de avance",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.grado_avance_obra,"onUpdate:modelValue":i[6]||(i[6]=a=>e.app.residentEstimate.grado_avance_obra=a)},null,8,["modelValue"]),e.v$.grado_avance_obra.$error?(s(!0),r(E,{key:1},h(e.v$.grado_avance_obra.$errors,a=>(s(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},v(a.$message),1))),128)):b("",!0),n(c,{id:"porcentaje_avance_estimacion",label:"% de avance de la Estimación",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion,"onUpdate:modelValue":i[7]||(i[7]=a=>e.app.residentEstimate.porcentaje_avance_estimacion=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion.$error?(s(!0),r(E,{key:2},h(e.v$.porcentaje_avance_estimacion.$errors,a=>(s(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},v(a.$message),1))),128)):b("",!0),n(c,{id:"porcentaje_avance_estimacion_acumulado",label:"% de avance de la Estimación acumulado",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion_acumulado,"onUpdate:modelValue":i[8]||(i[8]=a=>e.app.residentEstimate.porcentaje_avance_estimacion_acumulado=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion_acumulado.$error?(s(!0),r(E,{key:3},h(e.v$.porcentaje_avance_estimacion_acumulado.$errors,a=>(s(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},v(a.$message),1))),128)):b("",!0),n(c,{id:"porcentaje_Avance_fisico",label:"% de avance físico",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_Avance_fisico,"onUpdate:modelValue":i[9]||(i[9]=a=>e.app.residentEstimate.porcentaje_Avance_fisico=a)},null,8,["modelValue"]),e.v$.porcentaje_Avance_fisico.$error?(s(!0),r(E,{key:4},h(e.v$.porcentaje_Avance_fisico.$errors,a=>(s(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},v(a.$message),1))),128)):b("",!0),n(c,{id:"porcensaje_avance_financiero",label:"% de avance financiero",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcensaje_avance_financiero,"onUpdate:modelValue":i[10]||(i[10]=a=>e.app.residentEstimate.porcensaje_avance_financiero=a)},null,8,["modelValue"]),e.v$.porcensaje_avance_financiero.$error?(s(!0),r(E,{key:5},h(e.v$.porcensaje_avance_financiero.$errors,a=>(s(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},v(a.$message),1))),128)):b("",!0)]),e.app.residentEstimate.estatus_semaforo==="Residente"?(s(),r("div",W,[e.app.residentEstimate.estatus_estimacion==="Capturada por Residente"||e.app.residentEstimate.estatus_estimacion==="Autorizada por Residente"?(s(),N(f,{key:0,label:"Inactivar Estimación",class:"px-4",onClick:e.deleteForm},null,8,["onClick"])):b("",!0),n(f,{label:"Actualizar datos",class:"px-4",onClick:e.editForm},null,8,["onClick"]),n(f,{label:"Enviar al área revisora",class:"px-4",onClick:e.sendReviewArea},null,8,["onClick"])])):b("",!0),e.app.residentEstimate.estatus_semaforo==="Area Revisora"?(s(),r("div",X,[n(f,{label:"Regresar a  Residente",class:"px-4"}),n(f,{label:"Actualizar datos",class:"px-4"}),n(f,{label:"Enviar a finanzas",class:"px-4"})])):b("",!0)],64)}const le=T(D,[["render",Z]]);export{le as F};
