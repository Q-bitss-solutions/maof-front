import{T as L}from"./TableUsers-8886a13b.js";import{A as G}from"./ArrowBack-b71575d9.js";import{H as J}from"./HomePage-3e9ed152.js";import{S}from"./SelectBase-321e395e.js";import{B as E,a as N}from"./fetchApi-d6252301.js";import{_ as I,m as K,s as U,b as g,o as h,c as q,e as c,d,F as A,f as T,t as C,h as w,g as k,n as Q,j as W,u as X,a as Y,r as O}from"./index-c168c190.js";import{T as Z}from"./TitleBar-74e3189e.js";import{I as $}from"./InputBase-73fa837d.js";import{f as R}from"./contract-63eb2a5b.js";import{f as ee}from"./resident-0e16c141.js";import{a as te}from"./SICTUnits-a6358ca6.js";import{k as ae}from"./residentEstimate-6f82e677.js";import{S as V}from"./sweetalert2.all-281a79b7.js";import{u as oe,c as M,a as j}from"./index-60785a98.js";import{f as se}from"./project-ab99d278.js";import{c as le}from"./consultas-c4741daa.js";import{L as ie}from"./LogoutComponent-cb7cd610.js";const ne={name:"FormProject",props:{editMode:{type:Boolean,default:!1},project:{type:Object,default:()=>({})},showBusqueda:{type:Function,required:!0}},components:{InputBase:$,ButtonBase:E,SelectBase:S},setup(p,{emit:a}){const e=K({busqueda:{id_contrato:"",id_residente:"",mes_estimacion:"",año_estimacion:"",estatus_estimacion:"",unidad_maof:"",dias_transcurridos:[],fechas_autorizacion:[]},listMesEstimacion:[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiempbre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}],diasInicio:"",diasFin:"",fechaInicio:"",fechaFin:"",listAnios:[],listC_CC_CM:[],listResident:[],listUnitMAOF:[],listStatusEstimate:[]}),t=U(()=>({diasFin:{minValue:M.withMessage("El valor mínimo es 1",j(1)),customValidation:M.withMessage("El valor de días inicio debe ser menor que días fin",u=>e.diasInicio!==""&&e.diasFin!==""?e.diasInicio<e.diasFin:!0)},diasInicio:{minValue:M.withMessage("El valor mínimo es 0",j(0))}})),o=oe(t,e),y=U(()=>{const{id_contrato:u,id_residente:l,mes_estimacion:f,año_estimacion:B,estatus_estimacion:i,unidad_maof:_}=e.busqueda,{diasInicio:r,diasFin:n,fechaInicio:F,fechaFin:H}=e;return!u&&!l&&!f&&!B&&!i&&!_&&!r&&!n&&!F&&!H}),m=async()=>{const u={activate_filters:!0};try{const{data:l}=await R(u);e.listC_CC_CM=l.map(f=>({value:f.id_contrato,label:f.numero_contrato})),e.listC_CC_CM.sort((f,B)=>f.label>B.label?1:f.label<B.label?-1:0)}catch(l){V.fire("¡Error!",`${l.response.data.detail}`,"error"),p.showBusqueda()}},b=async()=>{const{data:u}=await ee();e.listResident=u.map(l=>({value:l.id_residente,label:l.nombre_completo})),e.listResident.sort((l,f)=>l.label>f.label?1:l.label<f.label?-1:0)},v=async()=>{const{data:u}=await te();e.listUnitMAOF=u.map(l=>({value:l.id_unidad_maof,label:l.unidad})),e.listUnitMAOF.sort((l,f)=>l.label>f.label?1:l.label<f.label?-1:0)},s=async()=>{const{data:u}=await ae();e.listStatusEstimate=u.map(l=>({value:l.clave_estatus_estimacion,label:l.estatus_estimacion})),e.listStatusEstimate.sort((l,f)=>l.label>f.label?1:l.label<f.label?-1:0)},x=u=>{for(let l=0;l<u;l++)e.listAnios.push({value:2023+l,label:`${2023+l}`})},D=async()=>{if(await o.value.$validate())e.diasInicio!==""&&(e.busqueda.dias_transcurridos.push(e.diasInicio),e.diasInicio=""),e.diasFin!==""&&(e.busqueda.dias_transcurridos.push(e.diasFin),e.diasFin=""),e.fechaInicio!==""&&(e.busqueda.fechas_autorizacion.push(e.fechaInicio),e.fechaInicio=""),e.fechaFin!==""&&(e.busqueda.fechas_autorizacion.push(e.fechaFin),e.fechaFin=""),a("submit",e.busqueda);else for(let l=0;l<o.value.$errors.length;l++)await V.fire({title:o.value.$errors[l].$message,icon:"error"})};return m(),b(),v(),s(),x(10),{app:e,isFormEmpty:y,v$:o,sendForm:D,getC_CC_CM:m,getResident:b,getUnitMAOF:v,getStatusEstimate:s,generateAnios:x}}},re={class:"max-w-6xl pb-10 grow"},de=d("p",{class:"w-[17rem]"},"*Contrato, Convenio de Colaboración, Convenio Modificatorio",-1),ue={class:"grid grid-cols-2"},ce={class:"grid"},me={class:"grid grid-cols-2 pt-3"};function fe(p,a,e,t,o,y){const m=g("select-base"),b=g("input-base"),v=g("button-base");return h(),q("div",re,[de,c(m,{id:"clave_cartera",label:"C, CC, CM*",options:t.app.listC_CC_CM,class:"mb-3",modelValue:t.app.busqueda.id_contrato,"onUpdate:modelValue":a[0]||(a[0]=s=>t.app.busqueda.id_contrato=s)},null,8,["options","modelValue"]),c(m,{id:"nombre_proyecto",label:"Residente",options:t.app.listResident,class:"mb-3",modelValue:t.app.busqueda.id_residente,"onUpdate:modelValue":a[1]||(a[1]=s=>t.app.busqueda.id_residente=s)},null,8,["options","modelValue"]),c(m,{id:"nombre_proyecto",label:"Mes de la Estimación",options:t.app.listMesEstimacion,class:"mb-3",modelValue:t.app.busqueda.mes_estimacion,"onUpdate:modelValue":a[2]||(a[2]=s=>t.app.busqueda.mes_estimacion=s)},null,8,["options","modelValue"]),c(m,{id:"nombre_proyecto",label:"Año de la Estimación",options:t.app.listAnios,class:"mb-3",modelValue:t.app.busqueda.año_estimacion,"onUpdate:modelValue":a[3]||(a[3]=s=>t.app.busqueda.año_estimacion=s)},null,8,["options","modelValue"]),c(m,{id:"nombre_proyecto",label:"Estatus de la Estimación",class:"mb-3",options:t.app.listStatusEstimate,modelValue:t.app.busqueda.estatus_estimacion,"onUpdate:modelValue":a[4]||(a[4]=s=>t.app.busqueda.estatus_estimacion=s)},null,8,["options","modelValue"]),c(m,{id:"nombre_proyecto",label:"Unidad MAOF responsable",options:t.app.listUnitMAOF,class:"mb-3",modelValue:t.app.busqueda.unidad_maof,"onUpdate:modelValue":a[5]||(a[5]=s=>t.app.busqueda.unidad_maof=s)},null,8,["options","modelValue"]),d("div",ue,[c(b,{id:"dias_inicio",label:"Días transcurridos del",type:"number",class:"grow",modelValue:t.app.diasInicio,"onUpdate:modelValue":a[6]||(a[6]=s=>t.app.diasInicio=s)},null,8,["modelValue"]),c(b,{id:"dias_fin",label:"al",type:"number",class:"flex-auto",modelValue:t.app.diasFin,"onUpdate:modelValue":a[7]||(a[7]=s=>t.app.diasFin=s)},null,8,["modelValue"])]),d("div",ce,[t.v$.diasInicio.$error?(h(!0),q(A,{key:0},T(t.v$.diasInicio.$errors,s=>(h(),q("span",{key:s,class:"text-red font-semibold text-center ml-80"},C(s.$message),1))),128)):w("",!0),t.v$.diasFin.$error?(h(!0),q(A,{key:1},T(t.v$.diasFin.$errors,s=>(h(),q("span",{key:s,class:"text-red font-semibold text-center ml-80"},C(s.$message),1))),128)):w("",!0)]),d("div",me,[c(b,{id:"fecha_inicio",label:"Autorización entre",type:"date",class:"grow",modelValue:t.app.fechaInicio,"onUpdate:modelValue":a[8]||(a[8]=s=>t.app.fechaInicio=s)},null,8,["modelValue"]),c(b,{id:"fecha_fin",label:"y",type:"date",class:"",modelValue:t.app.fechaFin,"onUpdate:modelValue":a[9]||(a[9]=s=>t.app.fechaFin=s)},null,8,["modelValue"])]),c(v,{label:"Buscar",onClick:t.sendForm,class:"mr-0 ml-auto mt-5",disabled:t.isFormEmpty},null,8,["onClick","disabled"])])}const z=I(ne,[["render",fe]]),P=p=>N({url:"/agenda_estimacion/filtros/",method:"GET",params:p||{}}),pe=p=>N({url:"/agenda_estimacion/busqueda/",method:"GET",params:p||{}}),_e="/maof-front/assets/Filter-fb6d2bbc.png";const be={props:{filtro:{type:Object,required:!0},getDocsByType:{type:Function,required:!0},saveFiltro:{type:Function,required:!0},esperandoAccion:{type:Function,required:!1}},components:{SelectBase:S,ButtonBase:E}},ve={class:"flex justify-start items-center pb-10"},ge=d("img",{src:_e,alt:"filter",class:"w-10 items-center"},null,-1);function he(p,a,e,t,o,y){const m=g("select-base"),b=g("button-base");return h(),q(A,null,[d("div",ve,[ge,c(m,{label:"Filtros",class:"text-center w-48 mr-9",id:"filtros",options:e.filtro.listFiltros,modelValue:e.filtro.tipoDocumento,"onUpdate:modelValue":a[0]||(a[0]=v=>e.filtro.tipoDocumento=v),onChange:a[1]||(a[1]=v=>e.getDocsByType(e.filtro.tipoDocumento))},null,8,["options","modelValue"]),e.filtro.listDocsFiltrados!==""&&e.filtro.tipoDocumento!==""&&e.filtro.tipoDocumento!=="4"?(h(),k(m,{key:0,label:"",class:"text-center w-48 ml-36",id:"filtrosDocs",options:e.filtro.listDocsFiltrados,modelValue:e.filtro.filtroDocValue,"onUpdate:modelValue":a[2]||(a[2]=v=>e.filtro.filtroDocValue=v)},null,8,["options","modelValue"])):w("",!0),e.filtro.listDocsFiltrados!==""&&e.filtro.tipoDocumento!==""&&e.filtro.tipoDocumento!=="4"?(h(),k(b,{key:1,label:"Aplicar",class:Q(["border-gray text-black hover:bg-white hover:text-red",{" ml-32":e.filtro.tipoDocumento==="1"," ml-[3.7rem]":e.filtro.tipoDocumento!=="1"&&e.filtro.filtroDocValue===""," ml-[0rem]":e.filtro.tipoDocumento!=="1"&&e.filtro.filtroDocValue!==""}]),onClick:a[3]||(a[3]=v=>e.saveFiltro(e.filtro.filtroDocValue,e.filtro.tipoDocumento)),disabled:e.filtro.filtroDocValue===""},null,8,["class","disabled"])):w("",!0),e.filtro.tipoDocumento==="4"?(h(),k(b,{key:2,label:"Aplicar",class:"ml-40 border-gray text-black hover:bg-white hover:text-red",onClick:a[4]||(a[4]=v=>e.esperandoAccion())})):w("",!0)]),W(" "+C(e.filtro.listDocsFiltrados)+" "+C(e.filtro.tipoDocumento),1)],64)}const ye=I(be,[["render",he]]),Fe="/maof-front/assets/Search-94489079.png",Ve={components:{ButtonBase:E,FormConsultaBusqueda:z},props:{showBusquedaValue:{type:Boolean,required:!0},showBusqueda:{type:Function,required:!0},saveBusqueda:{type:Function,required:!0}}},qe={class:"flex justify-start items-center pt-10"},Ce=d("img",{src:Fe,alt:"filter",class:"w-10 items-center"},null,-1),xe=d("h1",{class:"text-center font-bold text-lg"},"Búsqueda",-1),De={class:"flex justify-center"};function we(p,a,e,t,o,y){const m=g("button-base"),b=g("form-consulta-busqueda");return h(),q(A,null,[d("div",qe,[Ce,xe,c(m,{label:"Criterio de búsqueda",class:"ml-5 border-gray text-black hover:bg-white hover:text-red",onClick:e.showBusqueda},null,8,["onClick"])]),d("div",De,[e.showBusquedaValue?(h(),k(b,{key:0,onSubmit:e.saveBusqueda,class:"mt-20",showBusqueda:e.showBusqueda},null,8,["onSubmit","showBusqueda"])):w("",!0)])],64)}const Be=I(Ve,[["render",we]]);const ke={name:"UsersRolesMAOFIndex",components:{TableBase:L,ArrowBack:G,HomePage:J,ButtonBase:E,TitleBar:Z,SelectBase:S,FormConsultaBusqueda:z,Filtro:ye,Busqueda:Be,LogoutComponent:ie},setup(){const p=X(),a=le(),e=Y(),{rol:t}=e.getAuthData,o=O({filtro:{tipoDocumento:"",listFiltros:[{value:2,label:"Contrato o Convenio de Colaboración"},{value:3,label:"Convenio Modificatorio"},{value:4,label:"Esperando una acción"},{value:1,label:"Proyecto / Cartera de inversión"}],listDocsFiltrados:[],filtroDocValue:"",data:{pendientes:[],pagados:[],totales:[]}},loading:!0});let y=O(!1);const m=(i,_)=>{switch(_){case"pendientes":i.length>0?(a.addPendientes(i),p.push({name:"ConsultasPedientesMAOF"})):V.fire("No hay estimaciones","Intenta con otro filtro","warning");break;case"pagadas":i.length>0?(a.addPagados(i),p.push({name:"ConsultasPagadosMAOF"})):V.fire("No hay estimaciones","Intenta con otro filtro","warning");break;case"totales":i.length>0?(a.addTotal(i),p.push({name:"ConsultasTotalesMAOF"})):V.fire("No hay estimaciones","Intenta con otro filtro","warning");break;default:console.log("opcion invalida");break}},b=async i=>{switch(y.value===!0&&(y.value=!1),i){case"1":o.value.filtro.listDocsFiltrados=[],o.value.filtro.filtroDocValue="",v();break;case"2":o.value.filtro.listDocsFiltrados=[],o.value.filtro.filtroDocValue="",s(i);break;case"3":o.value.filtro.listDocsFiltrados=[],o.value.filtro.filtroDocValue="",s(i);break;case"4":o.value.filtro.listDocsFiltrados=[],o.value.filtro.filtroDocValue="";break;default:console.log("No se encontro nada");break}},v=async()=>{const i={estatus_proyecto:3,activate_filters:!0};try{const{data:_}=await se(i);o.value.filtro.listDocsFiltrados=_.map(r=>({value:r.id_proyecto,label:`${r.clave_cartera}-${r.nombre_proyecto}`}))}catch(_){V.fire("Error",`${_.response.data.detail}`,"error"),o.value.filtro.tipoDocumento="",o.value.filtro.filtroDocValue=""}},s=async i=>{const _={activate_filters:!0};try{const{data:r}=await R(_);i==="2"&&(r.forEach(n=>{n.id_tipo_contrato!==3&&o.value.filtro.listDocsFiltrados.push({value:n.id_contrato,label:n.numero_contrato})}),o.value.filtro.listDocsFiltrados.sort((n,F)=>n.label>F.label?1:n.label<F.label?-1:0)),i==="3"&&(r.forEach(n=>{n.id_tipo_contrato===3&&o.value.filtro.listDocsFiltrados.push({value:n.id_contrato,label:n.numero_contrato})}),o.value.filtro.listDocsFiltrados.sort((n,F)=>n.label>F.label?1:n.label<F.label?-1:0))}catch(r){V.fire("Error",`${r.response.data.detail}`,"error"),o.value.filtro.tipoDocumento="",o.value.filtro.filtroDocValue=""}},x=()=>{o.value.filtro.tipoDocumento="",o.value.filtro.filtroDocValue="",y.value=!y.value},D=(i,_,r)=>{a.addPendientes(i),a.addPagados(_),a.addTotal(r)},u=async()=>{o.value.loading=!0;try{const{data:i}=await P();o.value.filtro.data.totales=i.total,o.value.filtro.data.pagados=i.pagadas,o.value.filtro.data.pendientes=i.pendiente,D(i.pendiente,i.pagadas,i.total)}catch(i){V.fire("Error",`${i.response.data.detail}`,"error"),p.push({name:"Home"})}o.value.loading=!1},l=async i=>{const _=Object.entries(i).filter(([r,n])=>Array.isArray(n)?n.length>0:n!=="").reduce((r,[n,F])=>(Array.isArray(F)?r[n]=F.join(","):r[n]=F,r),{});try{const{data:r}=await pe(_);r.length?(a.addBusqueda(r),p.push({name:"ConsultasBusquedaMAOF"})):V.fire("Error","No hay resultados para estos criterios","error")}catch(r){V.fire("Error",`${r.response.data.detail}`,"error"),x()}},f=async(i,_)=>{o.value.loading=!0;let r={};_==="1"?r={id_proyecto:i}:(_==="2"||_==="3")&&(r={id_contrato:i});const{data:n}=await P(r);o.value.filtro.data.totales=n.total,o.value.filtro.data.pagados=n.pagadas,o.value.filtro.data.pendientes=n.pendiente,D(n.pendiente,n.pagadas,n.total),o.value.loading=!1},B=()=>{console.log("Se ejucuta funcion para esperando una opcion UwU")};return u(),{app:o,showBusquedaValue:y,rol:t,getStatusEstimations:m,showBusqueda:x,saveBusqueda:l,saveFiltro:f,getDocsByType:b,getProjects:v,getContracts:s,getFiltroDefault:u,infoToStore:D,esperandoAccion:B}}},Ae={class:"px-4 mt-10"},Ee={class:"flex justify-between"},Ie={class:"flex justify-center items-center"},Me={class:"text-black font-semibold mr-4 items-center content-center"},Se={class:"px-4"},Ue={key:0,class:"flex justify-center text-3xl"},Te={class:"text-center"},Oe=d("h1",{class:"text-center"},"Pendientes",-1),je={class:"text-center"},Pe=d("h1",{class:"text-center"},"Pagadas",-1),Ne={class:"text-center"},Re=d("h1",{class:"text-center"},"Total",-1),ze={class:"flex flex-col mt-20"};function He(p,a,e,t,o,y){const m=g("arrow-back"),b=g("home-page"),v=g("logout-component"),s=g("title-bar"),x=g("Filtro"),D=g("Busqueda");return h(),q("main",Ae,[d("div",Ee,[c(m),d("div",Ie,[d("p",Me,C(t.rol),1),c(b),c(v)])]),c(s,{title:"Consulta MAOF",subtitle:"Agenda de Estimaciones"}),d("section",Se,[t.app.loading?w("",!0):(h(),q("div",Ue,[d("div",{class:"px-10 text-red cursor-pointer",onClick:a[0]||(a[0]=u=>t.getStatusEstimations(t.app.filtro.data.pendientes,"pendientes"))},[d("p",Te,C(t.app.filtro.data.pendientes.length),1),Oe]),d("div",{class:"px-10 text-green cursor-pointer",onClick:a[1]||(a[1]=u=>t.getStatusEstimations(t.app.filtro.data.pagados,"pagadas"))},[d("p",je,C(t.app.filtro.data.pagados.length),1),Pe]),d("div",{class:"px-10 cursor-pointer",onClick:a[2]||(a[2]=u=>t.getStatusEstimations(t.app.filtro.data.totales,"totales"))},[d("p",Ne,C(t.app.filtro.data.totales.length),1),Re])])),d("div",ze,[c(x,{filtro:t.app.filtro,getDocsByType:t.getDocsByType,saveFiltro:t.saveFiltro,esperandoAccion:t.esperandoAccion},null,8,["filtro","getDocsByType","saveFiltro","esperandoAccion"]),c(D,{showBusquedaValue:t.showBusquedaValue,showBusqueda:t.showBusqueda,saveBusqueda:t.saveBusqueda},null,8,["showBusquedaValue","showBusqueda","saveBusqueda"])])])])}const nt=I(ke,[["render",He]]);export{nt as default};
