import{I as V}from"./InputBase-6623a586.js";import{B as k}from"./ButtonBase-61bcfff2.js";import{S as j}from"./SelectBase-393a96e3.js";import{T as z}from"./TextAreaBase-fb614be7.js";import{u as A,d as S,e as F}from"./residentEstimate-3de98119.js";import{_ as P,u as U,k as O,q,a as R,o as c,c as l,b as p,t as E,g as o,F as g,d as h,f as _,e as M}from"./index-83752335.js";import{S as n}from"./sweetalert2.all-281a79b7.js";import{u as L,c as f,m as w,a as C}from"./index-14344263.js";const N={name:"FormResidentEstimate",props:{editMode:{type:Boolean,default:!1},residentEstimate:{type:Object,default:()=>({})}},components:{InputBase:V,ButtonBase:k,SelectBase:j,TextAreaBase:z},setup(v){const t=Object.freeze({sendReviewArea:{id:3,obs_label:"Observaciones para el Área Revisora",title:"En esta fecha se enviará la Estimación al Área Revisora",exito:"Estimación enviada al Área Revisora con éxito!"},sendFinance:{id:5,obs_label:"Observaciones para Finanzas",title:"En esta fecha se enviará la Estimación a Finanzas",exito:"Estimación enviada Finanzas con éxito!"},returnToResident:{id:4,obs_label:"Observaciones para el Residente",title:"En esta fecha se regresará la Estimación al Residente",exito:"Estimación enviada al Residente con éxito!"},returnToReviewArea:{id:6,obs_label:"Observaciones para el Área Revisora",title:"En esta fecha se regresará la Estimación al Área Revisora",exito:"Estimación enviada al Área Revisora con éxito!"},sendToPaymentProcess:{id:7,obs_label:"Observaciones para el Trámite de Pago",title:"En esta fecha se regresará la Estimación al Trámite de Pago",exito:"Estimación enviada al Trámite de Pago con éxito!"},returnToFinance:{id:8,obs_label:"Observaciones para el Finanzas",title:"En esta fecha se regresará la Estimación a Finanzas",exito:"Estimación enviada al área de Finanzas con éxito!"},savePayment:{id:9,obs_label:"Observaciones para el Registro de Pago",title:"En esta fecha quedará Registro de Pago de la Estimación",exito:"Pago registrado con éxito!",warning_modal:{title:"Una vez registrado el pago no será posible modificar la Estimación. Esta acción no es reversible."}}}),b=U(),e=O({residentEstimate:{id_contrato:"",fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",importe_obra_ejecutada:"",importe_pagar:"",grado_avance_obra:"",porcentaje_avance_estimacion:"",porcentaje_avance_estimacion_acumulado:"",porcentaje_avance_fisico:"",porcensaje_avance_financiero:"",observaciones_residente:""},fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",contratoName:"",estatus_semaforo:"",fileInfo:{type:Object,default:()=>({})},listReviewAreas:[],listEmpleados:[],listContrato:[]}),x=r=>{let i=[];return i=r.split(" "),i=i[0].split("-"),i=i[0]+"-"+i[1]+"-"+i[2],r=i,r},B=()=>{let r=new Date;var i=("0"+r.getDate()).slice(-2),s=("0"+(r.getMonth()+1)).slice(-2),u=r.getFullYear(),y=u+"-"+s+"-"+i;return!(e.fecha_autorizacion_contratista>y)},d=q(()=>({porcentaje_avance_estimacion:{maxValue:f.withMessage("El valor maximo es 100%",w(100)),minValue:f.withMessage("El valor minimo es 0%",C(0))},porcentaje_avance_estimacion_acumulado:{maxValue:f.withMessage("El valor maximo es 100%",w(100)),minValue:f.withMessage("El valor minimo es 0%",C(0))},porcentaje_avance_fisico:{maxValue:f.withMessage("El valor maximo es 100%",w(100)),minValue:f.withMessage("El valor minimo es 0%",C(0))},porcensaje_avance_financiero:{maxValue:f.withMessage("El valor maximo es 100%",w(100)),minValue:f.withMessage("El valor minimo es 0%",C(0))},grado_avance_obra:{maxValue:f.withMessage("El valor maximo es 100%",w(100)),minValue:f.withMessage("El valor minimo es 0%",C(0))},fecha_autorizacion_contratista:{fechaActualFunction:f.withMessage("La fecha es mayor al dia de hoy",B)}})),m=L(d,v.residentEstimate);return v.editMode&&(e.residentEstimate=v.residentEstimate,e.estatus_semaforo=v,e.fecha_recepcion_info_contratista=x(v.residentEstimate.fecha_recepcion_info_contratista),v.residentEstimate.fecha_autorizacion_contratista===null?e.fecha_autorizacion_contratista=null:e.fecha_autorizacion_contratista=x(v.residentEstimate.fecha_autorizacion_contratista),e.fecha_periodo_inicio_estimacion=x(v.residentEstimate.fecha_periodo_inicio_estimacion),e.fecha_periodo_fin_estimacion=x(v.residentEstimate.fecha_periodo_fin_estimacion)),{STATUS:t,app:e,v$:m,editForm:()=>{var i=new Date().toLocaleTimeString("en-GB");e.residentEstimate.fecha_recepcion_info_contratista=e.fecha_recepcion_info_contratista+" "+i,e.fecha_autorizacion_contratista===null||e.fecha_autorizacion_contratista===""?e.residentEstimate.fecha_autorizacion_contratista=null:e.residentEstimate.fecha_autorizacion_contratista=e.fecha_autorizacion_contratista+" "+i,e.residentEstimate.fecha_periodo_inicio_estimacion=e.fecha_periodo_inicio_estimacion+" "+i,e.residentEstimate.fecha_periodo_fin_estimacion=e.fecha_periodo_fin_estimacion+" "+i,n.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async s=>{if(s.isConfirmed)try{await m.value.$validate()?(await A(e.residentEstimate),n.fire("¡Éxito!","Actualización con éxito!","success"),b.push({name:"ResidentEstimate"})):n.fire("Error","Revisa bien los datos","error")}catch(u){n.fire("Error",`${u.response.data.detail}`,"error")}})},deleteForm:()=>{n.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async r=>{if(r.isConfirmed)try{await S(e.residentEstimate,e.residentEstimate.id_estimacion),n.fire("¡Éxito!","Actualización con éxito!","success"),b.push({name:"ResidentEstimate"})}catch(i){n.fire("Error",`${i.response.data.detail}`,"error")}})},formatFecha:x,sendResident:async()=>{var i=new Date().toLocaleTimeString("en-GB");e.fecha_autorizacion_contratista===null?e.residentEstimate.fecha_autorizacion_contratista=null:e.residentEstimate.fecha_autorizacion_contratista=e.fecha_autorizacion_contratista+" "+i;try{const{value:s}=await n.fire({input:"textarea",inputLabel:"Observaciones para el residente",inputPlaceholder:"Escribe tus observaciones...",inputAttributes:{"aria-label":"Type your message here"},showCancelButton:!0,reverseButtons:!0,inputValidator:u=>{if(!u)return"El campo es requerido"}});s!==void 0?(await n.fire({title:"En esta fecha se enviará la Estimación a el residente",icon:"question",showCancelButton:!0,text:"¿Está usted seguro?",cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0})).isConfirmed&&(e.residentEstimate.observaciones_residente=s,await console.log("Enviar a el residente"),n.fire("¡Éxito!","Estimación enviada a el residente con éxito!","success"),b.push({name:"ResidentEstimate"})):n.fire("No agregaste ninguna observacion","Agrega uno para continuar","warning")}catch(s){n.fire("Error",`${s.response.data.detail}`,"error")}},returnToReviewArea:async()=>{new Date().toLocaleTimeString("en-GB");try{const{value:i}=await n.fire({input:"textarea",inputLabel:"Observaciones para el área revisora",inputPlaceholder:"Escribe tus observaciones...",inputAttributes:{"aria-label":"Type your message here"},showCancelButton:!0,reverseButtons:!0,inputValidator:s=>{if(!s)return"El campo es requerido"}});i!==void 0?(await n.fire({title:"En esta fecha se regresará la Estimación al área revisora",icon:"question",showCancelButton:!0,text:"¿Está usted seguro?",cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0})).isConfirmed&&(e.residentEstimate.observaciones_residente=i,await console.log("Regresar a area revisora"),n.fire("¡Éxito!","Estimación enviada al área revisora con éxito!","success"),b.push({name:"ResidentEstimate"})):n.fire("No agregaste ninguna observacion","Agrega uno para continuar","warning")}catch(i){n.fire("Error",`${i.response.data.detail}`,"error")}},sendToPaymentProcess:async()=>{new Date().toLocaleTimeString("en-GB");try{const{value:i}=await n.fire({input:"textarea",inputLabel:"Observaciones para trámite de pago",inputPlaceholder:"Escribe tus observaciones...",inputAttributes:{"aria-label":"Type your message here"},showCancelButton:!0,reverseButtons:!0,inputValidator:s=>{if(!s)return"El campo es requerido"}});i!==void 0?(await n.fire({title:"En esta fecha se enviará la Estimación a trámite de pago",icon:"question",showCancelButton:!0,text:"¿Está usted seguro?",cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0})).isConfirmed&&(e.residentEstimate.observaciones_residente=i,await console.log("Enviar a a trámite de pago"),n.fire("¡Éxito!","Estimación enviada a trámite de pago con éxito!","success"),b.push({name:"ResidentEstimate"})):n.fire("No agregaste ninguna observacion","Agrega uno para continuar","warning")}catch(i){n.fire("Error",`${i.response.data.detail}`,"error")}},sendFinance:async()=>{new Date().toLocaleTimeString("en-GB");try{const{value:i}=await n.fire({input:"textarea",inputLabel:"Observaciones para finanzas",inputPlaceholder:"Escribe tus observaciones...",inputAttributes:{"aria-label":"Type your message here"},showCancelButton:!0,reverseButtons:!0,inputValidator:s=>{if(!s)return"El campo es requerido"}});i!==void 0?(await n.fire({title:"En esta fecha se enviará la Estimación a finanzas",icon:"question",showCancelButton:!0,text:"¿Está usted seguro?",cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0})).isConfirmed&&(e.residentEstimate.observaciones_residente=i,await console.log("Enviar a finanzas"),n.fire("¡Éxito!","Estimación enviada finanzas con éxito!","success"),b.push({name:"ResidentEstimate"})):n.fire("No agregaste ninguna observacion","Agrega uno para continuar","warning")}catch(i){n.fire("Error",`${i.response.data.detail}`,"error")}},back:()=>b.push({name:"ResidentEstimate"}),goToArchivos:()=>b.push({name:"FilesResidentEstimate",params:{residentEstimateId:e.residentEstimate.id_estimacion}}),changeStatus:async r=>{new Date().toLocaleTimeString("en-GB");try{const{value:s}=await n.fire({input:"textarea",inputLabel:r.obs_label,inputPlaceholder:"Escribe tus observaciones...",inputAttributes:{"aria-label":"Type your message here"},showCancelButton:!0,reverseButtons:!0,inputValidator:u=>{if(!u)return"El campo es requerido"}});if(s!==void 0){const u=await n.fire({title:r.title,icon:"question",showCancelButton:!0,text:"¿Está usted seguro?",cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0});if(u.isConfirmed){let y=u.isConfirmed;if(r.warning_modal){const T=await n.fire({title:r.warning_modal.title,icon:"warning",showCancelButton:!0,text:"¿Está usted seguro?",cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0});y=y&&T.isConfirmed}y&&(await F(e.residentEstimate.id_estimacion,{estatus_estimacion:r.id,observaciones:s,id_estimacion:e.residentEstimate.id_estimacion}),n.fire("¡Éxito!",r.exito,"success"),b.push({name:"ResidentEstimate"}))}}else n.fire("No agregaste ninguna observacion","Agrega uno para continuar","warning")}catch(s){n.fire("Error",`${s.response.data.detail}`,"error")}}}}},I={class:"flex flex-row justify-between"},G={class:"font-bold text-lg"},D={class:"font-bold text-lg w-128"},Y={class:"flex content-start justify-end items-center mb-10"},H={class:"items-center justify-center"},J=p("h1",{class:"font-bold text-lg text-center"},"Número de la Estimación",-1),K={class:"text-center font-semibold text-lg numEstimacion"},Q={class:"max-w-xl mx-auto"},W={class:"flex flex-row"},X={key:0,class:"flex justify-between items-center py-4"},Z={key:1,class:"flex justify-between items-center py-4"},$={key:2,class:"flex justify-between items-center py-4"},ee={key:3,class:"flex justify-between items-center py-4"},ae={key:4,class:"flex justify-center items-center py-4"};function te(v,t,b,e,x,B){const d=R("button-base"),m=R("input-base");return c(),l(g,null,[p("div",I,[p("div",G,E(e.app.residentEstimate.numero_contrato),1),p("div",D," Objeto: "+E(e.app.residentEstimate.objeto_contrato),1),p("div",Y,[p("div",H,[J,p("p",K,E(e.app.residentEstimate.num_consecutivo_estimacion),1)])])]),o(d,{label:"Archivos",onClick:e.goToArchivos,class:"mb-3 mr-0 ml-auto"},null,8,["onClick"]),p("div",Q,[o(m,{id:"fecha_recepcion_info_contratista",label:"Fecha de recepción de información del Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_recepcion_info_contratista,"onUpdate:modelValue":t[0]||(t[0]=a=>e.app.fecha_recepcion_info_contratista=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"]),o(m,{id:"fecha_autorizacion_contratista",label:"Fecha de autorización al Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_autorizacion_contratista,"onUpdate:modelValue":t[1]||(t[1]=a=>e.app.fecha_autorizacion_contratista=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"]),e.v$.fecha_autorizacion_contratista.$error?(c(!0),l(g,{key:0},h(e.v$.fecha_autorizacion_contratista.$errors,a=>(c(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):_("",!0),p("div",W,[p("div",null,[o(m,{id:"fecha_periodo_inicio_estimacion",label:"Período de la Estimación",type:"date",modelValue:e.app.fecha_periodo_inicio_estimacion,"onUpdate:modelValue":t[2]||(t[2]=a=>e.app.fecha_periodo_inicio_estimacion=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"])]),p("div",null,[o(m,{id:"fecha_periodo_fin_estimacion",label:"al",type:"date",class:"pt-2",modelValue:e.app.fecha_periodo_fin_estimacion,"onUpdate:modelValue":t[3]||(t[3]=a=>e.app.fecha_periodo_fin_estimacion=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"])])]),o(m,{id:"importe_obra_ejecutada",label:"Importe de la obra ejecutada",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_obra_ejecutada,"onUpdate:modelValue":t[4]||(t[4]=a=>e.app.residentEstimate.importe_obra_ejecutada=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"]),o(m,{id:"importe_pagar",label:"Importe a pagar",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_pagar,"onUpdate:modelValue":t[5]||(t[5]=a=>e.app.residentEstimate.importe_pagar=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"]),o(m,{id:"grado_avance_obra",label:"% de grado de avance",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.grado_avance_obra,"onUpdate:modelValue":t[6]||(t[6]=a=>e.app.residentEstimate.grado_avance_obra=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"]),e.v$.grado_avance_obra.$error?(c(!0),l(g,{key:1},h(e.v$.grado_avance_obra.$errors,a=>(c(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):_("",!0),o(m,{id:"porcentaje_avance_estimacion",label:"% de avance de la Estimación",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion,"onUpdate:modelValue":t[7]||(t[7]=a=>e.app.residentEstimate.porcentaje_avance_estimacion=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"]),e.v$.porcentaje_avance_estimacion.$error?(c(!0),l(g,{key:2},h(e.v$.porcentaje_avance_estimacion.$errors,a=>(c(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):_("",!0),o(m,{id:"porcentaje_avance_estimacion_acumulado",label:"% de avance de la Estimación acumulado",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion_acumulado,"onUpdate:modelValue":t[8]||(t[8]=a=>e.app.residentEstimate.porcentaje_avance_estimacion_acumulado=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"]),e.v$.porcentaje_avance_estimacion_acumulado.$error?(c(!0),l(g,{key:3},h(e.v$.porcentaje_avance_estimacion_acumulado.$errors,a=>(c(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):_("",!0),o(m,{id:"porcentaje_avance_fisico",label:"% de avance físico",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_fisico,"onUpdate:modelValue":t[9]||(t[9]=a=>e.app.residentEstimate.porcentaje_avance_fisico=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"]),e.v$.porcentaje_avance_fisico.$error?(c(!0),l(g,{key:4},h(e.v$.porcentaje_avance_fisico.$errors,a=>(c(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):_("",!0),o(m,{id:"porcensaje_avance_financiero",label:"% de avance financiero",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcensaje_avance_financiero,"onUpdate:modelValue":t[10]||(t[10]=a=>e.app.residentEstimate.porcensaje_avance_financiero=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"]),e.v$.porcensaje_avance_financiero.$error?(c(!0),l(g,{key:5},h(e.v$.porcensaje_avance_financiero.$errors,a=>(c(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):_("",!0)]),e.app.residentEstimate.estatus_semaforo==="Residente"?(c(),l("div",X,[e.app.residentEstimate.estatus_estimacion==="Capturada por Residente"||e.app.residentEstimate.estatus_estimacion==="Autorizada por Residente"?(c(),M(d,{key:0,label:"Inactivar Estimación",class:"px-4",onClick:e.deleteForm},null,8,["onClick"])):_("",!0),o(d,{label:"Actualizar datos",class:"px-4",onClick:e.editForm},null,8,["onClick"]),o(d,{label:"Enviar al área revisora",class:"px-4",onClick:t[11]||(t[11]=a=>e.changeStatus(e.STATUS.sendReviewArea))})])):_("",!0),e.app.residentEstimate.estatus_semaforo==="Area Revisora"?(c(),l("div",Z,[o(d,{label:"Regresar a  Residente",class:"px-4",onClick:t[12]||(t[12]=a=>e.changeStatus(e.STATUS.returnToResident))}),o(d,{label:"Cancelar",class:"px-4",onClick:e.back},null,8,["onClick"]),o(d,{label:"Enviar a finanzas",class:"px-4",onClick:t[13]||(t[13]=a=>e.changeStatus(e.STATUS.sendFinance))})])):_("",!0),e.app.residentEstimate.estatus_semaforo==="Finanzas"?(c(),l("div",$,[o(d,{label:"Regresar al área revisora",class:"px-4",onClick:t[14]||(t[14]=a=>e.changeStatus(e.STATUS.returnToReviewArea))}),o(d,{label:"Cancelar",class:"px-4",onClick:e.back},null,8,["onClick"]),o(d,{label:"Enviar a trámite de pago",class:"px-4",onClick:t[15]||(t[15]=a=>e.changeStatus(e.STATUS.sendToPaymentProcess))})])):_("",!0),e.app.residentEstimate.estatus_semaforo==="DGPOP"?(c(),l("div",ee,[o(d,{label:"Regresar a Finanzas",class:"px-4",onClick:t[16]||(t[16]=a=>e.changeStatus(e.STATUS.returnToFinance))}),o(d,{label:"Cancelar",class:"px-4",onClick:e.back},null,8,["onClick"]),o(d,{label:"Registrar Pago",class:"px-4",onClick:t[17]||(t[17]=a=>e.changeStatus(e.STATUS.savePayment))})])):_("",!0),e.app.residentEstimate.estatus_semaforo==="Pago Efectuado"?(c(),l("div",ae,[o(d,{label:"Regresar",class:"px-4",onClick:e.back},null,8,["onClick"])])):_("",!0)],64)}const ge=P(N,[["render",te]]);export{ge as F};
