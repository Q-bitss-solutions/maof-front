import{T}from"./TableUsers-23acfcfe.js";import{g as O,A as P}from"./ArrowBack-5369885d.js";import{H as j}from"./HomePage-a1ea4d81.js";import{S as k}from"./SelectBase-f1ad2f81.js";import{B}from"./ButtonBase-47fb9ccf.js";import{_ as x,l as N,s as R,a as v,o as g,c as C,g as f,b as u,e as V,f as q,n as z,F as H,u as G,r as E,t as w}from"./index-733385a3.js";import{f as J,T as Y}from"./fetchApi-8b9134ef.js";import{I as K}from"./InputBase-6c0b0bec.js";import{f as I}from"./contract-0ffe027f.js";import{f as L}from"./resident-2499167f.js";import{a as Q}from"./SICTUnits-a83474d2.js";import{k as W}from"./residentEstimate-5b7f6361.js";import{S as A}from"./sweetalert2.all-281a79b7.js";import{b as X}from"./project-d924c2fa.js";import{c as Z}from"./consultas-5af85a37.js";const $={name:"FormProject",props:{editMode:{type:Boolean,default:!1},project:{type:Object,default:()=>({})}},components:{InputBase:K,ButtonBase:B,SelectBase:k},setup(p,{emit:a}){const e=N({busqueda:{id_contrato:"",id_residente:"",mes_estimacion:"",año_estimacion:"",estatus_estimacion:"",unidad_maof:"",dias_transcurridos:[],fechas_autorizacion:[]},listMesEstimacion:[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiempbre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}],diasInicio:"",diasFin:"",fechaInicio:"",fechaFin:"",listAnios:[],listC_CC_CM:[],listResident:[],listUnitMAOF:[],listStatusEstimate:[]}),t=R(()=>{const{id_contrato:b,id_residente:o,mes_estimacion:d,año_estimacion:s,estatus_estimacion:n,unidad_maof:l}=e.busqueda,{diasInicio:r,diasFin:F}=e;return!b&&!o&&!d&&!s&&!n&&!l&&!r&&!F}),h=async()=>{const{data:b}=await I();e.listC_CC_CM=b.map(o=>({value:o.id_contrato,label:o.numero_contrato})),e.listC_CC_CM.sort((o,d)=>o.label>d.label?1:o.label<d.label?-1:0)},y=async()=>{const{data:b}=await L();e.listResident=b.map(o=>({value:o.id_residente,label:o.nombre_completo})),e.listResident.sort((o,d)=>o.label>d.label?1:o.label<d.label?-1:0)},c=async()=>{const{data:b}=await Q();e.listUnitMAOF=b.map(o=>({value:o.id_unidad_maof,label:o.unidad})),e.listUnitMAOF.sort((o,d)=>o.label>d.label?1:o.label<d.label?-1:0)},m=async()=>{const{data:b}=await W();e.listStatusEstimate=b.map(o=>({value:o.clave_estatus_estimacion,label:o.estatus_estimacion})),e.listStatusEstimate.sort((o,d)=>o.label>d.label?1:o.label<d.label?-1:0)},_=b=>{const o=new Date().getFullYear();for(let d=0;d<b;d++)e.listAnios.push({value:o+d,label:`${o+d}`});console.log("Años generados",e.listAnios)},i=()=>{e.diasInicio!==""&&(e.busqueda.dias_transcurridos.push(e.diasInicio),e.diasInicio=""),e.diasFin!==""&&(e.busqueda.dias_transcurridos.push(e.diasFin),e.diasFin=""),e.fechaInicio!==""&&(e.busqueda.fechas_autorizacion.push(e.fechaInicio),e.fechaInicio=""),e.fechaFin!==""&&(e.busqueda.fechas_autorizacion.push(e.fechaFin),e.fechaFin=""),a("submit",e.busqueda)};return h(),y(),c(),m(),_(10),{app:e,isFormEmpty:t,sendForm:i,getC_CC_CM:h,getResident:y,getUnitMAOF:c,getStatusEstimate:m,generateAnios:_}}},ee={class:"max-w-6xl pb-10 grow"},te=u("p",{class:"w-[17rem]"},"*Contrato, Convenio de Colaboración, Convenio Modificatorio",-1),ae={class:"grid grid-cols-2"},oe={class:"grid grid-cols-2 pt-3"};function se(p,a,e,t,h,y){const c=v("select-base"),m=v("input-base"),_=v("button-base");return g(),C("div",ee,[te,f(c,{id:"clave_cartera",label:"C, CC, CM*",options:t.app.listC_CC_CM,class:"mb-3",modelValue:t.app.busqueda.id_contrato,"onUpdate:modelValue":a[0]||(a[0]=i=>t.app.busqueda.id_contrato=i)},null,8,["options","modelValue"]),f(c,{id:"nombre_proyecto",label:"Residente",options:t.app.listResident,class:"mb-3",modelValue:t.app.busqueda.id_residente,"onUpdate:modelValue":a[1]||(a[1]=i=>t.app.busqueda.id_residente=i)},null,8,["options","modelValue"]),f(c,{id:"nombre_proyecto",label:"Mes de la Estimación",options:t.app.listMesEstimacion,class:"mb-3",modelValue:t.app.busqueda.mes_estimacion,"onUpdate:modelValue":a[2]||(a[2]=i=>t.app.busqueda.mes_estimacion=i)},null,8,["options","modelValue"]),f(c,{id:"nombre_proyecto",label:"Año de la Estimación",options:t.app.listAnios,class:"mb-3",modelValue:t.app.busqueda.año_estimacion,"onUpdate:modelValue":a[3]||(a[3]=i=>t.app.busqueda.año_estimacion=i)},null,8,["options","modelValue"]),f(c,{id:"nombre_proyecto",label:"Estatus de la Estimación",class:"mb-3",options:t.app.listStatusEstimate,modelValue:t.app.busqueda.estatus_estimacion,"onUpdate:modelValue":a[4]||(a[4]=i=>t.app.busqueda.estatus_estimacion=i)},null,8,["options","modelValue"]),f(c,{id:"nombre_proyecto",label:"Unidad MAOF responsable",options:t.app.listUnitMAOF,class:"mb-3",modelValue:t.app.busqueda.unidad_maof,"onUpdate:modelValue":a[5]||(a[5]=i=>t.app.busqueda.unidad_maof=i)},null,8,["options","modelValue"]),u("div",ae,[f(m,{id:"dias_inicio",label:"Días transcurridos del",type:"number",class:"grow",modelValue:t.app.diasInicio,"onUpdate:modelValue":a[6]||(a[6]=i=>t.app.diasInicio=i)},null,8,["modelValue"]),f(m,{id:"dias_fin",label:"al",type:"number",class:"flex-auto",modelValue:t.app.diasFin,"onUpdate:modelValue":a[7]||(a[7]=i=>t.app.diasFin=i)},null,8,["modelValue"])]),u("div",oe,[f(m,{id:"fecha_inicio",label:"Autorización entre",type:"date",class:"grow",modelValue:t.app.fechaInicio,"onUpdate:modelValue":a[8]||(a[8]=i=>t.app.fechaInicio=i)},null,8,["modelValue"]),f(m,{id:"fecha_fin",label:"y",type:"date",class:"",modelValue:t.app.fechaFin,"onUpdate:modelValue":a[9]||(a[9]=i=>t.app.fechaFin=i)},null,8,["modelValue"])]),f(_,{label:"Buscar",onClick:t.sendForm,class:"mr-0 ml-auto mt-5",disabled:t.isFormEmpty},null,8,["onClick","disabled"])])}const S=x($,[["render",se]]),le=O(),U=p=>J({...p,headers:le}),M=p=>U({url:"/agenda_estimacion/filtros/",method:"GET",params:p||{}}),ie=p=>U({url:"/agenda_estimacion/busqueda/",method:"GET",params:p||{}}),ne="/maof-front/assets/Filter-fb6d2bbc.png";const re={props:{filtro:{type:Object,required:!0},getDocsByType:{type:Function,required:!0},saveFiltro:{type:Function,required:!0},esperandoAccion:{type:Function,required:!1}},components:{SelectBase:k,ButtonBase:B}},de={class:"flex justify-start items-center pb-10"},ue=u("img",{src:ne,alt:"filter",class:"w-10 items-center"},null,-1);function ce(p,a,e,t,h,y){const c=v("select-base"),m=v("button-base");return g(),C("div",de,[ue,f(c,{label:"Filtros",class:"text-center w-48 mr-10",id:"filtros",options:e.filtro.listFiltros,modelValue:e.filtro.tipoDocumento,"onUpdate:modelValue":a[0]||(a[0]=_=>e.filtro.tipoDocumento=_),onChange:a[1]||(a[1]=_=>e.getDocsByType(e.filtro.tipoDocumento))},null,8,["options","modelValue"]),e.filtro.listDocsFiltrados!==""&&e.filtro.tipoDocumento!==""?(g(),V(c,{key:0,label:"",class:"text-center w-48 ml-36",id:"filtrosDocs",options:e.filtro.listDocsFiltrados,modelValue:e.filtro.filtroDocValue,"onUpdate:modelValue":a[2]||(a[2]=_=>e.filtro.filtroDocValue=_)},null,8,["options","modelValue"])):q("",!0),e.filtro.listDocsFiltrados!==""&&e.filtro.tipoDocumento!==""?(g(),V(m,{key:1,label:"Aplicar",class:z(["border-gray text-black hover:bg-white hover:text-red",{"ml-[36rem]":e.filtro.tipoDocumento==="1"," ml-[3.7rem]":e.filtro.tipoDocumento!=="1"&&e.filtro.filtroDocValue===""," ml-[0rem]":e.filtro.tipoDocumento!=="1"&&e.filtro.filtroDocValue!==""}]),onClick:a[3]||(a[3]=_=>e.saveFiltro(e.filtro.filtroDocValue,e.filtro.tipoDocumento)),disabled:e.filtro.filtroDocValue===""},null,8,["class","disabled"])):q("",!0),e.filtro.tipoDocumento==="4"?(g(),V(m,{key:2,label:"Aplicar",class:"ml-40 border-gray text-black hover:bg-white hover:text-red",onClick:a[4]||(a[4]=_=>e.esperandoAccion())})):q("",!0)])}const me=x(re,[["render",ce]]),fe="/maof-front/assets/Search-94489079.png",pe={components:{ButtonBase:B,FormConsultaBusqueda:S},props:{showBusquedaValue:{type:Boolean,required:!0},showBusqueda:{type:Function,required:!0},saveBusqueda:{type:Function,required:!0}}},be={class:"flex justify-start items-center pt-10"},_e=u("img",{src:fe,alt:"filter",class:"w-10 items-center"},null,-1),ve=u("h1",{class:"text-center font-bold text-lg"},"Búsqueda",-1),ge={class:"flex justify-center"};function he(p,a,e,t,h,y){const c=v("button-base"),m=v("form-consulta-busqueda");return g(),C(H,null,[u("div",be,[_e,ve,f(c,{label:"Criterio de búsqueda",class:"ml-5 border-gray text-black hover:bg-white hover:text-red",onClick:e.showBusqueda},null,8,["onClick"])]),u("div",ge,[e.showBusquedaValue?(g(),V(m,{key:0,onSubmit:e.saveBusqueda,class:"mt-20"},null,8,["onSubmit"])):q("",!0)])],64)}const ye=x(pe,[["render",he]]);const Fe={name:"UsersRolesMAOFIndex",components:{TableBase:T,ArrowBack:P,HomePage:j,ButtonBase:B,TitleBar:Y,SelectBase:k,FormConsultaBusqueda:S,Filtro:me,Busqueda:ye},setup(){const p=G(),a=Z(),e=E({filtro:{tipoDocumento:"",listFiltros:[{value:2,label:"Contrato o Convenio de Colaboración"},{value:3,label:"Convenio Modificatorio"},{value:1,label:"Proyecto / Cartera de inversión"}],listDocsFiltrados:[],filtroDocValue:"",data:{pendientes:[],pagados:[],totales:[]}},loading:!0});let t=E(!1);const h=(s,n)=>{switch(n){case"pendientes":s.length>0?(a.addPendientes(s),p.push({name:"ConsultasPedientesMAOF"})):(console.log("No hay estimaciones pendientes"),A.fire("No hay estimaciones","Intenta con otro filtro","warning"));break;case"pagadas":s.length>0?(a.addPagados(s),p.push({name:"ConsultasPagadosMAOF"})):(console.log("No hay estimaciones pagadas"),A.fire("No hay estimaciones","Intenta con otro filtro","warning"));break;case"totales":s.length>0?(a.addTotal(s),p.push({name:"ConsultasTotalesMAOF"})):(console.log("No hay estimaciones totales"),A.fire("No hay estimaciones","Intenta con otro filtro","warning"));break;default:console.log("opcion invalida");break}},y=async s=>{switch(t.value===!0&&(t.value=!1),s){case"1":e.value.filtro.listDocsFiltrados=[],e.value.filtro.filtroDocValue="",c();break;case"2":e.value.filtro.listDocsFiltrados=[],e.value.filtro.filtroDocValue="",m(s);break;case"3":e.value.filtro.listDocsFiltrados=[],e.value.filtro.filtroDocValue="",m(s);break;case"4":e.value.filtro.listDocsFiltrados=[],e.value.filtro.filtroDocValue="";break;default:console.log("No se encontro nada");break}},c=async()=>{const{data:s}=await X();e.value.filtro.listDocsFiltrados=s.map(n=>({value:n.id_proyecto,label:`${n.clave_cartera}-${n.nombre_proyecto}`}))},m=async s=>{const{data:n}=await I();s==="2"&&(n.forEach(l=>{l.id_tipo_contrato!==3&&e.value.filtro.listDocsFiltrados.push({value:l.id_contrato,label:l.numero_contrato})}),e.value.filtro.listDocsFiltrados.sort((l,r)=>l.label>r.label?1:l.label<r.label?-1:0)),s==="3"&&(n.forEach(l=>{l.id_tipo_contrato===3&&e.value.filtro.listDocsFiltrados.push({value:l.id_contrato,label:l.numero_contrato})}),e.value.filtro.listDocsFiltrados.sort((l,r)=>l.label>r.label?1:l.label<r.label?-1:0))},_=()=>{e.value.filtro.tipoDocumento="",e.value.filtro.filtroDocValue="",t.value=!t.value},i=(s,n,l)=>{a.addPendientes(s),a.addPagados(n),a.addTotal(l)},b=async()=>{e.value.loading=!0;let s=[],n=[];const{data:l}=await M();l.forEach(r=>{r.estatus_semaforo!=="Pago Efectuado"?n.push(r):s.push(r)}),e.value.filtro.data.totales=l,e.value.filtro.data.pagados=s,e.value.filtro.data.pendientes=n,i(n,s,l),e.value.loading=!1},o=async s=>{console.log("Criterios de busqueda: ",s);const n=Object.entries(s).filter(([r,F])=>Array.isArray(F)?F.length>0:F!=="").reduce((r,[F,D])=>(Array.isArray(D)?r[F]=D.join(","):r[F]=D,r),{});console.log("params: ",n);const{data:l}=await ie(n);console.log("data:",l),a.addBusqueda(l),console.log("store:",a.busqueda),p.push({name:"ConsultasBusquedaMAOF"})},d=async(s,n)=>{e.value.loading=!0;let l={};n==="1"?l={id_proyecto:s}:(n==="2"||n==="3")&&(l={id_contrato:s});const{data:r}=await M(l);e.value.filtro.data.totales=r.total,e.value.filtro.data.pagados=r.pagadas,e.value.filtro.data.pendientes=r.pendiente,i(r.pendiente,r.pagadas,r.total),e.value.loading=!1};return b(),{app:e,showBusquedaValue:t,getStatusEstimations:h,showBusqueda:_,saveBusqueda:o,saveFiltro:d,getDocsByType:y,getProjects:c,getContracts:m,getFiltroDefault:b,infoToStore:i}}},qe={class:"px-4 mt-10"},Ce={class:"flex justify-between"},Ve={class:"px-4"},Be={key:0,class:"flex justify-center text-3xl"},xe={class:"text-center"},De=u("h1",{class:"text-center"},"Pendientes",-1),we={class:"text-center"},Ae=u("h1",{class:"text-center"},"Pagadas",-1),ke={class:"text-center"},Ee=u("h1",{class:"text-center"},"Total",-1),Me={class:"flex flex-col mt-20"};function Ie(p,a,e,t,h,y){const c=v("arrow-back"),m=v("home-page"),_=v("title-bar"),i=v("Filtro"),b=v("Busqueda");return g(),C("main",qe,[u("div",Ce,[f(c),f(m)]),f(_,{title:"Consulta MAOF",subtitle:"Agenda de Estimaciones"}),u("section",Ve,[t.app.loading?q("",!0):(g(),C("div",Be,[u("div",{class:"px-10 text-red cursor-pointer",onClick:a[0]||(a[0]=o=>t.getStatusEstimations(t.app.filtro.data.pendientes,"pendientes"))},[u("p",xe,w(t.app.filtro.data.pendientes.length),1),De]),u("div",{class:"px-10 text-green cursor-pointer",onClick:a[1]||(a[1]=o=>t.getStatusEstimations(t.app.filtro.data.pagados,"pagadas"))},[u("p",we,w(t.app.filtro.data.pagados.length),1),Ae]),u("div",{class:"px-10 cursor-pointer",onClick:a[2]||(a[2]=o=>t.getStatusEstimations(t.app.filtro.data.totales,"totales"))},[u("p",ke,w(t.app.filtro.data.totales.length),1),Ee])])),u("div",Me,[f(i,{filtro:t.app.filtro,getDocsByType:t.getDocsByType,saveFiltro:t.saveFiltro},null,8,["filtro","getDocsByType","saveFiltro"]),f(b,{showBusquedaValue:t.showBusquedaValue,showBusqueda:t.showBusqueda,saveBusqueda:t.saveBusqueda},null,8,["showBusquedaValue","showBusqueda","saveBusqueda"])])])])}const Qe=x(Fe,[["render",Ie]]);export{Qe as default};
