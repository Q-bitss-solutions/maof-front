import{T as G}from"./TableUsers-4882459a.js";import{A as H}from"./ArrowBack-fd64ea0e.js";import{H as J}from"./HomePage-09835846.js";import{S}from"./SelectBase-b0c6035b.js";import{B as E,a as R}from"./fetchApi-d28bf2c1.js";import{_ as I,m as K,s as U,b as g,o as h,c as F,e as m,d as r,F as M,f as T,t as w,h as C,g as A,n as Q,u as W,a as X,r as O}from"./index-2a48b7f4.js";import{T as Y}from"./TitleBar-0949630f.js";import{I as Z}from"./InputBase-1bb0147f.js";import{f as N}from"./contract-de1202fb.js";import{f as $}from"./resident-28ac4dac.js";import{a as ee}from"./SICTUnits-7d57e97e.js";import{k as te}from"./residentEstimate-9da828df.js";import{S as D}from"./sweetalert2.all-281a79b7.js";import{u as ae,c as k,a as P}from"./index-8d44e99d.js";import{b as oe}from"./project-ca24e4e1.js";import{c as se}from"./consultas-d34bc621.js";import{L as le}from"./LogoutComponent-c111ff45.js";const ie={name:"FormProject",props:{editMode:{type:Boolean,default:!1},project:{type:Object,default:()=>({})}},components:{InputBase:Z,ButtonBase:E,SelectBase:S},setup(v,{emit:a}){const e=K({busqueda:{id_contrato:"",id_residente:"",mes_estimacion:"",año_estimacion:"",estatus_estimacion:"",unidad_maof:"",dias_transcurridos:[],fechas_autorizacion:[]},listMesEstimacion:[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiempbre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}],diasInicio:"",diasFin:"",fechaInicio:"",fechaFin:"",listAnios:[],listC_CC_CM:[],listResident:[],listUnitMAOF:[],listStatusEstimate:[]}),t=U(()=>({diasFin:{minValue:k.withMessage("El valor mínimo es 1",P(1)),customValidation:k.withMessage("El valor de días inicio debe ser menor que días fin",d=>e.diasInicio!==""&&e.diasFin!==""?e.diasInicio<e.diasFin:!0)},diasInicio:{minValue:k.withMessage("El valor mínimo es 0",P(0)),customValidation:k.withMessage("El valor de días inicio debe ser menor que días fin",d=>e.diasInicio!==""&&e.diasFin!==""?e.diasInicio<e.diasFin:!0)}})),o=ae(t,e),y=U(()=>{const{id_contrato:d,id_residente:s,mes_estimacion:p,año_estimacion:i,estatus_estimacion:u,unidad_maof:n}=e.busqueda,{diasInicio:c,diasFin:V,fechaInicio:B,fechaFin:L}=e;return!d&&!s&&!p&&!i&&!u&&!n&&!c&&!V&&!B&&!L}),f=async()=>{const{data:d}=await N();e.listC_CC_CM=d.map(s=>({value:s.id_contrato,label:s.numero_contrato})),e.listC_CC_CM.sort((s,p)=>s.label>p.label?1:s.label<p.label?-1:0)},_=async()=>{const{data:d}=await $();e.listResident=d.map(s=>({value:s.id_residente,label:s.nombre_completo})),e.listResident.sort((s,p)=>s.label>p.label?1:s.label<p.label?-1:0)},b=async()=>{const{data:d}=await ee();e.listUnitMAOF=d.map(s=>({value:s.id_unidad_maof,label:s.unidad})),e.listUnitMAOF.sort((s,p)=>s.label>p.label?1:s.label<p.label?-1:0)},l=async()=>{const{data:d}=await te();e.listStatusEstimate=d.map(s=>({value:s.clave_estatus_estimacion,label:s.estatus_estimacion})),e.listStatusEstimate.sort((s,p)=>s.label>p.label?1:s.label<p.label?-1:0)},x=d=>{for(let s=0;s<d;s++)e.listAnios.push({value:2023+s,label:`${2023+s}`})},q=async()=>{if(await o.value.$validate())e.diasInicio!==""&&(e.busqueda.dias_transcurridos.push(e.diasInicio),e.diasInicio=""),e.diasFin!==""&&(e.busqueda.dias_transcurridos.push(e.diasFin),e.diasFin=""),e.fechaInicio!==""&&(e.busqueda.fechas_autorizacion.push(e.fechaInicio),e.fechaInicio=""),e.fechaFin!==""&&(e.busqueda.fechas_autorizacion.push(e.fechaFin),e.fechaFin=""),a("submit",e.busqueda);else{let s="";o.value.$errors.forEach(p=>{s=p.$message}),D.fire("¡Error!",`${s}`,"error")}};return f(),_(),b(),l(),x(10),{app:e,isFormEmpty:y,v$:o,sendForm:q,getC_CC_CM:f,getResident:_,getUnitMAOF:b,getStatusEstimate:l,generateAnios:x}}},ne={class:"max-w-6xl pb-10 grow"},re=r("p",{class:"w-[17rem]"},"*Contrato, Convenio de Colaboración, Convenio Modificatorio",-1),de={class:"grid grid-cols-2"},ue={class:"grid"},ce={class:"grid grid-cols-2 pt-3"};function me(v,a,e,t,o,y){const f=g("select-base"),_=g("input-base"),b=g("button-base");return h(),F("div",ne,[re,m(f,{id:"clave_cartera",label:"C, CC, CM*",options:t.app.listC_CC_CM,class:"mb-3",modelValue:t.app.busqueda.id_contrato,"onUpdate:modelValue":a[0]||(a[0]=l=>t.app.busqueda.id_contrato=l)},null,8,["options","modelValue"]),m(f,{id:"nombre_proyecto",label:"Residente",options:t.app.listResident,class:"mb-3",modelValue:t.app.busqueda.id_residente,"onUpdate:modelValue":a[1]||(a[1]=l=>t.app.busqueda.id_residente=l)},null,8,["options","modelValue"]),m(f,{id:"nombre_proyecto",label:"Mes de la Estimación",options:t.app.listMesEstimacion,class:"mb-3",modelValue:t.app.busqueda.mes_estimacion,"onUpdate:modelValue":a[2]||(a[2]=l=>t.app.busqueda.mes_estimacion=l)},null,8,["options","modelValue"]),m(f,{id:"nombre_proyecto",label:"Año de la Estimación",options:t.app.listAnios,class:"mb-3",modelValue:t.app.busqueda.año_estimacion,"onUpdate:modelValue":a[3]||(a[3]=l=>t.app.busqueda.año_estimacion=l)},null,8,["options","modelValue"]),m(f,{id:"nombre_proyecto",label:"Estatus de la Estimación",class:"mb-3",options:t.app.listStatusEstimate,modelValue:t.app.busqueda.estatus_estimacion,"onUpdate:modelValue":a[4]||(a[4]=l=>t.app.busqueda.estatus_estimacion=l)},null,8,["options","modelValue"]),m(f,{id:"nombre_proyecto",label:"Unidad MAOF responsable",options:t.app.listUnitMAOF,class:"mb-3",modelValue:t.app.busqueda.unidad_maof,"onUpdate:modelValue":a[5]||(a[5]=l=>t.app.busqueda.unidad_maof=l)},null,8,["options","modelValue"]),r("div",de,[m(_,{id:"dias_inicio",label:"Días transcurridos del",type:"number",class:"grow",modelValue:t.app.diasInicio,"onUpdate:modelValue":a[6]||(a[6]=l=>t.app.diasInicio=l)},null,8,["modelValue"]),m(_,{id:"dias_fin",label:"al",type:"number",class:"flex-auto",modelValue:t.app.diasFin,"onUpdate:modelValue":a[7]||(a[7]=l=>t.app.diasFin=l)},null,8,["modelValue"])]),r("div",ue,[t.v$.diasInicio.$error?(h(!0),F(M,{key:0},T(t.v$.diasInicio.$errors,l=>(h(),F("span",{key:l,class:"text-red font-semibold text-center ml-80"},w(l.$message),1))),128)):C("",!0),t.v$.diasFin.$error?(h(!0),F(M,{key:1},T(t.v$.diasFin.$errors,l=>(h(),F("span",{key:l,class:"text-red font-semibold text-center ml-80"},w(l.$message),1))),128)):C("",!0)]),r("div",ce,[m(_,{id:"fecha_inicio",label:"Autorización entre",type:"date",class:"grow",modelValue:t.app.fechaInicio,"onUpdate:modelValue":a[8]||(a[8]=l=>t.app.fechaInicio=l)},null,8,["modelValue"]),m(_,{id:"fecha_fin",label:"y",type:"date",class:"",modelValue:t.app.fechaFin,"onUpdate:modelValue":a[9]||(a[9]=l=>t.app.fechaFin=l)},null,8,["modelValue"])]),m(b,{label:"Buscar",onClick:t.sendForm,class:"mr-0 ml-auto mt-5",disabled:t.isFormEmpty},null,8,["onClick","disabled"])])}const z=I(ie,[["render",me]]),j=v=>R({url:"/agenda_estimacion/filtros/",method:"GET",params:v||{}}),fe=v=>R({url:"/agenda_estimacion/busqueda/",method:"GET",params:v||{}}),pe="/maof-front/assets/Filter-fb6d2bbc.png";const _e={props:{filtro:{type:Object,required:!0},getDocsByType:{type:Function,required:!0},saveFiltro:{type:Function,required:!0},esperandoAccion:{type:Function,required:!1}},components:{SelectBase:S,ButtonBase:E}},be={class:"flex justify-start items-center pb-10"},ve=r("img",{src:pe,alt:"filter",class:"w-10 items-center"},null,-1);function ge(v,a,e,t,o,y){const f=g("select-base"),_=g("button-base");return h(),F("div",be,[ve,m(f,{label:"Filtros",class:"text-center w-48 mr-10",id:"filtros",options:e.filtro.listFiltros,modelValue:e.filtro.tipoDocumento,"onUpdate:modelValue":a[0]||(a[0]=b=>e.filtro.tipoDocumento=b),onChange:a[1]||(a[1]=b=>e.getDocsByType(e.filtro.tipoDocumento))},null,8,["options","modelValue"]),e.filtro.listDocsFiltrados!==""&&e.filtro.tipoDocumento!==""?(h(),A(f,{key:0,label:"",class:"text-center w-48 ml-36",id:"filtrosDocs",options:e.filtro.listDocsFiltrados,modelValue:e.filtro.filtroDocValue,"onUpdate:modelValue":a[2]||(a[2]=b=>e.filtro.filtroDocValue=b)},null,8,["options","modelValue"])):C("",!0),e.filtro.listDocsFiltrados!==""&&e.filtro.tipoDocumento!==""?(h(),A(_,{key:1,label:"Aplicar",class:Q(["border-gray text-black hover:bg-white hover:text-red",{"ml-auto":e.filtro.tipoDocumento==="1"," ml-[3.7rem]":e.filtro.tipoDocumento!=="1"&&e.filtro.filtroDocValue===""," ml-[0rem]":e.filtro.tipoDocumento!=="1"&&e.filtro.filtroDocValue!==""}]),onClick:a[3]||(a[3]=b=>e.saveFiltro(e.filtro.filtroDocValue,e.filtro.tipoDocumento)),disabled:e.filtro.filtroDocValue===""},null,8,["class","disabled"])):C("",!0),e.filtro.tipoDocumento==="4"?(h(),A(_,{key:2,label:"Aplicar",class:"ml-40 border-gray text-black hover:bg-white hover:text-red",onClick:a[4]||(a[4]=b=>e.esperandoAccion())})):C("",!0)])}const he=I(_e,[["render",ge]]),ye="/maof-front/assets/Search-94489079.png",Fe={components:{ButtonBase:E,FormConsultaBusqueda:z},props:{showBusquedaValue:{type:Boolean,required:!0},showBusqueda:{type:Function,required:!0},saveBusqueda:{type:Function,required:!0}}},Ve={class:"flex justify-start items-center pt-10"},qe=r("img",{src:ye,alt:"filter",class:"w-10 items-center"},null,-1),Ce=r("h1",{class:"text-center font-bold text-lg"},"Búsqueda",-1),xe={class:"flex justify-center"};function De(v,a,e,t,o,y){const f=g("button-base"),_=g("form-consulta-busqueda");return h(),F(M,null,[r("div",Ve,[qe,Ce,m(f,{label:"Criterio de búsqueda",class:"ml-5 border-gray text-black hover:bg-white hover:text-red",onClick:e.showBusqueda},null,8,["onClick"])]),r("div",xe,[e.showBusquedaValue?(h(),A(_,{key:0,onSubmit:e.saveBusqueda,class:"mt-20"},null,8,["onSubmit"])):C("",!0)])],64)}const we=I(Fe,[["render",De]]);const Be={name:"UsersRolesMAOFIndex",components:{TableBase:G,ArrowBack:H,HomePage:J,ButtonBase:E,TitleBar:Y,SelectBase:S,FormConsultaBusqueda:z,Filtro:he,Busqueda:we,LogoutComponent:le},setup(){const v=W(),a=se(),e=X(),{rol:t}=e.getAuthData,o=O({filtro:{tipoDocumento:"",listFiltros:[{value:2,label:"Contrato o Convenio de Colaboración"},{value:3,label:"Convenio Modificatorio"},{value:1,label:"Proyecto / Cartera de inversión"}],listDocsFiltrados:[],filtroDocValue:"",data:{pendientes:[],pagados:[],totales:[]}},loading:!0});let y=O(!1);const f=(i,u)=>{switch(u){case"pendientes":i.length>0?(a.addPendientes(i),v.push({name:"ConsultasPedientesMAOF"})):D.fire("No hay estimaciones","Intenta con otro filtro","warning");break;case"pagadas":i.length>0?(a.addPagados(i),v.push({name:"ConsultasPagadosMAOF"})):D.fire("No hay estimaciones","Intenta con otro filtro","warning");break;case"totales":i.length>0?(a.addTotal(i),v.push({name:"ConsultasTotalesMAOF"})):D.fire("No hay estimaciones","Intenta con otro filtro","warning");break;default:console.log("opcion invalida");break}},_=async i=>{switch(y.value===!0&&(y.value=!1),i){case"1":o.value.filtro.listDocsFiltrados=[],o.value.filtro.filtroDocValue="",b();break;case"2":o.value.filtro.listDocsFiltrados=[],o.value.filtro.filtroDocValue="",l(i);break;case"3":o.value.filtro.listDocsFiltrados=[],o.value.filtro.filtroDocValue="",l(i);break;case"4":o.value.filtro.listDocsFiltrados=[],o.value.filtro.filtroDocValue="";break;default:console.log("No se encontro nada");break}},b=async()=>{try{const{data:i}=await oe();o.value.filtro.listDocsFiltrados=i.map(u=>({value:u.id_proyecto,label:`${u.clave_cartera}-${u.nombre_proyecto}`}))}catch(i){D.fire("Error",`${i.response.data.detail}`,"error"),o.value.filtro.tipoDocumento="",o.value.filtro.filtroDocValue=""}},l=async i=>{try{const{data:u}=await N();i==="2"&&(u.forEach(n=>{n.id_tipo_contrato!==3&&o.value.filtro.listDocsFiltrados.push({value:n.id_contrato,label:n.numero_contrato})}),o.value.filtro.listDocsFiltrados.sort((n,c)=>n.label>c.label?1:n.label<c.label?-1:0)),i==="3"&&(u.forEach(n=>{n.id_tipo_contrato===3&&o.value.filtro.listDocsFiltrados.push({value:n.id_contrato,label:n.numero_contrato})}),o.value.filtro.listDocsFiltrados.sort((n,c)=>n.label>c.label?1:n.label<c.label?-1:0))}catch(u){D.fire("Error",`${u.response.data.detail}`,"error"),o.value.filtro.tipoDocumento="",o.value.filtro.filtroDocValue=""}},x=()=>{o.value.filtro.tipoDocumento="",o.value.filtro.filtroDocValue="",y.value=!y.value},q=(i,u,n)=>{a.addPendientes(i),a.addPagados(u),a.addTotal(n)},d=async()=>{o.value.loading=!0;const{data:i}=await j();o.value.filtro.data.totales=i.total,o.value.filtro.data.pagados=i.pagadas,o.value.filtro.data.pendientes=i.pendiente,q(i.pendiente,i.pagadas,i.total),o.value.loading=!1},s=async i=>{const u=Object.entries(i).filter(([c,V])=>Array.isArray(V)?V.length>0:V!=="").reduce((c,[V,B])=>(Array.isArray(B)?c[V]=B.join(","):c[V]=B,c),{}),{data:n}=await fe(u);a.addBusqueda(n),v.push({name:"ConsultasBusquedaMAOF"})},p=async(i,u)=>{o.value.loading=!0;let n={};u==="1"?n={id_proyecto:i}:(u==="2"||u==="3")&&(n={id_contrato:i});const{data:c}=await j(n);o.value.filtro.data.totales=c.total,o.value.filtro.data.pagados=c.pagadas,o.value.filtro.data.pendientes=c.pendiente,q(c.pendiente,c.pagadas,c.total),o.value.loading=!1};return d(),{app:o,showBusquedaValue:y,rol:t,getStatusEstimations:f,showBusqueda:x,saveBusqueda:s,saveFiltro:p,getDocsByType:_,getProjects:b,getContracts:l,getFiltroDefault:d,infoToStore:q}}},ke={class:"px-4 mt-10"},Ae={class:"flex justify-between"},Ee={class:"flex justify-center items-center"},Ie={class:"text-black font-semibold mr-4 items-center content-center"},Me={class:"px-4"},Se={key:0,class:"flex justify-center text-3xl"},Ue={class:"text-center"},Te=r("h1",{class:"text-center"},"Pendientes",-1),Oe={class:"text-center"},Pe=r("h1",{class:"text-center"},"Pagadas",-1),je={class:"text-center"},Re=r("h1",{class:"text-center"},"Total",-1),Ne={class:"flex flex-col mt-20"};function ze(v,a,e,t,o,y){const f=g("arrow-back"),_=g("home-page"),b=g("logout-component"),l=g("title-bar"),x=g("Filtro"),q=g("Busqueda");return h(),F("main",ke,[r("div",Ae,[m(f),r("div",Ee,[r("p",Ie,w(t.rol),1),m(_),m(b)])]),m(l,{title:"Consulta MAOF",subtitle:"Agenda de Estimaciones"}),r("section",Me,[t.app.loading?C("",!0):(h(),F("div",Se,[r("div",{class:"px-10 text-red cursor-pointer",onClick:a[0]||(a[0]=d=>t.getStatusEstimations(t.app.filtro.data.pendientes,"pendientes"))},[r("p",Ue,w(t.app.filtro.data.pendientes.length),1),Te]),r("div",{class:"px-10 text-green cursor-pointer",onClick:a[1]||(a[1]=d=>t.getStatusEstimations(t.app.filtro.data.pagados,"pagadas"))},[r("p",Oe,w(t.app.filtro.data.pagados.length),1),Pe]),r("div",{class:"px-10 cursor-pointer",onClick:a[2]||(a[2]=d=>t.getStatusEstimations(t.app.filtro.data.totales,"totales"))},[r("p",je,w(t.app.filtro.data.totales.length),1),Re])])),r("div",Ne,[m(x,{filtro:t.app.filtro,getDocsByType:t.getDocsByType,saveFiltro:t.saveFiltro},null,8,["filtro","getDocsByType","saveFiltro"]),m(q,{showBusquedaValue:t.showBusquedaValue,showBusqueda:t.showBusqueda,saveBusqueda:t.saveBusqueda},null,8,["showBusquedaValue","showBusqueda","saveBusqueda"])])])])}const it=I(Be,[["render",ze]]);export{it as default};
