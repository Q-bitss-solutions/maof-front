import{I as F}from"./InputBase-0f5255f2.js";import{B as U}from"./fetchApi-e1006db9.js";import{S as I}from"./SelectBase-51a8cd37.js";import{T as A}from"./TextAreaBase-8892f8ba.js";import{f as S,a as T}from"./contract-ae5537b4.js";import{s as D,c as L}from"./residentEstimate-3450dcc1.js";import{_ as M,u as N,m as O,s as G,b as p,o,c as s,d as l,t as u,h as d,g as R,e as n,F as b,f as E,a as H}from"./index-219e2d0f.js";import{S as j}from"./sweetalert2.all-281a79b7.js";import{u as P,c,m as x,a as y}from"./index-09e5889e.js";import{A as $}from"./ArrowBack-0d319b8d.js";import{T as q}from"./TitleBar-d9022a58.js";import{s as Y}from"./resident-d9aabc38.js";import{L as J}from"./LogoutComponent-12869c17.js";import{H as K}from"./HomePage-c4619b32.js";const Q={name:"FormResidentEstimate",props:{editMode:{type:Boolean,default:!1},residentEstimate:{type:Object,default:()=>({})}},components:{InputBase:F,ButtonBase:U,SelectBase:I,TextAreaBase:A},setup(f,{emit:t}){const _=N(),e=O({residentEstimate:{id_contrato:"",fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",importe_obra_ejecutada:"",importe_pagar:"",grado_avance_obra:"",porcentaje_avance_estimacion:"",porcentaje_avance_estimacion_acumulado:"",porcentaje_avance_fisico:"",porcensaje_avance_financiero:""},fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",contratoName:"",contador_siguiente_estimacion:"",fileInfo:{type:Object,default:()=>({})},listReviewAreas:[],listEmpleados:[],listContrato:[]}),V=()=>{let m=new Date;var r=("0"+m.getDate()).slice(-2),v=("0"+(m.getMonth()+1)).slice(-2),w=m.getFullYear(),C=w+"-"+v+"-"+r;return!(e.fecha_autorizacion_contratista>C)},B=G(()=>({porcentaje_avance_estimacion:{maxValue:c.withMessage("El valor maximo es 100%",x(100)),minValue:c.withMessage("El valor minimo es 0%",y(0))},porcentaje_avance_estimacion_acumulado:{maxValue:c.withMessage("El valor maximo es 100%",x(100)),minValue:c.withMessage("El valor minimo es 0%",y(0))},porcentaje_avance_fisico:{maxValue:c.withMessage("El valor maximo es 100%",x(100)),minValue:c.withMessage("El valor minimo es 0%",y(0))},porcensaje_avance_financiero:{maxValue:c.withMessage("El valor maximo es 100%",x(100)),minValue:c.withMessage("El valor minimo es 0%",y(0))},grado_avance_obra:{maxValue:c.withMessage("El valor maximo es 100%",x(100)),minValue:c.withMessage("El valor minimo es 0%",y(0))},fecha_autorizacion_contratista:{fechaActualFunction:c.withMessage("La fecha es mayor al dia de hoy",V)}})),h=P(B,e.residentEstimate);f.editMode&&(e.resident=f.resident,e.resident.fecha_inicio_residente=f.resident.fecha_inicio_residente.split("-").reverse().join("-"));const i=()=>{var r=new Date().toLocaleTimeString("en-GB");e.residentEstimate.fecha_recepcion_info_contratista=e.fecha_recepcion_info_contratista+" "+r,e.fecha_autorizacion_contratista===""?delete e.residentEstimate.fecha_autorizacion_contratista:e.residentEstimate.fecha_autorizacion_contratista=e.fecha_autorizacion_contratista+" "+r,e.residentEstimate.fecha_periodo_inicio_estimacion=e.fecha_periodo_inicio_estimacion+" "+r,e.residentEstimate.fecha_periodo_fin_estimacion=e.fecha_periodo_fin_estimacion+" "+r,j.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async v=>{if(v.isConfirmed)try{await h.value.$validate()?(await D(e.residentEstimate),j.fire({title:"Registro dado de alta",text:"¿Desea ingresar los documentos?",icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí",cancelButtonText:"No",reverseButtons:!0}).then(async C=>{if(C.isConfirmed){const{data:k}=await L(),z=k.length-1;e.fileInfo=k[z],_.push({name:"FilesResidentEstimate",params:{residentEstimateId:e.fileInfo.id_estimacion}})}else _.push({name:"ResidentEstimate"})})):j.fire("Error","Revisa bien los datos","error")}catch(w){j.fire("Error",`${w.response.data.detail}`,"error")}})},g=async()=>{const m={activate_filters:!0};try{const{data:r}=await S(m);e.listContrato=r.map(v=>({value:v.id_contrato,label:v.numero_contrato,name:v.objeto_contrato}))}catch{}},a=async m=>{const{data:r}=await T(m);e.contratoName=r.objeto_contrato,e.contador_siguiente_estimacion=r.contador_siguiente_estimacion};return g(),{app:e,sendForm:i,getContratos:g,getName:a,v$:h}}},W={key:0,class:"flex content-start justify-end items-center mb-10"},X={class:"items-center justify-center"},Z=l("h1",{class:"font-bold text-lg"}," Número de la Estimación ",-1),ee={class:"text-center font-semibold text-lg numEstimacion"},ae={class:"max-w-xl mx-auto"},te={class:"flex flex-row"};function oe(f,t,_,e,V,B){const h=p("select-base"),i=p("input-base"),g=p("button-base");return o(),s(b,null,[e.app.residentEstimate.id_contrato!==""?(o(),s("div",W,[l("div",X,[Z,l("p",ee,u(e.app.contador_siguiente_estimacion),1)])])):d("",!0),l("div",ae,[_.editMode!==!0?(o(),R(h,{key:0,id:"id_contrato",label:"Número de Contrato(de origen)",options:e.app.listContrato,modelValue:e.app.residentEstimate.id_contrato,"onUpdate:modelValue":t[0]||(t[0]=a=>e.app.residentEstimate.id_contrato=a),class:"mb-3",onChange:t[1]||(t[1]=a=>e.getName(e.app.residentEstimate.id_contrato))},null,8,["options","modelValue"])):d("",!0),_.editMode!==!0?(o(),R(i,{key:1,id:"id_area_revisora",label:"Objeto del Contrato",type:"text",modelValue:e.app.contratoName,"onUpdate:modelValue":t[2]||(t[2]=a=>e.app.contratoName=a),class:"mb-3",disabled:""},null,8,["modelValue"])):d("",!0),n(i,{id:"fecha_recepcion_info_contratista",label:"Fecha de recepción de información del Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_recepcion_info_contratista,"onUpdate:modelValue":t[3]||(t[3]=a=>e.app.fecha_recepcion_info_contratista=a)},null,8,["modelValue"]),n(i,{id:"fecha_autorizacion_contratista",label:"Fecha de autorización al Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_autorizacion_contratista,"onUpdate:modelValue":t[4]||(t[4]=a=>e.app.fecha_autorizacion_contratista=a)},null,8,["modelValue"]),e.v$.fecha_autorizacion_contratista.$error?(o(!0),s(b,{key:2},E(e.v$.fecha_autorizacion_contratista.$errors,a=>(o(),s("span",{key:a,class:"text-red font-semibold text-center ml-80"},u(a.$message),1))),128)):d("",!0),l("div",te,[l("div",null,[n(i,{id:"fecha_periodo_inicio_estimacion",label:"Período de la Estimación",type:"date",modelValue:e.app.fecha_periodo_inicio_estimacion,"onUpdate:modelValue":t[5]||(t[5]=a=>e.app.fecha_periodo_inicio_estimacion=a)},null,8,["modelValue"])]),l("div",null,[n(i,{id:"fecha_periodo_fin_estimacion",label:"al",type:"date",class:"pt-2",modelValue:e.app.fecha_periodo_fin_estimacion,"onUpdate:modelValue":t[6]||(t[6]=a=>e.app.fecha_periodo_fin_estimacion=a)},null,8,["modelValue"])])]),n(i,{id:"importe_obra_ejecutada",label:"Importe de la obra ejecutada",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_obra_ejecutada,"onUpdate:modelValue":t[7]||(t[7]=a=>e.app.residentEstimate.importe_obra_ejecutada=a)},null,8,["modelValue"]),n(i,{id:"importe_pagar",label:"Importe a pagar",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_pagar,"onUpdate:modelValue":t[8]||(t[8]=a=>e.app.residentEstimate.importe_pagar=a)},null,8,["modelValue"]),n(i,{id:"grado_avance_obra",label:"% de grado de avance",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.grado_avance_obra,"onUpdate:modelValue":t[9]||(t[9]=a=>e.app.residentEstimate.grado_avance_obra=a)},null,8,["modelValue"]),e.v$.grado_avance_obra.$error?(o(!0),s(b,{key:3},E(e.v$.grado_avance_obra.$errors,a=>(o(),s("span",{key:a,class:"text-red font-semibold text-center ml-80"},u(a.$message),1))),128)):d("",!0),n(i,{id:"porcentaje_avance_estimacion",label:"% de avance de la Estimación",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion,"onUpdate:modelValue":t[10]||(t[10]=a=>e.app.residentEstimate.porcentaje_avance_estimacion=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion.$error?(o(!0),s(b,{key:4},E(e.v$.porcentaje_avance_estimacion.$errors,a=>(o(),s("span",{key:a,class:"text-red font-semibold text-center ml-80"},u(a.$message),1))),128)):d("",!0),n(i,{id:"porcentaje_avance_estimacion_acumulado",label:"% de avance de la Estimación acumulado",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion_acumulado,"onUpdate:modelValue":t[11]||(t[11]=a=>e.app.residentEstimate.porcentaje_avance_estimacion_acumulado=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion_acumulado.$error?(o(!0),s(b,{key:5},E(e.v$.porcentaje_avance_estimacion_acumulado.$errors,a=>(o(),s("span",{key:a,class:"text-red font-semibold text-center ml-80"},u(a.$message),1))),128)):d("",!0),n(i,{id:"porcentaje_avance_fisico",label:"% de avance físico",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_fisico,"onUpdate:modelValue":t[12]||(t[12]=a=>e.app.residentEstimate.porcentaje_avance_fisico=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_fisico.$error?(o(!0),s(b,{key:6},E(e.v$.porcentaje_avance_fisico.$errors,a=>(o(),s("span",{key:a,class:"text-red font-semibold text-center ml-80"},u(a.$message),1))),128)):d("",!0),n(i,{id:"porcensaje_avance_financiero",label:"% de avance financiero",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcensaje_avance_financiero,"onUpdate:modelValue":t[13]||(t[13]=a=>e.app.residentEstimate.porcensaje_avance_financiero=a)},null,8,["modelValue"]),e.v$.porcensaje_avance_financiero.$error?(o(!0),s(b,{key:7},E(e.v$.porcensaje_avance_financiero.$errors,a=>(o(),s("span",{key:a,class:"text-red font-semibold text-center ml-80"},u(a.$message),1))),128)):d("",!0),n(g,{label:"Guardar",onClick:e.sendForm,class:"mr-0 ml-auto"},null,8,["onClick"])])],64)}const ne=M(Q,[["render",oe]]),ie={name:"NewResident",components:{FormResidentEstimate:ne,ArrowBack:$,TitleBar:q,HomePage:K,LogoutComponent:J},setup(){const f=H(),{rol:t}=f.getAuthData,_=N();return{rol:t,saveResident:async V=>{await Y(V),j.fire("¡Éxito!","Residente guardado con éxito!","success"),_.push({name:"Resident"})}}}},se={class:"px-4 mt-10"},re={class:"flex justify-between"},ce={class:"flex justify-center items-center"},le={class:"text-black font-semibold mr-4 items-center content-center"},me={class:"px-4"};function de(f,t,_,e,V,B){const h=p("arrow-back"),i=p("home-page"),g=p("logout-component"),a=p("title-bar"),m=p("form-resident-estimate");return o(),s("main",se,[l("div",re,[n(h),l("div",ce,[l("p",le,u(e.rol),1),n(i),n(g)])]),n(a,{title:"Estimación Residente",subtitle:"Nuevo"}),l("section",me,[n(m)])])}const Be=M(ie,[["render",de]]);export{Be as default};
