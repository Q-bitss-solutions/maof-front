import{T as G}from"./TableUsers-14c5e46c.js";import{A as H}from"./ArrowBack-6ae4d345.js";import{H as J}from"./HomePage-b55c9dba.js";import{S as U}from"./SelectBase-64c29a6c.js";import{B as A,a as O}from"./fetchApi-f8af7d53.js";import{_ as I,m as W,s as S,b as h,o as y,c as B,e as b,d,F as T,f as R,t as D,h as x,r as k,J as K,B as Q,g as E,n as X,I as Y,u as Z,a as $}from"./index-77c78547.js";import{T as ee}from"./TitleBar-0fee8479.js";import{I as te}from"./InputBase-09aa8ac6.js";import{f as N}from"./contract-415809d5.js";import{f as ae}from"./resident-c4e81ede.js";import{a as oe}from"./SICTUnits-17fd400c.js";import{k as se}from"./residentEstimate-11392e02.js";import{S as V}from"./sweetalert2.all-281a79b7.js";import{u as le,c as M,a as j}from"./index-ecd733af.js";import{f as ie}from"./project-c76352de.js";import{c as ne}from"./consultas-1dbe86b7.js";import{L as re}from"./LogoutComponent-47cddd42.js";const ue={name:"FormProject",props:{editMode:{type:Boolean,default:!1},project:{type:Object,default:()=>({})},showBusqueda:{type:Function,required:!0}},components:{InputBase:te,ButtonBase:A,SelectBase:U},setup(r,{emit:a}){const e=W({busqueda:{id_contrato:"",id_residente:"",mes_estimacion:"",año_estimacion:"",estatus_estimacion:"",unidad_maof:"",dias_transcurridos:[],fechas_autorizacion:[]},listMesEstimacion:[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiempbre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}],diasInicio:"",diasFin:"",fechaInicio:"",fechaFin:"",listAnios:[],listC_CC_CM:[],listResident:[],listUnitMAOF:[],listStatusEstimate:[]}),t=S(()=>({diasFin:{minValue:M.withMessage("El valor mínimo es 1",j(1)),customValidation:M.withMessage("El valor de días inicio debe ser menor que días fin",p=>e.diasInicio!==""&&e.diasFin!==""?e.diasInicio<e.diasFin:!0)},diasInicio:{minValue:M.withMessage("El valor mínimo es 0",j(0))}})),o=le(t,e),g=S(()=>{const{id_contrato:p,id_residente:i,mes_estimacion:c,año_estimacion:q,estatus_estimacion:s,unidad_maof:_}=e.busqueda,{diasInicio:u,diasFin:n,fechaInicio:F,fechaFin:L}=e;return!p&&!i&&!c&&!q&&!s&&!_&&!u&&!n&&!F&&!L}),m=async()=>{const p={activate_filters:!0};try{const{data:i}=await N(p);e.listC_CC_CM=i.map(c=>({value:c.id_contrato,label:c.numero_contrato})),e.listC_CC_CM.sort((c,q)=>c.label>q.label?1:c.label<q.label?-1:0)}catch(i){V.fire("¡Error!",`${i.response.data.detail}`,"error"),r.showBusqueda()}},f=async()=>{const p={activate_filters:!0},{data:i}=await ae(p);e.listResident=i.map(c=>({value:c.id_residente,label:c.nombre_completo})),e.listResident.sort((c,q)=>c.label>q.label?1:c.label<q.label?-1:0)},v=async()=>{const{data:p}=await oe();e.listUnitMAOF=p.map(i=>({value:i.id_unidad_maof,label:i.unidad})),e.listUnitMAOF.sort((i,c)=>i.label>c.label?1:i.label<c.label?-1:0)},l=async()=>{const{data:p}=await se();e.listStatusEstimate=p.map(i=>({value:i.clave_estatus_estimacion,label:i.estatus_estimacion})),e.listStatusEstimate.sort((i,c)=>i.label>c.label?1:i.label<c.label?-1:0)},C=p=>{for(let i=0;i<p;i++)e.listAnios.push({value:2023+i,label:`${2023+i}`})},w=async()=>{if(await o.value.$validate())e.diasInicio!==""&&(e.busqueda.dias_transcurridos.push(e.diasInicio),e.diasInicio=""),e.diasFin!==""&&(e.busqueda.dias_transcurridos.push(e.diasFin),e.diasFin=""),e.fechaInicio!==""&&(e.busqueda.fechas_autorizacion.push(e.fechaInicio),e.fechaInicio=""),e.fechaFin!==""&&(e.busqueda.fechas_autorizacion.push(e.fechaFin),e.fechaFin=""),a("submit",e.busqueda);else for(let i=0;i<o.value.$errors.length;i++)await V.fire({title:o.value.$errors[i].$message,icon:"error"})};return m(),f(),v(),l(),C(10),{app:e,isFormEmpty:g,v$:o,sendForm:w,getC_CC_CM:m,getResident:f,getUnitMAOF:v,getStatusEstimate:l,generateAnios:C}}},de={class:"max-w-6xl pb-10 grow"},ce=d("p",{class:"w-[17rem]"},"*Contrato, Convenio de Colaboración, Convenio Modificatorio",-1),me={class:"grid grid-cols-2"},fe={class:"grid"},pe={class:"grid grid-cols-2 pt-3"};function be(r,a,e,t,o,g){const m=h("select-base"),f=h("input-base"),v=h("button-base");return y(),B("div",de,[ce,b(m,{id:"clave_cartera",label:"C, CC, CM*",options:t.app.listC_CC_CM,class:"mb-3",modelValue:t.app.busqueda.id_contrato,"onUpdate:modelValue":a[0]||(a[0]=l=>t.app.busqueda.id_contrato=l)},null,8,["options","modelValue"]),b(m,{id:"nombre_proyecto",label:"Residente",options:t.app.listResident,class:"mb-3",modelValue:t.app.busqueda.id_residente,"onUpdate:modelValue":a[1]||(a[1]=l=>t.app.busqueda.id_residente=l)},null,8,["options","modelValue"]),b(m,{id:"nombre_proyecto",label:"Mes de la Estimación",options:t.app.listMesEstimacion,class:"mb-3",modelValue:t.app.busqueda.mes_estimacion,"onUpdate:modelValue":a[2]||(a[2]=l=>t.app.busqueda.mes_estimacion=l)},null,8,["options","modelValue"]),b(m,{id:"nombre_proyecto",label:"Año de la Estimación",options:t.app.listAnios,class:"mb-3",modelValue:t.app.busqueda.año_estimacion,"onUpdate:modelValue":a[3]||(a[3]=l=>t.app.busqueda.año_estimacion=l)},null,8,["options","modelValue"]),b(m,{id:"nombre_proyecto",label:"Estatus de la Estimación",class:"mb-3",options:t.app.listStatusEstimate,modelValue:t.app.busqueda.estatus_estimacion,"onUpdate:modelValue":a[4]||(a[4]=l=>t.app.busqueda.estatus_estimacion=l)},null,8,["options","modelValue"]),b(m,{id:"nombre_proyecto",label:"Unidad MAOF responsable",options:t.app.listUnitMAOF,class:"mb-3",modelValue:t.app.busqueda.unidad_maof,"onUpdate:modelValue":a[5]||(a[5]=l=>t.app.busqueda.unidad_maof=l)},null,8,["options","modelValue"]),d("div",me,[b(f,{id:"dias_inicio",label:"Días transcurridos del",type:"number",class:"grow",modelValue:t.app.diasInicio,"onUpdate:modelValue":a[6]||(a[6]=l=>t.app.diasInicio=l)},null,8,["modelValue"]),b(f,{id:"dias_fin",label:"al",type:"number",class:"flex-auto",modelValue:t.app.diasFin,"onUpdate:modelValue":a[7]||(a[7]=l=>t.app.diasFin=l)},null,8,["modelValue"])]),d("div",fe,[t.v$.diasInicio.$error?(y(!0),B(T,{key:0},R(t.v$.diasInicio.$errors,l=>(y(),B("span",{key:l,class:"text-red font-semibold text-center ml-80"},D(l.$message),1))),128)):x("",!0),t.v$.diasFin.$error?(y(!0),B(T,{key:1},R(t.v$.diasFin.$errors,l=>(y(),B("span",{key:l,class:"text-red font-semibold text-center ml-80"},D(l.$message),1))),128)):x("",!0)]),d("div",pe,[b(f,{id:"fecha_inicio",label:"Autorización entre",type:"date",class:"grow",modelValue:t.app.fechaInicio,"onUpdate:modelValue":a[8]||(a[8]=l=>t.app.fechaInicio=l)},null,8,["modelValue"]),b(f,{id:"fecha_fin",label:"y",type:"date",class:"",modelValue:t.app.fechaFin,"onUpdate:modelValue":a[9]||(a[9]=l=>t.app.fechaFin=l)},null,8,["modelValue"])]),b(v,{label:"Buscar",onClick:t.sendForm,class:"mr-0 ml-auto mt-5",disabled:t.isFormEmpty},null,8,["onClick","disabled"])])}const z=I(ue,[["render",be]]),P=r=>O({url:"/agenda_estimacion/filtros/",method:"GET",params:r||{}}),_e=r=>O({url:"/agenda_estimacion/busqueda/",method:"GET",params:r||{}}),ve=r=>O({url:"/agenda_estimacion/responsable_estimacion/",method:"GET",params:r||{}}),ge="/maof-front/assets/Filter-fb6d2bbc.png";const he={props:{filtro:{type:Object,required:!0},getDocsByType:{type:Function,required:!0},saveFiltro:{type:Function,required:!0},esperandoAccion:{type:Function,required:!1}},components:{SelectBase:U,ButtonBase:A},setup(r){const a=k(null),e=k(null),t=()=>{Y(()=>{var f;const g=(f=a.value)==null?void 0:f.$el.offsetWidth;if(!g)return;const m=g+8;e.value&&(e.value.$el.style.marginLeft=`${m}px`)})};K(()=>{t(),window.addEventListener("resize",t)}),Q(()=>{window.removeEventListener("resize",t)});const o=S(()=>({"ml-[25rem]":r.filtro.tipoDocumento==="1","ml-[3.7rem]":r.filtro.tipoDocumento!=="1"&&r.filtro.filtroDocValue==="","ml-[0rem]":r.filtro.tipoDocumento!=="1"&&r.filtro.filtroDocValue!==""}));return{selectBaseRef:a,buttonBaseRef:e,ajustarDistancia:t,buttonClass:o}}},ye={class:"flex justify-start items-center pb-10"},Fe=d("img",{src:ge,alt:"filter",class:"w-10 items-center"},null,-1);function Ve(r,a,e,t,o,g){const m=h("select-base"),f=h("button-base");return y(),B("div",ye,[Fe,b(m,{label:"Filtros",class:"text-center w-48 mr-9",id:"filtros",options:e.filtro.listFiltros,modelValue:e.filtro.tipoDocumento,"onUpdate:modelValue":a[0]||(a[0]=v=>e.filtro.tipoDocumento=v),onChange:a[1]||(a[1]=v=>e.getDocsByType(e.filtro.tipoDocumento))},null,8,["options","modelValue"]),e.filtro.listDocsFiltrados!==""&&e.filtro.tipoDocumento!==""&&e.filtro.tipoDocumento!=="4"?(y(),E(m,{key:0,ref:t.selectBaseRef,label:"",class:"text-center w-48 ml-36",id:"filtrosDocs",options:e.filtro.listDocsFiltrados,modelValue:e.filtro.filtroDocValue,"onUpdate:modelValue":a[2]||(a[2]=v=>e.filtro.filtroDocValue=v)},null,8,["options","modelValue"])):x("",!0),e.filtro.listDocsFiltrados!==""&&e.filtro.tipoDocumento!==""&&e.filtro.tipoDocumento!=="4"?(y(),E(f,{key:1,ref:t.buttonBaseRef,label:"Aplicar",class:X(["border-gray text-black hover:bg-white hover:text-red",t.buttonClass]),onClick:a[3]||(a[3]=v=>e.saveFiltro(e.filtro.filtroDocValue,e.filtro.tipoDocumento)),disabled:e.filtro.filtroDocValue===""},null,8,["class","disabled"])):x("",!0),e.filtro.tipoDocumento==="4"?(y(),E(f,{key:2,label:"Aplicar",class:"ml-40 border-gray text-black hover:bg-white hover:text-red",onClick:a[4]||(a[4]=v=>e.esperandoAccion())})):x("",!0)])}const qe=I(he,[["render",Ve]]),Be="/maof-front/assets/Search-94489079.png",Ce={components:{ButtonBase:A,FormConsultaBusqueda:z},props:{showBusquedaValue:{type:Boolean,required:!0},showBusqueda:{type:Function,required:!0},saveBusqueda:{type:Function,required:!0}}},we={class:"flex justify-start items-center pt-10"},xe=d("img",{src:Be,alt:"filter",class:"w-10 items-center"},null,-1),De=d("h1",{class:"text-center font-bold text-lg"},"Búsqueda",-1),Ee={class:"flex justify-center"};function ke(r,a,e,t,o,g){const m=h("button-base"),f=h("form-consulta-busqueda");return y(),B(T,null,[d("div",we,[xe,De,b(m,{label:"Criterio de búsqueda",class:"ml-5 border-gray text-black hover:bg-white hover:text-red",onClick:e.showBusqueda},null,8,["onClick"])]),d("div",Ee,[e.showBusquedaValue?(y(),E(f,{key:0,onSubmit:e.saveBusqueda,class:"mt-20",showBusqueda:e.showBusqueda},null,8,["onSubmit","showBusqueda"])):x("",!0)])],64)}const Ae=I(Ce,[["render",ke]]);const Ie={name:"UsersRolesMAOFIndex",components:{TableBase:G,ArrowBack:H,HomePage:J,ButtonBase:A,TitleBar:ee,SelectBase:U,FormConsultaBusqueda:z,Filtro:qe,Busqueda:Ae,LogoutComponent:re},setup(){const r=Z(),a=ne(),e=$(),{rol:t}=e.getAuthData,o=k({filtro:{tipoDocumento:"",listFiltros:[{value:2,label:"Contrato o Convenio de Colaboración"},{value:3,label:"Convenio Modificatorio"},{value:4,label:"Estimaciones bajo su responsabilidad"},{value:1,label:"Proyecto / Cartera de inversión"}],listDocsFiltrados:[],filtroDocValue:"",data:{pendientes:[],pagados:[],totales:[]}},loading:!0});let g=k(!1);const m=(s,_)=>{switch(_){case"pendientes":s.length>0?(a.addPendientes(s),r.push({name:"ConsultasPedientesMAOF"})):V.fire("No hay estimaciones","Intenta con otro filtro","warning");break;case"pagadas":s.length>0?(a.addPagados(s),r.push({name:"ConsultasPagadosMAOF"})):V.fire("No hay estimaciones","Intenta con otro filtro","warning");break;case"totales":s.length>0?(a.addTotal(s),r.push({name:"ConsultasTotalesMAOF"})):V.fire("No hay estimaciones","Intenta con otro filtro","warning");break;default:console.log("opcion invalida");break}},f=async s=>{switch(g.value===!0&&(g.value=!1),s){case"1":o.value.filtro.listDocsFiltrados=[],o.value.filtro.filtroDocValue="",v();break;case"2":o.value.filtro.listDocsFiltrados=[],o.value.filtro.filtroDocValue="",l(s);break;case"3":o.value.filtro.listDocsFiltrados=[],o.value.filtro.filtroDocValue="",l(s);break;case"4":o.value.filtro.listDocsFiltrados=[],o.value.filtro.filtroDocValue="";break;default:console.log("No se encontro nada");break}},v=async()=>{const s={estatus_proyecto:3,activate_filters:!0};try{const{data:_}=await ie(s);o.value.filtro.listDocsFiltrados=_.map(u=>({value:u.id_proyecto,label:`${u.clave_cartera}-${u.nombre_proyecto}`}))}catch(_){V.fire("Error",`${_.response.data.detail}`,"error"),o.value.filtro.tipoDocumento="",o.value.filtro.filtroDocValue=""}},l=async s=>{const _={activate_filters:!0};try{const{data:u}=await N(_);s==="2"&&(u.forEach(n=>{n.id_tipo_contrato!==3&&o.value.filtro.listDocsFiltrados.push({value:n.id_contrato,label:n.numero_contrato})}),o.value.filtro.listDocsFiltrados.sort((n,F)=>n.label>F.label?1:n.label<F.label?-1:0)),s==="3"&&(u.forEach(n=>{n.id_tipo_contrato===3&&o.value.filtro.listDocsFiltrados.push({value:n.id_contrato,label:n.numero_contrato})}),o.value.filtro.listDocsFiltrados.sort((n,F)=>n.label>F.label?1:n.label<F.label?-1:0))}catch(u){V.fire("Error",`${u.response.data.detail}`,"error"),o.value.filtro.tipoDocumento="",o.value.filtro.filtroDocValue=""}},C=()=>{o.value.filtro.tipoDocumento="",o.value.filtro.filtroDocValue="",g.value=!g.value},w=(s,_,u)=>{a.addPendientes(s),a.addPagados(_),a.addTotal(u)},p=async()=>{o.value.loading=!0;try{const{data:s}=await P();o.value.filtro.data.totales=s.total,o.value.filtro.data.pagados=s.pagadas,o.value.filtro.data.pendientes=s.pendiente,w(s.pendiente,s.pagadas,s.total)}catch(s){V.fire("Error",`${s.response.data.detail}`,"error"),r.push({name:"Home"})}o.value.loading=!1},i=async s=>{const _=Object.entries(s).filter(([u,n])=>Array.isArray(n)?n.length>0:n!=="").reduce((u,[n,F])=>(Array.isArray(F)?u[n]=F.join(","):u[n]=F,u),{});try{const{data:u}=await _e(_);u.length?(a.addBusqueda(u),r.push({name:"ConsultasBusquedaMAOF"})):V.fire("Error","No hay resultados para estos criterios","error")}catch(u){V.fire("Error",`${u.response.data.detail}`,"error"),C()}},c=async(s,_)=>{o.value.loading=!0;let u={};_==="1"?u={id_proyecto:s}:(_==="2"||_==="3")&&(u={id_contrato:s});const{data:n}=await P(u);o.value.filtro.data.totales=n.total,o.value.filtro.data.pagados=n.pagadas,o.value.filtro.data.pendientes=n.pendiente,w(n.pendiente,n.pagadas,n.total),o.value.loading=!1},q=async()=>{o.value.loading=!0;try{const{data:s}=await ve();a.addResponsableEstimacion(s),o.value.loading=!1,r.push({name:"ResponsableEstimacionMAOF"})}catch(s){V.fire("Error",`${s.response.data.detail}`,"error"),o.value.filtro.tipoDocumento="",o.value.filtro.filtroDocValue="",o.value.loading=!1}};return p(),{app:o,showBusquedaValue:g,rol:t,getStatusEstimations:m,showBusqueda:C,saveBusqueda:i,saveFiltro:c,getDocsByType:f,getProjects:v,getContracts:l,getFiltroDefault:p,infoToStore:w,esperandoAccion:q}}},Me={class:"px-4 mt-10"},Se={class:"flex justify-between"},Te={class:"flex justify-center items-center"},Ue={class:"text-black font-semibold mr-4 items-center content-center"},Oe={class:"px-4"},Re={key:0,class:"flex justify-center text-3xl"},je={class:"text-center"},Pe=d("h1",{class:"text-center"},"Pendientes",-1),Ne={class:"text-center"},ze=d("h1",{class:"text-center"},"Pagadas",-1),Le={class:"text-center"},Ge=d("h1",{class:"text-center"},"Total",-1),He={class:"flex flex-col mt-20"};function Je(r,a,e,t,o,g){const m=h("arrow-back"),f=h("home-page"),v=h("logout-component"),l=h("title-bar"),C=h("Filtro"),w=h("Busqueda");return y(),B("main",Me,[d("div",Se,[b(m),d("div",Te,[d("p",Ue,D(t.rol),1),b(f),b(v)])]),b(l,{title:"Consulta MAOF",subtitle:"Agenda de Estimaciones"}),d("section",Oe,[t.app.loading?x("",!0):(y(),B("div",Re,[d("div",{class:"px-10 text-red cursor-pointer",onClick:a[0]||(a[0]=p=>t.getStatusEstimations(t.app.filtro.data.pendientes,"pendientes"))},[d("p",je,D(t.app.filtro.data.pendientes.length),1),Pe]),d("div",{class:"px-10 text-green cursor-pointer",onClick:a[1]||(a[1]=p=>t.getStatusEstimations(t.app.filtro.data.pagados,"pagadas"))},[d("p",Ne,D(t.app.filtro.data.pagados.length),1),ze]),d("div",{class:"px-10 cursor-pointer",onClick:a[2]||(a[2]=p=>t.getStatusEstimations(t.app.filtro.data.totales,"totales"))},[d("p",Le,D(t.app.filtro.data.totales.length),1),Ge])])),d("div",He,[b(C,{filtro:t.app.filtro,getDocsByType:t.getDocsByType,saveFiltro:t.saveFiltro,esperandoAccion:t.esperandoAccion},null,8,["filtro","getDocsByType","saveFiltro","esperandoAccion"]),b(w,{showBusquedaValue:t.showBusquedaValue,showBusqueda:t.showBusqueda,saveBusqueda:t.saveBusqueda},null,8,["showBusquedaValue","showBusqueda","saveBusqueda"])])])])}const dt=I(Ie,[["render",Je]]);export{dt as default};
