import{F as H}from"./FormResident-0a70a1d5.js";import{A as J}from"./ArrowBack-c9625761.js";import{T as K}from"./TitleBar-6bc781cb.js";import{I as M}from"./InputBase-e1a24e20.js";import{T as Q}from"./TableBase-18fbcb3f.js";import{B as W}from"./fetchApi-2015a4cb.js";import{L as X}from"./LogoutComponent-8f39cc9f.js";import{f as Z,g as $,h as ee,i as te}from"./residentEstimate-405cdb84.js";import{_ as T,o as f,c as m,d as o,t as x,q as ae,u as ie,a as oe,m as ne,r as i,b as u,e as r,g as se,h as _}from"./index-24ec4a05.js";import{S as l}from"./sweetalert2.all-281a79b7.js";import"./SelectBase-c1dd3d77.js";import"./reviewArea-9fb93749.js";import"./users-0ff386e4.js";const re={name:"Banner",props:{title:{type:String,default:""}}},le={class:"relative isolate flex-1 items-center gap-x-6 overflow-hidden bg-gray-50 px-4 py-1.5 sm:px-2.5 sm:before:flex"},ce=o("div",{class:"absolute left-[max(-7rem,calc(50%-52rem))] top-1/2 -z-10 -translate-y-1/2 transform-gpu blur-2xl","aria-hidden":"true"},[o("div",{class:"aspect-[577/310] w-[36.0625rem] bg-gradient-to-r from-[#808080] to-[#808080] opacity-30",style:{"clip-path":"polygon(74.8% 41.9%, 97.2% 73.2%, 100% 34.9%, 92.5% 0.4%, 87.5% 0%, 75% 28.6%, 58.5% 54.6%, 50.1% 56.8%, 46.9% 44%, 48.3% 17.4%, 24.7% 53.9%, 0% 27.9%, 11.9% 74.2%, 24.9% 54.1%, 68.6% 100%, 74.8% 41.9%)"}})],-1),de=o("div",{class:"absolute left-[max(45rem,calc(50%+8rem))] top-1/2 -z-10 -translate-y-1/2 transform-gpu blur-2xl","aria-hidden":"true"},[o("div",{class:"aspect-[577/310] w-[36.0625rem] bg-gradient-to-r from-[#808080] to-[#808080] opacity-30",style:{"clip-path":"polygon(74.8% 41.9%, 97.2% 73.2%, 100% 34.9%, 92.5% 0.4%, 87.5% 0%, 75% 28.6%, 58.5% 54.6%, 50.1% 56.8%, 46.9% 44%, 48.3% 17.4%, 24.7% 53.9%, 0% 27.9%, 11.9% 74.2%, 24.9% 54.1%, 68.6% 100%, 74.8% 41.9%)"}})],-1),fe={class:"text-3xl text-center"};function ue(E,p,h,t,a,F){return f(),m("div",le,[ce,de,o("div",null,[o("h2",fe,x(h.title),1)])])}const me=T(re,[["render",ue]]),pe={name:"FilesResidentEstimate",components:{FormResident:H,ArrowBack:J,TitleBar:K,InputBase:M,TableBase:Q,ButtonBase:W,Banner:me,LogoutComponent:X},setup(){const E=ae(),p=ie(),h=oe(),t=[{label:"Id",field:"id_archivo_estimacion"},{label:"Nombre archivo",field:"ruta_archivo_residente"},{label:"Descripción",field:"descripcion_archivo"}],a=ne({file:{id_estimacion:"",file:"",descripcionFile:""},data:{},filesById:[],loading:!0,filesResidente:[],filesAreaRevisora:[],filesFinanzas:[],filesTramite_Pago:[]}),F=i([]),g=i([]),b=i([]),R=i([]),y=i([]),{rol:n}=h.getAuthData,c=i([]),w=i(!1),O=i(!1),B=i(!1),A=i(!1),N=i([{label:"Descargar",action:async e=>{window.open(`${e.archivo_estimacion}`,"_blank")}}]),z=i([]),D=i([]),k=i([]),I=i([]),S=async()=>{a.loading=!0;const{data:e}=await Z(E.params.residentEstimateId);a.data=e,a.file.id_estimacion=e.id_estimacion,v.append("id_estimacion",a.file.id_estimacion),c.value=V(a.data.estatus_semaforo),U(),L(a.data.estatus_estimacion),P(),a.loading=!1},P=async()=>{const{data:e}=await $(a.file.id_estimacion);console.log(e),e.residente&&(g.value=e.residente),e.area_Revisora&&(b.value=e.area_Revisora),e.finanzas&&(R.value=e.finanzas),e.dgpop&&(y.value=e.tramite_pago)},j=async e=>{await updateResident(e),l.fire("¡Éxito!","Residente actualizado con éxito!","success"),p.push({name:"Resident"})};let v=new FormData;const q=async()=>{try{const{value:e}=await l.fire({title:"Subir Archivo",input:"file",showCancelButton:!0,reverseButtons:!0,inputAttributes:{accept:"application/pdf","aria-label":"Upload your profile picture"}});if(e!=null){const{value:s}=await l.fire({title:"Descripción del archivo",input:"text",showCancelButton:!0,reverseButtons:!0,inputValidator:d=>{if(!d)return"El campo es requerido"}});if(s!==void 0){a.file.descripcionFile=s,a.file.file=e,v.append("archivo_estimacion ",a.file.file),v.append("descripcion_archivo ",a.file.descripcionFile);try{await ee(v),P(),l.fire("¡Éxito!","!Archivo guardado con éxito!","success"),a.file.file="",a.file.descripcionFile=""}catch(d){l.fire("Error",`${d.response.data.detail}`,"error")}}}else e===null&&l.fire("No selesccionaste ningun archivo","Agrega uno para continuar","warning")}catch{}},V=e=>{var s=!1;return e==="Residente"&&n==="Residente"&&(s=!0),e==="Area Revisora"&&(n.includes("Área revisora")||n.includes("Obras y Contratos"))&&(s=!0),(e==="Finanzas"||e==="DGPOP")&&n.includes("Finanzas")&&(s=!0),s},U=()=>{w.value=!0,O.value=!0,B.value=!0,A.value=!0},L=e=>{const s=async C=>{window.open(`${C.archivo_estimacion}`,"_blank")},d=async C=>{l.fire({title:"¿Estás seguro que desea eliminar el documento?",text:"Esto quitará el documento",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Si, Eliminar!",reverseButtons:!0}).then(async G=>{if(G.isConfirmed)try{await te(C.id_archivo_estimacion),await P(),l.fire("Eliminado!","El documento se eliminó","success")}catch(Y){l.fire("Error",`${Y.response.data.detail}`,"error")}})};e==="Pagada"?(w.value=!0,O.value=!0,B.value=!0,A.value=!0,N.value=[{label:"Descargar",action:s}]):(n.includes("Residente")&&(e==="Capturada por Residente"||e==="Autorizada por Residente"||e==="Regresada al Residente")?z.value=[{label:"Descargar",action:s},{label:"Eliminar",action:d}]:z.value=[],(n.includes("Obras y Contratos")||n.includes("Área revisora"))&&(e==="En validación del área revisora"||e==="Regresada al área revisora")?D.value=[{label:"Descargar",action:s},{label:"Eliminar",action:d}]:D.value=[],n.includes("Finanzas")&&(e==="En validación de Finanzas"||e==="Regresada a Finanzas"||e==="En trámite de pago")?k.value=[{label:"Descargar",action:s},{label:"Eliminar",action:d}]:k.value=[])};return S(),{app:a,filesById:F,saveResident:j,featureOptions:N,featureOptionsResidente:z,featureOptionsAreaRevisora:D,featureOptionsFianzas:k,featureOptionsTramiteDePago:I,formData:v,headers:t,fileUpload:q,filesResidente:g,filesAreaRevisora:b,filesTramite_Pago:y,filesFinanzas:R,canAddNew:c,canEditResidente:w,canEditAreaRevisora:O,canEditFinanzas:B,canEditPago:A}}},ve={class:"px-4 mt-10"},_e={class:"flex justify-between"},he={class:"px-4"},ge={class:"flex flex-row justify-between"},be={class:"font-bold text-lg"},Re={class:"font-bold text-lg w-128 text-center"},ye={class:"flex content-start justify-end items-center mb-10"},we={class:"items-center justify-center"},xe=o("h1",{class:"font-bold text-lg text-center"}," Número de la Estimación ",-1),Ee={class:"text-center font-semibold text-lg numEstimacion"},Fe={key:1,class:"flex flex-col py-px"},Oe={key:2},Be={key:3},Ae={key:4};function ze(E,p,h,t,a,F){const g=u("arrow-back"),b=u("logout-component"),R=u("title-bar"),y=u("button-base"),n=u("banner"),c=u("table-base");return f(),m("main",ve,[o("div",_e,[r(g),r(b)]),r(R,{title:"Estimación Residente",subtitle:"Archivos"}),o("section",he,[o("div",ge,[o("div",be,x(t.app.data.numero_contrato),1),o("div",Re," Objeto: "+x(t.app.data.objeto_contrato),1),o("div",ye,[o("div",we,[xe,o("p",Ee,x(t.app.data.num_consecutivo_estimacion),1)])])]),t.canAddNew?(f(),se(y,{key:0,label:"Nuevo",onClick:p[0]||(p[0]=w=>t.fileUpload()),class:"mr-0 ml-auto mb-5"})):_("",!0),t.filesResidente.length?(f(),m("div",Fe,[r(n,{title:"Documentos de Residente"}),r(c,{description:"Residente",options:t.featureOptionsResidente.length!==0?t.featureOptionsResidente:t.featureOptions,headers:t.headers,data:t.filesResidente,showOptions:t.canEditResidente,tableName:"residente"},null,8,["options","headers","data","showOptions"])])):_("",!0),t.filesAreaRevisora.length?(f(),m("div",Oe,[r(n,{title:"Documentos de Área Revisora"}),r(c,{description:"Área Revisora",options:t.featureOptionsAreaRevisora.length!==0?t.featureOptionsAreaRevisora:t.featureOptions,headers:t.headers,data:t.filesAreaRevisora,showOptions:t.canEditAreaRevisora,tableName:"area-revisora"},null,8,["options","headers","data","showOptions"])])):_("",!0),t.filesFinanzas.length?(f(),m("div",Be,[r(n,{title:"Documentos de Finanzas"}),r(c,{description:"Finanzas",options:t.featureOptionsFianzas.length!==0?t.featureOptionsFianzas:t.featureOptions,headers:t.headers,data:t.filesFinanzas,showOptions:t.canEditFinanzas,tableName:"finanzas"},null,8,["options","headers","data","showOptions"])])):_("",!0),t.filesTramite_Pago.length?(f(),m("div",Ae,[r(n,{title:"Documentos de Registro de Pago"}),r(c,{description:"Registro de Pago",options:t.featureOptionsTramiteDePago.length!==0?t.featureOptionsTramiteDePago:t.featureOptions,headers:t.headers,data:t.filesTramite_Pago,showOptions:t.canEditPago,tableName:"pago"},null,8,["options","headers","data","showOptions"])])):_("",!0)])])}const Ge=T(pe,[["render",ze]]);export{Ge as default};
