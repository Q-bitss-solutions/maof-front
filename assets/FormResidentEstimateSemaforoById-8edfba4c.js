import{I as T}from"./InputBase-35917134.js";import{B as z}from"./fetchApi-cf1b52b8.js";import{S as B}from"./SelectBase-ea9bd5d6.js";import{T as S}from"./TextAreaBase-e29c2375.js";import{u as F,d as A,e as U}from"./residentEstimate-98c0bfae.js";import{_ as P,a as M,u as O,m as I,s as N,b as k,o as s,c as l,d as f,t as b,e as o,F as g,f as h,h as _,g as q}from"./index-aacd3d9f.js";import{S as m}from"./sweetalert2.all-281a79b7.js";import{u as L,c as u,m as R,a as C}from"./index-e8591526.js";const G={name:"FormResidentEstimate",props:{editMode:{type:Boolean,default:!1},residentEstimate:{type:Object,default:()=>({})}},components:{InputBase:T,ButtonBase:z,SelectBase:B,TextAreaBase:S},setup(p){const t=M(),{rol:V}=t.getAuthData,e=Object.freeze({sendReviewArea:{id:3,obs_label:"Observaciones para el Área Revisora",title:"En esta fecha se enviará la Estimación al Área Revisora",exito:"Estimación enviada al Área Revisora con éxito!"},sendFinance:{id:5,obs_label:"Observaciones para Finanzas",title:"En esta fecha se enviará la Estimación a Finanzas",exito:"Estimación enviada Finanzas con éxito!"},returnToResident:{id:4,obs_label:"Observaciones para el Residente",title:"En esta fecha se regresará la Estimación al Residente",exito:"Estimación enviada al Residente con éxito!"},returnToReviewArea:{id:6,obs_label:"Observaciones para el Área Revisora",title:"En esta fecha se regresará la Estimación al Área Revisora",exito:"Estimación enviada al Área Revisora con éxito!"},sendToPaymentProcess:{id:7,obs_label:"Observaciones para el Trámite de Pago",title:"En esta fecha se enviará la Estimación al Trámite de Pago",exito:"Estimación enviada al Trámite de Pago con éxito!"},returnToFinance:{id:8,obs_label:"Observaciones para el Finanzas",title:"En esta fecha se regresará la Estimación a Finanzas",exito:"Estimación enviada al área de Finanzas con éxito!"},savePayment:{id:9,obs_label:"Observaciones para el Registro de Pago",title:"En esta fecha quedará Registro de Pago de la Estimación",exito:"Pago registrado con éxito!",warning_modal:{title:"Una vez registrado el pago no será posible modificar la Estimación. Esta acción no es reversible."}}}),x=O(),i=I({residentEstimate:{id_contrato:"",fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",importe_obra_ejecutada:"",importe_pagar:"",grado_avance_obra:"",porcentaje_avance_estimacion:"",porcentaje_avance_estimacion_acumulado:"",porcentaje_avance_fisico:"",porcensaje_avance_financiero:"",observaciones_residente:""},fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",contratoName:"",estatus_semaforo:"",fileInfo:{type:Object,default:()=>({})},listReviewAreas:[],listEmpleados:[],listContrato:[]}),n=c=>{let r=[];return r=c.split(" "),r=r[0].split("-"),r=r[0]+"-"+r[1]+"-"+r[2],c=r,c},d=()=>{let c=new Date;var r=("0"+c.getDate()).slice(-2),E=("0"+(c.getMonth()+1)).slice(-2),v=c.getFullYear(),y=v+"-"+E+"-"+r;return!(i.fecha_autorizacion_contratista>y)},a=N(()=>({porcentaje_avance_estimacion:{maxValue:u.withMessage("El valor maximo es 100%",R(100)),minValue:u.withMessage("El valor minimo es 0%",C(0))},porcentaje_avance_estimacion_acumulado:{maxValue:u.withMessage("El valor maximo es 100%",R(100)),minValue:u.withMessage("El valor minimo es 0%",C(0))},porcentaje_avance_fisico:{maxValue:u.withMessage("El valor maximo es 100%",R(100)),minValue:u.withMessage("El valor minimo es 0%",C(0))},porcensaje_avance_financiero:{maxValue:u.withMessage("El valor maximo es 100%",R(100)),minValue:u.withMessage("El valor minimo es 0%",C(0))},grado_avance_obra:{maxValue:u.withMessage("El valor maximo es 100%",R(100)),minValue:u.withMessage("El valor minimo es 0%",C(0))},fecha_autorizacion_contratista:{fechaActualFunction:u.withMessage("La fecha es mayor al dia de hoy",d)}})),w=L(a,p.residentEstimate);return p.editMode&&(i.residentEstimate=p.residentEstimate,i.estatus_semaforo=p,i.fecha_recepcion_info_contratista=n(p.residentEstimate.fecha_recepcion_info_contratista),p.residentEstimate.fecha_autorizacion_contratista===null?i.fecha_autorizacion_contratista=null:i.fecha_autorizacion_contratista=n(p.residentEstimate.fecha_autorizacion_contratista),i.fecha_periodo_inicio_estimacion=n(p.residentEstimate.fecha_periodo_inicio_estimacion),i.fecha_periodo_fin_estimacion=n(p.residentEstimate.fecha_periodo_fin_estimacion)),{STATUS:e,app:i,v$:w,editForm:()=>{var r=new Date().toLocaleTimeString("en-GB");i.residentEstimate.fecha_recepcion_info_contratista=i.fecha_recepcion_info_contratista+" "+r,i.fecha_autorizacion_contratista===null||i.fecha_autorizacion_contratista===""?i.residentEstimate.fecha_autorizacion_contratista=null:i.residentEstimate.fecha_autorizacion_contratista=i.fecha_autorizacion_contratista+" "+r,i.residentEstimate.fecha_periodo_inicio_estimacion=i.fecha_periodo_inicio_estimacion+" "+r,i.residentEstimate.fecha_periodo_fin_estimacion=i.fecha_periodo_fin_estimacion+" "+r,m.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async E=>{if(E.isConfirmed)try{await w.value.$validate()?(await F(i.residentEstimate),m.fire("¡Éxito!","Actualización con éxito!","success"),x.push({name:"ResidentEstimate"})):m.fire("Error","Revisa bien los datos","error")}catch(v){m.fire("Error",`${v.response.data.detail}`,"error")}})},deleteForm:()=>{m.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async c=>{if(c.isConfirmed)try{await A(i.residentEstimate,i.residentEstimate.id_estimacion),m.fire("¡Éxito!","Actualización con éxito!","success"),x.push({name:"ResidentEstimate"})}catch(r){m.fire("Error",`${r.response.data.detail}`,"error")}})},formatFecha:n,back:()=>x.push({name:"ResidentEstimate"}),goToArchivos:()=>x.push({name:"FilesResidentEstimate",params:{residentEstimateId:i.residentEstimate.id_estimacion}}),changeStatus:async c=>{new Date().toLocaleTimeString("en-GB");try{const{value:E}=await m.fire({input:"textarea",inputLabel:c.obs_label,inputPlaceholder:"Escribe tus observaciones...",inputAttributes:{"aria-label":"Type your message here"},showCancelButton:!0,reverseButtons:!0,inputValidator:v=>{if(!v)return"El campo es requerido"}});if(E!==void 0){const v=await m.fire({title:c.title,icon:"question",showCancelButton:!0,text:"¿Está usted seguro?",cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0});if(v.isConfirmed){let y=v.isConfirmed;if(c.warning_modal){const j=await m.fire({title:c.warning_modal.title,icon:"warning",showCancelButton:!0,text:"¿Está usted seguro?",cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0});y=y&&j.isConfirmed}y&&(await U(i.residentEstimate.id_estimacion,{estatus_estimacion:c.id,observaciones:E,id_estimacion:i.residentEstimate.id_estimacion}),m.fire("¡Éxito!",c.exito,"success"),x.push({name:"ResidentEstimate"}))}}else m.fire("No agregaste ninguna observación","Agrega uno para continuar","warning")}catch(E){m.fire("Error",`${E.response.data.detail}`,"error")}},rol:V}}},D={class:"flex flex-row justify-between"},Y={class:"font-bold text-lg"},H={class:"font-bold text-lg w-128"},J={class:"flex content-start justify-end items-center mb-10"},K={class:"items-center justify-center"},Q=f("h1",{class:"font-bold text-lg text-center"},"Número de la Estimación",-1),W={class:"text-center font-semibold text-lg numEstimacion"},X={class:"max-w-xl mx-auto"},Z={class:"flex flex-row"},$={key:0,class:"flex justify-between items-center py-4"},ee={key:1,class:"flex justify-between items-center py-4"},ae={key:2,class:"flex justify-between items-center py-4"},te={key:3,class:"flex justify-between items-center py-4"},ie={key:4,class:"flex justify-center items-center py-4"};function oe(p,t,V,e,x,i){const n=k("button-base"),d=k("input-base");return s(),l(g,null,[f("div",D,[f("div",Y,b(e.app.residentEstimate.numero_contrato),1),f("div",H," Objeto: "+b(e.app.residentEstimate.objeto_contrato),1),f("div",J,[f("div",K,[Q,f("p",W,b(e.app.residentEstimate.num_consecutivo_estimacion),1)])])]),o(n,{label:"Archivos",onClick:e.goToArchivos,class:"mb-3 mr-0 ml-auto"},null,8,["onClick"]),f("div",X,[o(d,{id:"fecha_recepcion_info_contratista",label:"Fecha de recepción de información del Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_recepcion_info_contratista,"onUpdate:modelValue":t[0]||(t[0]=a=>e.app.fecha_recepcion_info_contratista=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"||e.rol!="Residente"},null,8,["modelValue","disabled"]),o(d,{id:"fecha_autorizacion_contratista",label:"Fecha de autorización al Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_autorizacion_contratista,"onUpdate:modelValue":t[1]||(t[1]=a=>e.app.fecha_autorizacion_contratista=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"||e.rol!="Residente"},null,8,["modelValue","disabled"]),e.v$.fecha_autorizacion_contratista.$error?(s(!0),l(g,{key:0},h(e.v$.fecha_autorizacion_contratista.$errors,a=>(s(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},b(a.$message),1))),128)):_("",!0),f("div",Z,[f("div",null,[o(d,{id:"fecha_periodo_inicio_estimacion",label:"Período de la Estimación",type:"date",modelValue:e.app.fecha_periodo_inicio_estimacion,"onUpdate:modelValue":t[2]||(t[2]=a=>e.app.fecha_periodo_inicio_estimacion=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"||e.rol!="Residente"},null,8,["modelValue","disabled"])]),f("div",null,[o(d,{id:"fecha_periodo_fin_estimacion",label:"al",type:"date",class:"pt-2",modelValue:e.app.fecha_periodo_fin_estimacion,"onUpdate:modelValue":t[3]||(t[3]=a=>e.app.fecha_periodo_fin_estimacion=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"||e.rol!="Residente"},null,8,["modelValue","disabled"])])]),o(d,{id:"importe_obra_ejecutada",label:"Importe de la obra ejecutada",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_obra_ejecutada,"onUpdate:modelValue":t[4]||(t[4]=a=>e.app.residentEstimate.importe_obra_ejecutada=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"||e.rol!="Residente"},null,8,["modelValue","disabled"]),o(d,{id:"importe_pagar",label:"Importe a pagar",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_pagar,"onUpdate:modelValue":t[5]||(t[5]=a=>e.app.residentEstimate.importe_pagar=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"||e.rol!="Residente"},null,8,["modelValue","disabled"]),o(d,{id:"grado_avance_obra",label:"% de grado de avance",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.grado_avance_obra,"onUpdate:modelValue":t[6]||(t[6]=a=>e.app.residentEstimate.grado_avance_obra=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"||e.rol!="Residente"},null,8,["modelValue","disabled"]),e.v$.grado_avance_obra.$error?(s(!0),l(g,{key:1},h(e.v$.grado_avance_obra.$errors,a=>(s(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},b(a.$message),1))),128)):_("",!0),o(d,{id:"porcentaje_avance_estimacion",label:"% de avance de la Estimación",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion,"onUpdate:modelValue":t[7]||(t[7]=a=>e.app.residentEstimate.porcentaje_avance_estimacion=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"||e.rol!="Residente"},null,8,["modelValue","disabled"]),e.v$.porcentaje_avance_estimacion.$error?(s(!0),l(g,{key:2},h(e.v$.porcentaje_avance_estimacion.$errors,a=>(s(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},b(a.$message),1))),128)):_("",!0),o(d,{id:"porcentaje_avance_estimacion_acumulado",label:"% de avance de la Estimación acumulado",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion_acumulado,"onUpdate:modelValue":t[8]||(t[8]=a=>e.app.residentEstimate.porcentaje_avance_estimacion_acumulado=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"||e.rol!="Residente"},null,8,["modelValue","disabled"]),e.v$.porcentaje_avance_estimacion_acumulado.$error?(s(!0),l(g,{key:3},h(e.v$.porcentaje_avance_estimacion_acumulado.$errors,a=>(s(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},b(a.$message),1))),128)):_("",!0),o(d,{id:"porcentaje_avance_fisico",label:"% de avance físico",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_fisico,"onUpdate:modelValue":t[9]||(t[9]=a=>e.app.residentEstimate.porcentaje_avance_fisico=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"||e.rol!="Residente"},null,8,["modelValue","disabled"]),e.v$.porcentaje_avance_fisico.$error?(s(!0),l(g,{key:4},h(e.v$.porcentaje_avance_fisico.$errors,a=>(s(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},b(a.$message),1))),128)):_("",!0),o(d,{id:"porcensaje_avance_financiero",label:"% de avance financiero",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcensaje_avance_financiero,"onUpdate:modelValue":t[10]||(t[10]=a=>e.app.residentEstimate.porcensaje_avance_financiero=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"||e.rol!="Residente"},null,8,["modelValue","disabled"]),e.v$.porcensaje_avance_financiero.$error?(s(!0),l(g,{key:5},h(e.v$.porcensaje_avance_financiero.$errors,a=>(s(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},b(a.$message),1))),128)):_("",!0)]),e.app.residentEstimate.estatus_semaforo==="Residente"&&e.rol=="Residente"?(s(),l("div",$,[e.app.residentEstimate.estatus_estimacion==="Capturada por Residente"||e.app.residentEstimate.estatus_estimacion==="Autorizada por Residente"?(s(),q(n,{key:0,label:"Inactivar Estimación",class:"px-4",onClick:e.deleteForm},null,8,["onClick"])):_("",!0),o(n,{label:"Actualizar datos",class:"px-4",onClick:e.editForm},null,8,["onClick"]),o(n,{label:"Enviar al área revisora",class:"px-4",onClick:t[11]||(t[11]=a=>e.changeStatus(e.STATUS.sendReviewArea))})])):_("",!0),e.app.residentEstimate.estatus_semaforo==="Area Revisora"&&(e.rol.includes("Área revisora")||e.rol.includes("Obras y Contratos"))?(s(),l("div",ee,[o(n,{label:"Regresar a  Residente",class:"px-4",onClick:t[12]||(t[12]=a=>e.changeStatus(e.STATUS.returnToResident))}),o(n,{label:"Cancelar",class:"px-4",onClick:e.back},null,8,["onClick"]),o(n,{label:"Enviar a finanzas",class:"px-4",onClick:t[13]||(t[13]=a=>e.changeStatus(e.STATUS.sendFinance))})])):_("",!0),e.app.residentEstimate.estatus_semaforo==="Finanzas"&&e.rol.includes("Finanzas")?(s(),l("div",ae,[o(n,{label:"Regresar al área revisora",class:"px-4",onClick:t[14]||(t[14]=a=>e.changeStatus(e.STATUS.returnToReviewArea))}),o(n,{label:"Cancelar",class:"px-4",onClick:e.back},null,8,["onClick"]),o(n,{label:"Enviar a trámite de pago",class:"px-4",onClick:t[15]||(t[15]=a=>e.changeStatus(e.STATUS.sendToPaymentProcess))})])):_("",!0),e.app.residentEstimate.estatus_semaforo==="Tramite de Pago"&&e.rol.includes("Finanzas")?(s(),l("div",te,[o(n,{label:"Regresar a Finanzas",class:"px-4",onClick:t[16]||(t[16]=a=>e.changeStatus(e.STATUS.returnToFinance))}),o(n,{label:"Cancelar",class:"px-4",onClick:e.back},null,8,["onClick"]),o(n,{label:"Registrar Pago",class:"px-4",onClick:t[17]||(t[17]=a=>e.changeStatus(e.STATUS.savePayment))})])):_("",!0),e.app.residentEstimate.estatus_semaforo==="Pago Efectuado"?(s(),l("div",ie,[o(n,{label:"Regresar",class:"px-4",onClick:e.back},null,8,["onClick"])])):_("",!0)],64)}const Ee=P(G,[["render",oe]]);export{Ee as F};
