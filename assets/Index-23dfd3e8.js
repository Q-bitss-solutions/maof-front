import{T as L}from"./TableUsers-9a9acbe3.js";import{S}from"./SelectBase-4b15a31f.js";import{B as x,a as T}from"./fetchApi-ea3a2dff.js";import{_ as E,m as G,s as I,b as y,o as _,c as V,e as f,d as m,F as M,f as U,t as B,h as C,r as w,J,B as W,g as D,n as K,I as Q,u as X}from"./index-ae47c3ce.js";import{T as Y}from"./TitleBar-95cae43a.js";import{I as Z}from"./InputBase-f2420b6e.js";import{f as j}from"./contract-9a9b5be4.js";import{f as $}from"./resident-e7679e41.js";import{a as ee}from"./SICTUnits-72dfc181.js";import{k as te}from"./residentEstimate-9b67d988.js";import{S as h}from"./sweetalert2.all-281a79b7.js";import{u as ae,c as k,a as O}from"./index-85c6b0d5.js";import{f as oe}from"./project-58651c53.js";import{c as se}from"./consultas-cf193206.js";import{C as le}from"./CustomHeaderApp-790e617d.js";import"./ArrowBack-858e36ad.js";import"./HomePage-790bb899.js";import"./LogoutComponent-26312cbb.js";const ie={name:"FormProject",props:{editMode:{type:Boolean,default:!1},project:{type:Object,default:()=>({})},showBusqueda:{type:Function,required:!0}},components:{InputBase:Z,ButtonBase:x,SelectBase:S},setup(n,{emit:o}){const e=G({busqueda:{id_contrato:"",id_residente:"",mes_estimacion:"",año_estimacion:"",estatus_estimacion:"",unidad_maof:"",dias_transcurridos:[],fechas_autorizacion:[]},listMesEstimacion:[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiempbre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}],diasInicio:"",diasFin:"",fechaInicio:"",fechaFin:"",listAnios:[],listC_CC_CM:[],listResident:[],listUnitMAOF:[],listStatusEstimate:[]}),t=I(()=>({diasFin:{minValue:k.withMessage("El valor mínimo es 1",O(1)),customValidation:k.withMessage("El valor de días inicio debe ser menor que días fin",b=>e.diasInicio!==""&&e.diasFin!==""?e.diasInicio<e.diasFin:!0)},diasInicio:{minValue:k.withMessage("El valor mínimo es 0",O(0))}})),v=ae(t,e),F=I(()=>{const{id_contrato:b,id_residente:l,mes_estimacion:a,año_estimacion:d,estatus_estimacion:r,unidad_maof:i}=e.busqueda,{diasInicio:g,diasFin:N,fechaInicio:z,fechaFin:H}=e;return!b&&!l&&!a&&!d&&!r&&!i&&!g&&!N&&!z&&!H}),u=async()=>{const b={activate_filters:!0};try{const{data:l}=await j(b);e.listC_CC_CM=l.map(a=>({value:a.id_contrato,label:a.numero_contrato})),e.listC_CC_CM.sort((a,d)=>a.label>d.label?1:a.label<d.label?-1:0)}catch(l){h.fire("¡Error!",`${l.response.data.detail}`,"error"),n.showBusqueda()}},c=async()=>{const b={activate_filters:!0},{data:l}=await $(b);e.listResident=l.map(a=>({value:a.id_residente,label:a.nombre_completo})),e.listResident.sort((a,d)=>a.label>d.label?1:a.label<d.label?-1:0)},p=async()=>{const{data:b}=await ee();e.listUnitMAOF=b.map(l=>({value:l.id_unidad_maof,label:l.unidad})),e.listUnitMAOF.sort((l,a)=>l.label>a.label?1:l.label<a.label?-1:0)},s=async()=>{const{data:b}=await te();e.listStatusEstimate=b.map(l=>({value:l.clave_estatus_estimacion,label:l.estatus_estimacion})),e.listStatusEstimate.sort((l,a)=>l.label>a.label?1:l.label<a.label?-1:0)},q=b=>{for(let l=0;l<b;l++)e.listAnios.push({value:2023+l,label:`${2023+l}`})},A=async()=>{if(await v.value.$validate())e.diasInicio!==""&&(e.busqueda.dias_transcurridos.push(e.diasInicio),e.diasInicio=""),e.diasFin!==""&&(e.busqueda.dias_transcurridos.push(e.diasFin),e.diasFin=""),e.fechaInicio!==""&&(e.busqueda.fechas_autorizacion.push(e.fechaInicio),e.fechaInicio=""),e.fechaFin!==""&&(e.busqueda.fechas_autorizacion.push(e.fechaFin),e.fechaFin=""),o("submit",e.busqueda);else for(let l=0;l<v.value.$errors.length;l++)await h.fire({title:v.value.$errors[l].$message,icon:"error"})};return u(),c(),p(),s(),q(10),{app:e,isFormEmpty:F,v$:v,sendForm:A,getC_CC_CM:u,getResident:c,getUnitMAOF:p,getStatusEstimate:s,generateAnios:q}}},ne={class:"max-w-6xl pb-10 grow"},re=m("p",{class:"w-[17rem]"},"*Contrato, Convenio de Colaboración, Convenio Modificatorio",-1),de={class:"grid grid-cols-2"},ue={class:"grid"},ce={class:"grid grid-cols-2 pt-3"};function me(n,o,e,t,v,F){const u=y("select-base"),c=y("input-base"),p=y("button-base");return _(),V("div",ne,[re,f(u,{id:"clave_cartera",label:"C, CC, CM*",options:t.app.listC_CC_CM,class:"mb-3",modelValue:t.app.busqueda.id_contrato,"onUpdate:modelValue":o[0]||(o[0]=s=>t.app.busqueda.id_contrato=s)},null,8,["options","modelValue"]),f(u,{id:"nombre_proyecto",label:"Residente",options:t.app.listResident,class:"mb-3",modelValue:t.app.busqueda.id_residente,"onUpdate:modelValue":o[1]||(o[1]=s=>t.app.busqueda.id_residente=s)},null,8,["options","modelValue"]),f(u,{id:"nombre_proyecto",label:"Mes de la Estimación",options:t.app.listMesEstimacion,class:"mb-3",modelValue:t.app.busqueda.mes_estimacion,"onUpdate:modelValue":o[2]||(o[2]=s=>t.app.busqueda.mes_estimacion=s)},null,8,["options","modelValue"]),f(u,{id:"nombre_proyecto",label:"Año de la Estimación",options:t.app.listAnios,class:"mb-3",modelValue:t.app.busqueda.año_estimacion,"onUpdate:modelValue":o[3]||(o[3]=s=>t.app.busqueda.año_estimacion=s)},null,8,["options","modelValue"]),f(u,{id:"nombre_proyecto",label:"Estatus de la Estimación",class:"mb-3",options:t.app.listStatusEstimate,modelValue:t.app.busqueda.estatus_estimacion,"onUpdate:modelValue":o[4]||(o[4]=s=>t.app.busqueda.estatus_estimacion=s)},null,8,["options","modelValue"]),f(u,{id:"nombre_proyecto",label:"Unidad MAOF responsable",options:t.app.listUnitMAOF,class:"mb-3",modelValue:t.app.busqueda.unidad_maof,"onUpdate:modelValue":o[5]||(o[5]=s=>t.app.busqueda.unidad_maof=s)},null,8,["options","modelValue"]),m("div",de,[f(c,{id:"dias_inicio",label:"Días transcurridos del",type:"number",class:"grow",modelValue:t.app.diasInicio,"onUpdate:modelValue":o[6]||(o[6]=s=>t.app.diasInicio=s)},null,8,["modelValue"]),f(c,{id:"dias_fin",label:"al",type:"number",class:"flex-auto",modelValue:t.app.diasFin,"onUpdate:modelValue":o[7]||(o[7]=s=>t.app.diasFin=s)},null,8,["modelValue"])]),m("div",ue,[t.v$.diasInicio.$error?(_(!0),V(M,{key:0},U(t.v$.diasInicio.$errors,s=>(_(),V("span",{key:s,class:"text-red font-semibold text-center ml-80"},B(s.$message),1))),128)):C("",!0),t.v$.diasFin.$error?(_(!0),V(M,{key:1},U(t.v$.diasFin.$errors,s=>(_(),V("span",{key:s,class:"text-red font-semibold text-center ml-80"},B(s.$message),1))),128)):C("",!0)]),m("div",ce,[f(c,{id:"fecha_inicio",label:"Autorización entre",type:"date",class:"grow",modelValue:t.app.fechaInicio,"onUpdate:modelValue":o[8]||(o[8]=s=>t.app.fechaInicio=s)},null,8,["modelValue"]),f(c,{id:"fecha_fin",label:"y",type:"date",class:"",modelValue:t.app.fechaFin,"onUpdate:modelValue":o[9]||(o[9]=s=>t.app.fechaFin=s)},null,8,["modelValue"])]),f(p,{label:"Buscar",onClick:t.sendForm,class:"mr-0 ml-auto mt-5",disabled:t.isFormEmpty},null,8,["onClick","disabled"])])}const P=E(ie,[["render",me]]),R=n=>T({url:"/agenda_estimacion/filtros/",method:"GET",params:n||{}}),fe=n=>T({url:"/agenda_estimacion/busqueda/",method:"GET",params:n||{}}),pe=n=>T({url:"/agenda_estimacion/responsable_estimacion/",method:"GET",params:n||{}}),be="/maof-front/assets/Filter-fb6d2bbc.png";const _e={props:{filtro:{type:Object,required:!0},getDocsByType:{type:Function,required:!0},saveFiltro:{type:Function,required:!0},esperandoAccion:{type:Function,required:!1}},components:{SelectBase:S,ButtonBase:x},setup(n){const o=w(null),e=w(null),t=()=>{Q(()=>{var c;const F=(c=o.value)==null?void 0:c.$el.offsetWidth;if(!F)return;const u=F+8;e.value&&(e.value.$el.style.marginLeft=`${u}px`)})};J(()=>{t(),window.addEventListener("resize",t)}),W(()=>{window.removeEventListener("resize",t)});const v=I(()=>({"ml-[8rem]":n.filtro.tipoDocumento==="1","ml-[3.7rem]":n.filtro.tipoDocumento!=="1"&&n.filtro.filtroDocValue==="","ml-[0rem]":n.filtro.tipoDocumento!=="1"&&n.filtro.filtroDocValue!==""}));return{selectBaseRef:o,buttonBaseRef:e,ajustarDistancia:t,buttonClass:v}}},ve={class:"flex justify-start items-center pb-10"},ge=m("img",{src:be,alt:"filter",class:"w-10 items-center"},null,-1);function he(n,o,e,t,v,F){const u=y("select-base"),c=y("button-base");return _(),V("div",ve,[ge,f(u,{label:"Filtros",class:"text-center w-48 mr-9",id:"filtros",options:e.filtro.listFiltros,modelValue:e.filtro.tipoDocumento,"onUpdate:modelValue":o[0]||(o[0]=p=>e.filtro.tipoDocumento=p),onChange:o[1]||(o[1]=p=>e.getDocsByType(e.filtro.tipoDocumento))},null,8,["options","modelValue"]),e.filtro.listDocsFiltrados!==""&&e.filtro.tipoDocumento!==""&&e.filtro.tipoDocumento!=="4"?(_(),D(u,{key:0,ref:t.selectBaseRef,label:"",class:"text-center w-48 ml-36",id:"filtrosDocs",options:e.filtro.listDocsFiltrados,modelValue:e.filtro.filtroDocValue,"onUpdate:modelValue":o[2]||(o[2]=p=>e.filtro.filtroDocValue=p)},null,8,["options","modelValue"])):C("",!0),e.filtro.listDocsFiltrados!==""&&e.filtro.tipoDocumento!==""&&e.filtro.tipoDocumento!=="4"?(_(),D(c,{key:1,ref:t.buttonBaseRef,label:"Aplicar",class:K(["border-gray text-black hover:bg-white hover:text-red",t.buttonClass]),onClick:o[3]||(o[3]=p=>e.saveFiltro(e.filtro.filtroDocValue,e.filtro.tipoDocumento)),disabled:e.filtro.filtroDocValue===""},null,8,["class","disabled"])):C("",!0),e.filtro.tipoDocumento==="4"?(_(),D(c,{key:2,label:"Aplicar",class:"ml-40 border-gray text-black hover:bg-white hover:text-red",onClick:o[4]||(o[4]=p=>e.esperandoAccion())})):C("",!0)])}const ye=E(_e,[["render",he]]),Fe="/maof-front/assets/Search-94489079.png",Ve={components:{ButtonBase:x,FormConsultaBusqueda:P},props:{showBusquedaValue:{type:Boolean,required:!0},showBusqueda:{type:Function,required:!0},saveBusqueda:{type:Function,required:!0}}},qe={class:"flex justify-start items-center pt-10"},Ce=m("img",{src:Fe,alt:"filter",class:"w-10 items-center"},null,-1),Be=m("h1",{class:"text-center font-bold text-lg"},"Búsqueda",-1),De={class:"flex justify-center"};function we(n,o,e,t,v,F){const u=y("button-base"),c=y("form-consulta-busqueda");return _(),V(M,null,[m("div",qe,[Ce,Be,f(u,{label:"Criterio de búsqueda",class:"ml-5 border-gray text-black hover:bg-white hover:text-red",onClick:e.showBusqueda},null,8,["onClick"])]),m("div",De,[e.showBusquedaValue?(_(),D(c,{key:0,onSubmit:e.saveBusqueda,class:"mt-20",showBusqueda:e.showBusqueda},null,8,["onSubmit","showBusqueda"])):C("",!0)])],64)}const xe=E(Ve,[["render",we]]);const Ee={name:"UsersRolesMAOFIndex",components:{TableBase:L,ButtonBase:x,TitleBar:Y,SelectBase:S,FormConsultaBusqueda:P,Filtro:ye,Busqueda:xe,CustomHeaderApp:le},setup(){const n=X(),o=se(),e=w({filtro:{tipoDocumento:"",listFiltros:[{value:2,label:"Contrato o Convenio de Colaboración"},{value:3,label:"Convenio Modificatorio"},{value:4,label:"Estimaciones bajo su responsabilidad"},{value:1,label:"Proyecto / Cartera de inversión"}],listDocsFiltrados:[],filtroDocValue:"",data:{pendientes:[],pagados:[],totales:[]}},loading:!0});let t=w(!1);const v=(a,d)=>{switch(d){case"pendientes":a.length>0?(o.addPendientes(a),n.push({name:"ConsultasPedientesMAOF"})):h.fire("No hay estimaciones","Intenta con otro filtro","warning");break;case"pagadas":a.length>0?(o.addPagados(a),n.push({name:"ConsultasPagadosMAOF"})):h.fire("No hay estimaciones","Intenta con otro filtro","warning");break;case"totales":a.length>0?(o.addTotal(a),n.push({name:"ConsultasTotalesMAOF"})):h.fire("No hay estimaciones","Intenta con otro filtro","warning");break;default:console.log("opcion invalida");break}},F=async a=>{switch(t.value===!0&&(t.value=!1),a){case"1":e.value.filtro.listDocsFiltrados=[],e.value.filtro.filtroDocValue="",u();break;case"2":e.value.filtro.listDocsFiltrados=[],e.value.filtro.filtroDocValue="",c(a);break;case"3":e.value.filtro.listDocsFiltrados=[],e.value.filtro.filtroDocValue="",c(a);break;case"4":e.value.filtro.listDocsFiltrados=[],e.value.filtro.filtroDocValue="";break;default:console.log("No se encontro nada");break}},u=async()=>{const a={estatus_proyecto:3,activate_filters:!0};try{const{data:d}=await oe(a);e.value.filtro.listDocsFiltrados=d.map(r=>({value:r.id_proyecto,label:`${r.clave_cartera}-${r.nombre_proyecto}`}))}catch(d){h.fire("Error",`${d.response.data.detail}`,"error"),e.value.filtro.tipoDocumento="",e.value.filtro.filtroDocValue=""}},c=async a=>{const d={activate_filters:!0};try{const{data:r}=await j(d);a==="2"&&(r.forEach(i=>{i.id_tipo_contrato!==3&&e.value.filtro.listDocsFiltrados.push({value:i.id_contrato,label:i.numero_contrato})}),e.value.filtro.listDocsFiltrados.sort((i,g)=>i.label>g.label?1:i.label<g.label?-1:0)),a==="3"&&(r.forEach(i=>{i.id_tipo_contrato===3&&e.value.filtro.listDocsFiltrados.push({value:i.id_contrato,label:i.numero_contrato})}),e.value.filtro.listDocsFiltrados.sort((i,g)=>i.label>g.label?1:i.label<g.label?-1:0))}catch(r){h.fire("Error",`${r.response.data.detail}`,"error"),e.value.filtro.tipoDocumento="",e.value.filtro.filtroDocValue=""}},p=()=>{e.value.filtro.tipoDocumento="",e.value.filtro.filtroDocValue="",t.value=!t.value},s=(a,d,r)=>{o.addPendientes(a),o.addPagados(d),o.addTotal(r)},q=async()=>{e.value.loading=!0;try{const{data:a}=await R();e.value.filtro.data.totales=a.total,e.value.filtro.data.pagados=a.pagadas,e.value.filtro.data.pendientes=a.pendiente,s(a.pendiente,a.pagadas,a.total)}catch(a){h.fire("Error",`${a.response.data.detail}`,"error"),n.push({name:"Home"})}e.value.loading=!1},A=async a=>{const d=Object.entries(a).filter(([r,i])=>Array.isArray(i)?i.length>0:i!=="").reduce((r,[i,g])=>(Array.isArray(g)?r[i]=g.join(","):r[i]=g,r),{});try{const{data:r}=await fe(d);r.length?(o.addBusqueda(r),n.push({name:"ConsultasBusquedaMAOF"})):h.fire("Error","No hay resultados para estos criterios","error")}catch(r){h.fire("Error",`${r.response.data.detail}`,"error"),p()}},b=async(a,d)=>{e.value.loading=!0;let r={};d==="1"?r={id_proyecto:a}:(d==="2"||d==="3")&&(r={id_contrato:a});const{data:i}=await R(r);e.value.filtro.data.totales=i.total,e.value.filtro.data.pagados=i.pagadas,e.value.filtro.data.pendientes=i.pendiente,s(i.pendiente,i.pagadas,i.total),e.value.loading=!1},l=async()=>{e.value.loading=!0;try{const{data:a}=await pe();o.addResponsableEstimacion(a),e.value.loading=!1,n.push({name:"ResponsableEstimacionMAOF"})}catch(a){h.fire("Error",`${a.response.data.detail}`,"error"),e.value.filtro.tipoDocumento="",e.value.filtro.filtroDocValue="",e.value.loading=!1}};return q(),{app:e,showBusquedaValue:t,getStatusEstimations:v,showBusqueda:p,saveBusqueda:A,saveFiltro:b,getDocsByType:F,getProjects:u,getContracts:c,getFiltroDefault:q,infoToStore:s,esperandoAccion:l}}},Ae={class:"px-4 mt-10"},ke={class:"px-4"},Ie={key:0,class:"flex justify-center text-3xl"},Me={class:"text-center"},Se=m("h1",{class:"text-center"},"Pendientes",-1),Te={class:"text-center"},Ue=m("h1",{class:"text-center"},"Pagadas",-1),Oe={class:"text-center"},Re=m("h1",{class:"text-center"},"Total",-1),je={class:"flex flex-col mt-20"};function Pe(n,o,e,t,v,F){const u=y("CustomHeaderApp"),c=y("title-bar"),p=y("Filtro"),s=y("Busqueda");return _(),V("main",Ae,[f(u),f(c,{title:"Consulta MAOF",subtitle:"Agenda de Estimaciones"}),m("section",ke,[t.app.loading?C("",!0):(_(),V("div",Ie,[m("div",{class:"px-10 text-red cursor-pointer",onClick:o[0]||(o[0]=q=>t.getStatusEstimations(t.app.filtro.data.pendientes,"pendientes"))},[m("p",Me,B(t.app.filtro.data.pendientes.length),1),Se]),m("div",{class:"px-10 text-green cursor-pointer",onClick:o[1]||(o[1]=q=>t.getStatusEstimations(t.app.filtro.data.pagados,"pagadas"))},[m("p",Te,B(t.app.filtro.data.pagados.length),1),Ue]),m("div",{class:"px-10 cursor-pointer",onClick:o[2]||(o[2]=q=>t.getStatusEstimations(t.app.filtro.data.totales,"totales"))},[m("p",Oe,B(t.app.filtro.data.totales.length),1),Re])])),m("div",je,[f(p,{filtro:t.app.filtro,getDocsByType:t.getDocsByType,saveFiltro:t.saveFiltro,esperandoAccion:t.esperandoAccion},null,8,["filtro","getDocsByType","saveFiltro","esperandoAccion"]),f(s,{showBusquedaValue:t.showBusquedaValue,showBusqueda:t.showBusqueda,saveBusqueda:t.saveBusqueda},null,8,["showBusquedaValue","showBusqueda","saveBusqueda"])])])])}const lt=E(Ee,[["render",Pe]]);export{lt as default};
