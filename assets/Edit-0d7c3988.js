import{I as A}from"./InputBase-1e130a99.js";import{B as F}from"./ButtonBase-3f995339.js";import{S as M}from"./SelectBase-42dd2d2d.js";import{T}from"./TextAreaBase-20d82624.js";import{A as U,T as I}from"./TitleBar-f1db6dc0.js";import{u as S,d as N,c as q,e as D}from"./residentEstimate-bdc9a3c3.js";import{_ as C,u as z,k as R,q as L,a as j,o as n,c as r,b as d,t as E,g as c,F as h,d as x,f,e as B,l as O}from"./index-fa0f6b5e.js";import{S as m}from"./sweetalert2.all-281a79b7.js";import{u as G,c as u,m as V,a as w}from"./index-af4bc9d0.js";const P={name:"FormResidentEstimate",props:{editMode:{type:Boolean,default:!1},residentEstimate:{type:Object,default:()=>({})}},components:{InputBase:A,ButtonBase:F,SelectBase:M,TextAreaBase:T},setup(l){const i=z(),t=R({residentEstimate:{id_contrato:"",fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",importe_obra_ejecutada:"",importe_pagar:"",grado_avance_obra:"",porcentaje_avance_estimacion:"",porcentaje_avance_estimacion_acumulado:"",porcentaje_Avance_fisico:"",porcensaje_avance_financiero:"",observaciones_residente:""},fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",contratoName:"",estatus_semaforo:"",fileInfo:{type:Object,default:()=>({})},listReviewAreas:[],listEmpleados:[],listContrato:[]}),e=_=>{let o=[];return o=_.split(" "),o=o[0].split("-"),o=o[0]+"-"+o[1]+"-"+o[2],_=o,_},g=()=>{let _=new Date;var o=("0"+_.getDate()).slice(-2),y=("0"+(_.getMonth()+1)).slice(-2),v=_.getFullYear(),k=v+"-"+y+"-"+o;return!(t.fecha_autorizacion_contratista>k)},b=L(()=>({porcentaje_avance_estimacion:{maxValue:u.withMessage("El valor maximo es 100%",V(100)),minValue:u.withMessage("El valor minimo es 0%",w(0))},porcentaje_avance_estimacion_acumulado:{maxValue:u.withMessage("El valor maximo es 100%",V(100)),minValue:u.withMessage("El valor minimo es 0%",w(0))},porcentaje_Avance_fisico:{maxValue:u.withMessage("El valor maximo es 100%",V(100)),minValue:u.withMessage("El valor minimo es 0%",w(0))},porcensaje_avance_financiero:{maxValue:u.withMessage("El valor maximo es 100%",V(100)),minValue:u.withMessage("El valor minimo es 0%",w(0))},grado_avance_obra:{maxValue:u.withMessage("El valor maximo es 100%",V(100)),minValue:u.withMessage("El valor minimo es 0%",w(0))},fecha_autorizacion_contratista:{fechaActualFunction:u.withMessage("La fecha es mayor al dia de hoy",g)}})),p=G(b,l.residentEstimate);return l.editMode&&(t.residentEstimate=l.residentEstimate,t.estatus_semaforo=l,t.fecha_recepcion_info_contratista=e(l.residentEstimate.fecha_recepcion_info_contratista),l.residentEstimate.fecha_autorizacion_contratista===null?t.fecha_autorizacion_contratista=null:t.fecha_autorizacion_contratista=e(l.residentEstimate.fecha_autorizacion_contratista),t.fecha_periodo_inicio_estimacion=e(l.residentEstimate.fecha_periodo_inicio_estimacion),t.fecha_periodo_fin_estimacion=e(l.residentEstimate.fecha_periodo_fin_estimacion)),{app:t,editForm:()=>{var o=new Date().toLocaleTimeString("en-GB");t.residentEstimate.fecha_recepcion_info_contratista=t.fecha_recepcion_info_contratista+" "+o,t.fecha_autorizacion_contratista===null||t.fecha_autorizacion_contratista===""?t.residentEstimate.fecha_autorizacion_contratista=null:t.residentEstimate.fecha_autorizacion_contratista=t.fecha_autorizacion_contratista+" "+o,t.residentEstimate.fecha_periodo_inicio_estimacion=t.fecha_periodo_inicio_estimacion+" "+o,t.residentEstimate.fecha_periodo_fin_estimacion=t.fecha_periodo_fin_estimacion+" "+o,m.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async y=>{if(y.isConfirmed)try{await p.value.$validate()?(await S(t.residentEstimate),m.fire("¡Éxito!","Actualización con éxito!","success"),i.push({name:"ResidentEstimate"})):m.fire("Error","Revisa bien los datos","error")}catch(v){m.fire("Error",`${v.response.data.detail}`,"error")}})},deleteForm:()=>{m.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async _=>{if(_.isConfirmed)try{await N(t.residentEstimate,t.residentEstimate.id_estimacion),m.fire("¡Éxito!","Actualización con éxito!","success"),i.push({name:"ResidentEstimate"})}catch(o){m.fire("Error",`${o.response.data.detail}`,"error")}})},sendReviewArea:()=>{var o=new Date().toLocaleTimeString("en-GB");t.fecha_autorizacion_contratista===null?t.residentEstimate.fecha_autorizacion_contratista=null:t.residentEstimate.fecha_autorizacion_contratista=t.fecha_autorizacion_contratista+" "+o,m.fire({title:"Se realizará el envio de la Estimación al área revisora",icon:"question",showCancelButton:!0,text:"¿Está usted seguro?",cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async y=>{if(y.isConfirmed)try{const{value:v}=await m.fire({input:"textarea",inputLabel:"Observaciones",inputPlaceholder:"Escribe tus observaciones...",inputAttributes:{"aria-label":"Type your message here"},showCancelButton:!0,reverseButtons:!0,inputValidator:k=>{if(!k)return"El campo es requerido"}});v!==void 0?(t.residentEstimate.observaciones_residente=v,await q(t.residentEstimate),m.fire("¡Éxito!","Estimación enviada al área revisora con éxito!","success"),i.push({name:"ResidentEstimate"})):m.fire("No agregaste ninguna observacion","Agrega uno para continuar","warning")}catch(v){m.fire("Error",`${v.response.data.detail}`,"error")}})},goToArchivos:()=>i.push({name:"FilesResidentEstimate",params:{residentEstimateId:t.residentEstimate.id_estimacion}}),formatFecha:e,v$:p}}},Y={class:"flex flex-row justify-between"},H={class:"font-bold text-lg"},J={class:"font-bold text-lg w-128"},K={class:"flex content-start justify-end items-center mb-10"},Q={class:"items-center justify-center"},W=d("h1",{class:"font-bold text-lg text-center"}," Número de la Estimación ",-1),X={class:"text-center font-semibold text-lg numEstimacion"},Z={class:"max-w-xl mx-auto"},$={class:"flex flex-row"},ee={class:"flex justify-between items-center py-4"};function ae(l,i,t,e,g,b){const p=j("button-base"),s=j("input-base");return n(),r(h,null,[d("div",Y,[d("div",H,E(e.app.residentEstimate.numero_contrato),1),d("div",J," Objeto: "+E(e.app.residentEstimate.objeto_contrato),1),d("div",K,[d("div",Q,[W,d("p",X,E(e.app.residentEstimate.num_consecutivo_estimacion),1)])])]),c(p,{label:"Archivos",onClick:e.goToArchivos,class:"mb-3 mr-0 ml-auto"},null,8,["onClick"]),d("div",Z,[c(s,{id:"fecha_recepcion_info_contratista",label:"Fecha de recepción de información del Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_recepcion_info_contratista,"onUpdate:modelValue":i[0]||(i[0]=a=>e.app.fecha_recepcion_info_contratista=a)},null,8,["modelValue"]),c(s,{id:"fecha_autorizacion_contratista",label:"Fecha de autorización al Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_autorizacion_contratista,"onUpdate:modelValue":i[1]||(i[1]=a=>e.app.fecha_autorizacion_contratista=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"]),e.v$.fecha_autorizacion_contratista.$error?(n(!0),r(h,{key:0},x(e.v$.fecha_autorizacion_contratista.$errors,a=>(n(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):f("",!0),d("div",$,[d("div",null,[c(s,{id:"fecha_periodo_inicio_estimacion",label:"Período de la Estimación",type:"date",modelValue:e.app.fecha_periodo_inicio_estimacion,"onUpdate:modelValue":i[2]||(i[2]=a=>e.app.fecha_periodo_inicio_estimacion=a)},null,8,["modelValue"])]),d("div",null,[c(s,{id:"fecha_periodo_fin_estimacion",label:"al",type:"date",class:"pt-2",modelValue:e.app.fecha_periodo_fin_estimacion,"onUpdate:modelValue":i[3]||(i[3]=a=>e.app.fecha_periodo_fin_estimacion=a)},null,8,["modelValue"])])]),c(s,{id:"importe_obra_ejecutada",label:"Importe de la obra ejecutada",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_obra_ejecutada,"onUpdate:modelValue":i[4]||(i[4]=a=>e.app.residentEstimate.importe_obra_ejecutada=a)},null,8,["modelValue"]),c(s,{id:"importe_pagar",label:"Importe a pagar",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_pagar,"onUpdate:modelValue":i[5]||(i[5]=a=>e.app.residentEstimate.importe_pagar=a)},null,8,["modelValue"]),c(s,{id:"grado_avance_obra",label:"% de grado de avance",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.grado_avance_obra,"onUpdate:modelValue":i[6]||(i[6]=a=>e.app.residentEstimate.grado_avance_obra=a)},null,8,["modelValue"]),e.v$.grado_avance_obra.$error?(n(!0),r(h,{key:1},x(e.v$.grado_avance_obra.$errors,a=>(n(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):f("",!0),c(s,{id:"porcentaje_avance_estimacion",label:"% de avance de la Estimación",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion,"onUpdate:modelValue":i[7]||(i[7]=a=>e.app.residentEstimate.porcentaje_avance_estimacion=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion.$error?(n(!0),r(h,{key:2},x(e.v$.porcentaje_avance_estimacion.$errors,a=>(n(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):f("",!0),c(s,{id:"porcentaje_avance_estimacion_acumulado",label:"% de avance de la Estimación acumulado",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion_acumulado,"onUpdate:modelValue":i[8]||(i[8]=a=>e.app.residentEstimate.porcentaje_avance_estimacion_acumulado=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion_acumulado.$error?(n(!0),r(h,{key:3},x(e.v$.porcentaje_avance_estimacion_acumulado.$errors,a=>(n(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):f("",!0),c(s,{id:"porcentaje_Avance_fisico",label:"% de avance físico",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_Avance_fisico,"onUpdate:modelValue":i[9]||(i[9]=a=>e.app.residentEstimate.porcentaje_Avance_fisico=a)},null,8,["modelValue"]),e.v$.porcentaje_Avance_fisico.$error?(n(!0),r(h,{key:4},x(e.v$.porcentaje_Avance_fisico.$errors,a=>(n(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):f("",!0),c(s,{id:"porcensaje_avance_financiero",label:"% de avance financiero",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcensaje_avance_financiero,"onUpdate:modelValue":i[10]||(i[10]=a=>e.app.residentEstimate.porcensaje_avance_financiero=a)},null,8,["modelValue"]),e.v$.porcensaje_avance_financiero.$error?(n(!0),r(h,{key:5},x(e.v$.porcensaje_avance_financiero.$errors,a=>(n(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):f("",!0),d("div",ee,[e.app.residentEstimate.estatus_semaforo==="Residente"?(n(),B(p,{key:0,label:"Actualizar datos",class:"px-4",onClick:e.editForm},null,8,["onClick"])):f("",!0),e.app.residentEstimate.estatus_semaforo==="Residente"?(n(),B(p,{key:1,label:"Eliminar Estimación",class:"px-4",onClick:e.deleteForm},null,8,["onClick"])):f("",!0),e.app.residentEstimate.estatus_semaforo==="Residente"?(n(),B(p,{key:2,label:"Enviar al área revisora",class:"px-4",onClick:e.sendReviewArea},null,8,["onClick"])):f("",!0)])])],64)}const te=C(P,[["render",ae]]),ie={name:"EditResident",components:{FormResidentEstimate:te,ArrowBack:U,TitleBar:I},setup(){const l=O(),i=z(),t=R({residentEstimate:{},loading:!0}),e=async()=>{t.loading=!0;const{data:b}=await D(l.params.residentEstimateId);t.residentEstimate=b,t.loading=!1},g=async b=>{await updateResident(b),m.fire("¡Éxito!","!Estimación residente actualizado con éxito!","success"),i.push({name:"Resident"})};return e(),{app:t,saveResident:g}}},oe={class:"px-4 mt-10"},ne={class:"px-4"};function se(l,i,t,e,g,b){const p=j("arrow-back"),s=j("title-bar"),a=j("form-resident-estimate");return n(),r("main",oe,[c(p),c(s,{title:"Semaforos Estimación Residente",subtitle:"Editar"}),d("section",ne,[e.app.loading?f("",!0):(n(),B(a,{key:0,residentEstimate:e.app.residentEstimate,editMode:""},null,8,["residentEstimate"]))])])}const be=C(ie,[["render",se]]);export{be as default};
