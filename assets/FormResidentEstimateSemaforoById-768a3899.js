import{I as k}from"./InputBase-25c38a14.js";import{B as z}from"./ButtonBase-88f709d5.js";import{S as A}from"./SelectBase-c0220a1b.js";import{T as R}from"./TextAreaBase-a814a4b5.js";import{u as F,d as M,e as T}from"./residentEstimate-c7aaae6e.js";import{_ as U,u as S,k as I,q as N,a as C,o as n,c as r,b as m,t as p,g as c,F as b,d as h,f as v,e as j}from"./index-8ea1b2a0.js";import{S as l}from"./sweetalert2.all-281a79b7.js";import{u as q,c as _,m as g,a as y}from"./index-fc323ec7.js";const D={name:"FormResidentEstimate",props:{editMode:{type:Boolean,default:!1},residentEstimate:{type:Object,default:()=>({})}},components:{InputBase:k,ButtonBase:z,SelectBase:A,TextAreaBase:R},setup(u){const i=S(),t=I({residentEstimate:{id_contrato:"",fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",importe_obra_ejecutada:"",importe_pagar:"",grado_avance_obra:"",porcentaje_avance_estimacion:"",porcentaje_avance_estimacion_acumulado:"",porcentaje_Avance_fisico:"",porcensaje_avance_financiero:"",observaciones_residente:""},fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",contratoName:"",estatus_semaforo:"",fileInfo:{type:Object,default:()=>({})},listReviewAreas:[],listEmpleados:[],listContrato:[]}),e=d=>{let o=[];return o=d.split(" "),o=o[0].split("-"),o=o[0]+"-"+o[1]+"-"+o[2],d=o,d},w=()=>{let d=new Date;var o=("0"+d.getDate()).slice(-2),x=("0"+(d.getMonth()+1)).slice(-2),f=d.getFullYear(),V=f+"-"+x+"-"+o;return!(t.fecha_autorizacion_contratista>V)},B=N(()=>({porcentaje_avance_estimacion:{maxValue:_.withMessage("El valor maximo es 100%",g(100)),minValue:_.withMessage("El valor minimo es 0%",y(0))},porcentaje_avance_estimacion_acumulado:{maxValue:_.withMessage("El valor maximo es 100%",g(100)),minValue:_.withMessage("El valor minimo es 0%",y(0))},porcentaje_Avance_fisico:{maxValue:_.withMessage("El valor maximo es 100%",g(100)),minValue:_.withMessage("El valor minimo es 0%",y(0))},porcensaje_avance_financiero:{maxValue:_.withMessage("El valor maximo es 100%",g(100)),minValue:_.withMessage("El valor minimo es 0%",y(0))},grado_avance_obra:{maxValue:_.withMessage("El valor maximo es 100%",g(100)),minValue:_.withMessage("El valor minimo es 0%",y(0))},fecha_autorizacion_contratista:{fechaActualFunction:_.withMessage("La fecha es mayor al dia de hoy",w)}})),E=q(B,u.residentEstimate);return u.editMode&&(t.residentEstimate=u.residentEstimate,t.estatus_semaforo=u,t.fecha_recepcion_info_contratista=e(u.residentEstimate.fecha_recepcion_info_contratista),u.residentEstimate.fecha_autorizacion_contratista===null?t.fecha_autorizacion_contratista=null:t.fecha_autorizacion_contratista=e(u.residentEstimate.fecha_autorizacion_contratista),t.fecha_periodo_inicio_estimacion=e(u.residentEstimate.fecha_periodo_inicio_estimacion),t.fecha_periodo_fin_estimacion=e(u.residentEstimate.fecha_periodo_fin_estimacion)),{app:t,editForm:()=>{var o=new Date().toLocaleTimeString("en-GB");t.residentEstimate.fecha_recepcion_info_contratista=t.fecha_recepcion_info_contratista+" "+o,t.fecha_autorizacion_contratista===null||t.fecha_autorizacion_contratista===""?t.residentEstimate.fecha_autorizacion_contratista=null:t.residentEstimate.fecha_autorizacion_contratista=t.fecha_autorizacion_contratista+" "+o,t.residentEstimate.fecha_periodo_inicio_estimacion=t.fecha_periodo_inicio_estimacion+" "+o,t.residentEstimate.fecha_periodo_fin_estimacion=t.fecha_periodo_fin_estimacion+" "+o,l.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async x=>{if(x.isConfirmed)try{await E.value.$validate()?(await F(t.residentEstimate),l.fire("¡Éxito!","Actualización con éxito!","success"),i.push({name:"ResidentEstimate"})):l.fire("Error","Revisa bien los datos","error")}catch(f){l.fire("Error",`${f.response.data.detail}`,"error")}})},deleteForm:()=>{l.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async d=>{if(d.isConfirmed)try{await M(t.residentEstimate,t.residentEstimate.id_estimacion),l.fire("¡Éxito!","Actualización con éxito!","success"),i.push({name:"ResidentEstimate"})}catch(o){l.fire("Error",`${o.response.data.detail}`,"error")}})},sendReviewArea:()=>{var o=new Date().toLocaleTimeString("en-GB");t.fecha_autorizacion_contratista===null?t.residentEstimate.fecha_autorizacion_contratista=null:t.residentEstimate.fecha_autorizacion_contratista=t.fecha_autorizacion_contratista+" "+o,l.fire({title:"Se realizará el envio de la Estimación al área revisora",icon:"question",showCancelButton:!0,text:"¿Está usted seguro?",cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async x=>{if(x.isConfirmed)try{const{value:f}=await l.fire({input:"textarea",inputLabel:"Observaciones",inputPlaceholder:"Escribe tus observaciones...",inputAttributes:{"aria-label":"Type your message here"},showCancelButton:!0,reverseButtons:!0,inputValidator:V=>{if(!V)return"El campo es requerido"}});f!==void 0?(t.residentEstimate.observaciones_residente=f,await T(t.residentEstimate),l.fire("¡Éxito!","Estimación enviada al área revisora con éxito!","success"),i.push({name:"ResidentEstimate"})):l.fire("No agregaste ninguna observacion","Agrega uno para continuar","warning")}catch(f){l.fire("Error",`${f.response.data.detail}`,"error")}})},goToArchivos:()=>i.push({name:"FilesResidentEstimate",params:{residentEstimateId:t.residentEstimate.id_estimacion}}),formatFecha:e,v$:E}}},L={class:"flex flex-row justify-between"},O={class:"font-bold text-lg"},G={class:"font-bold text-lg w-128"},P={class:"flex content-start justify-end items-center mb-10"},Y={class:"items-center justify-center"},H=m("h1",{class:"font-bold text-lg text-center"}," Número de la Estimación ",-1),J={class:"text-center font-semibold text-lg numEstimacion"},K={class:"max-w-xl mx-auto"},Q={class:"flex flex-row"},W={class:"flex justify-between items-center py-4"};function X(u,i,t,e,w,B){const E=C("button-base"),s=C("input-base");return n(),r(b,null,[m("div",L,[m("div",O,p(e.app.residentEstimate.numero_contrato),1),m("div",G," Objeto: "+p(e.app.residentEstimate.objeto_contrato),1),m("div",P,[m("div",Y,[H,m("p",J,p(e.app.residentEstimate.num_consecutivo_estimacion),1)])])]),c(E,{label:"Archivos",onClick:e.goToArchivos,class:"mb-3 mr-0 ml-auto"},null,8,["onClick"]),m("div",K,[c(s,{id:"fecha_recepcion_info_contratista",label:"Fecha de recepción de información del Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_recepcion_info_contratista,"onUpdate:modelValue":i[0]||(i[0]=a=>e.app.fecha_recepcion_info_contratista=a)},null,8,["modelValue"]),c(s,{id:"fecha_autorizacion_contratista",label:"Fecha de autorización al Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_autorizacion_contratista,"onUpdate:modelValue":i[1]||(i[1]=a=>e.app.fecha_autorizacion_contratista=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"]),e.v$.fecha_autorizacion_contratista.$error?(n(!0),r(b,{key:0},h(e.v$.fecha_autorizacion_contratista.$errors,a=>(n(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},p(a.$message),1))),128)):v("",!0),m("div",Q,[m("div",null,[c(s,{id:"fecha_periodo_inicio_estimacion",label:"Período de la Estimación",type:"date",modelValue:e.app.fecha_periodo_inicio_estimacion,"onUpdate:modelValue":i[2]||(i[2]=a=>e.app.fecha_periodo_inicio_estimacion=a)},null,8,["modelValue"])]),m("div",null,[c(s,{id:"fecha_periodo_fin_estimacion",label:"al",type:"date",class:"pt-2",modelValue:e.app.fecha_periodo_fin_estimacion,"onUpdate:modelValue":i[3]||(i[3]=a=>e.app.fecha_periodo_fin_estimacion=a)},null,8,["modelValue"])])]),c(s,{id:"importe_obra_ejecutada",label:"Importe de la obra ejecutada",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_obra_ejecutada,"onUpdate:modelValue":i[4]||(i[4]=a=>e.app.residentEstimate.importe_obra_ejecutada=a)},null,8,["modelValue"]),c(s,{id:"importe_pagar",label:"Importe a pagar",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_pagar,"onUpdate:modelValue":i[5]||(i[5]=a=>e.app.residentEstimate.importe_pagar=a)},null,8,["modelValue"]),c(s,{id:"grado_avance_obra",label:"% de grado de avance",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.grado_avance_obra,"onUpdate:modelValue":i[6]||(i[6]=a=>e.app.residentEstimate.grado_avance_obra=a)},null,8,["modelValue"]),e.v$.grado_avance_obra.$error?(n(!0),r(b,{key:1},h(e.v$.grado_avance_obra.$errors,a=>(n(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},p(a.$message),1))),128)):v("",!0),c(s,{id:"porcentaje_avance_estimacion",label:"% de avance de la Estimación",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion,"onUpdate:modelValue":i[7]||(i[7]=a=>e.app.residentEstimate.porcentaje_avance_estimacion=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion.$error?(n(!0),r(b,{key:2},h(e.v$.porcentaje_avance_estimacion.$errors,a=>(n(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},p(a.$message),1))),128)):v("",!0),c(s,{id:"porcentaje_avance_estimacion_acumulado",label:"% de avance de la Estimación acumulado",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion_acumulado,"onUpdate:modelValue":i[8]||(i[8]=a=>e.app.residentEstimate.porcentaje_avance_estimacion_acumulado=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion_acumulado.$error?(n(!0),r(b,{key:3},h(e.v$.porcentaje_avance_estimacion_acumulado.$errors,a=>(n(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},p(a.$message),1))),128)):v("",!0),c(s,{id:"porcentaje_Avance_fisico",label:"% de avance físico",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_Avance_fisico,"onUpdate:modelValue":i[9]||(i[9]=a=>e.app.residentEstimate.porcentaje_Avance_fisico=a)},null,8,["modelValue"]),e.v$.porcentaje_Avance_fisico.$error?(n(!0),r(b,{key:4},h(e.v$.porcentaje_Avance_fisico.$errors,a=>(n(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},p(a.$message),1))),128)):v("",!0),c(s,{id:"porcensaje_avance_financiero",label:"% de avance financiero",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcensaje_avance_financiero,"onUpdate:modelValue":i[10]||(i[10]=a=>e.app.residentEstimate.porcensaje_avance_financiero=a)},null,8,["modelValue"]),e.v$.porcensaje_avance_financiero.$error?(n(!0),r(b,{key:5},h(e.v$.porcensaje_avance_financiero.$errors,a=>(n(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},p(a.$message),1))),128)):v("",!0),m("div",W,[e.app.residentEstimate.estatus_semaforo==="Residente"?(n(),j(E,{key:0,label:"Actualizar datos",class:"px-4",onClick:e.editForm},null,8,["onClick"])):v("",!0),e.app.residentEstimate.estatus_semaforo==="Residente"?(n(),j(E,{key:1,label:"Eliminar Estimación",class:"px-4",onClick:e.deleteForm},null,8,["onClick"])):v("",!0),e.app.residentEstimate.estatus_semaforo==="Residente"?(n(),j(E,{key:2,label:"Enviar al área revisora",class:"px-4",onClick:e.sendReviewArea},null,8,["onClick"])):v("",!0)])])],64)}const ce=U(D,[["render",X]]);export{ce as F};
