import{F as Y}from"./FormResident-6a30d2c2.js";import{A as H}from"./ArrowBack-050cb3bf.js";import{T as J}from"./TitleBar-a5b79e88.js";import{I as K}from"./InputBase-9395cc19.js";import{T as M}from"./TableBase-26b11aa1.js";import{B as Q}from"./fetchApi-91742277.js";import{L as W}from"./LogoutComponent-620b462c.js";import{f as X,g as Z,h as $,i as ee}from"./residentEstimate-cc519fd3.js";import{_ as P,o as f,c as m,d as i,t as x,q as ae,u as te,a as ie,m as oe,r as o,b as u,e as r,g as ne,h as _}from"./index-7b851244.js";import{S as l}from"./sweetalert2.all-281a79b7.js";import"./SelectBase-d59feeca.js";import"./reviewArea-a7b3ab47.js";import"./users-e3817326.js";const se={name:"Banner",props:{title:{type:String,default:""}}},re={class:"relative isolate flex-1 items-center gap-x-6 overflow-hidden bg-gray-50 px-4 py-1.5 sm:px-2.5 sm:before:flex"},le=i("div",{class:"absolute left-[max(-7rem,calc(50%-52rem))] top-1/2 -z-10 -translate-y-1/2 transform-gpu blur-2xl","aria-hidden":"true"},[i("div",{class:"aspect-[577/310] w-[36.0625rem] bg-gradient-to-r from-[#808080] to-[#808080] opacity-30",style:{"clip-path":"polygon(74.8% 41.9%, 97.2% 73.2%, 100% 34.9%, 92.5% 0.4%, 87.5% 0%, 75% 28.6%, 58.5% 54.6%, 50.1% 56.8%, 46.9% 44%, 48.3% 17.4%, 24.7% 53.9%, 0% 27.9%, 11.9% 74.2%, 24.9% 54.1%, 68.6% 100%, 74.8% 41.9%)"}})],-1),ce=i("div",{class:"absolute left-[max(45rem,calc(50%+8rem))] top-1/2 -z-10 -translate-y-1/2 transform-gpu blur-2xl","aria-hidden":"true"},[i("div",{class:"aspect-[577/310] w-[36.0625rem] bg-gradient-to-r from-[#808080] to-[#808080] opacity-30",style:{"clip-path":"polygon(74.8% 41.9%, 97.2% 73.2%, 100% 34.9%, 92.5% 0.4%, 87.5% 0%, 75% 28.6%, 58.5% 54.6%, 50.1% 56.8%, 46.9% 44%, 48.3% 17.4%, 24.7% 53.9%, 0% 27.9%, 11.9% 74.2%, 24.9% 54.1%, 68.6% 100%, 74.8% 41.9%)"}})],-1),de={class:"text-3xl text-center"};function fe(E,p,h,e,t,F){return f(),m("div",re,[le,ce,i("div",null,[i("h2",de,x(h.title),1)])])}const ue=P(se,[["render",fe]]),me={name:"FilesResidentEstimate",components:{FormResident:Y,ArrowBack:H,TitleBar:J,InputBase:K,TableBase:M,ButtonBase:Q,Banner:ue,LogoutComponent:W},setup(){const E=ae(),p=te(),h=ie(),e=[{label:"Id",field:"id_archivo_estimacion"},{label:"Nombre archivo",field:"ruta_archivo_residente"},{label:"Descripción",field:"descripcion_archivo"}],t=oe({file:{id_estimacion:"",file:"",descripcionFile:""},data:{},filesById:[],loading:!0,filesResidente:[],filesAreaRevisora:[],filesFinanzas:[],filesTramite_Pago:[]}),F=o([]),g=o([]),b=o([]),R=o([]),y=o([]),{rol:n}=h.getAuthData,c=o([]),w=o(!1),O=o(!1),B=o(!1),z=o(!1),I=o([{label:"Descargar",action:async a=>{window.open(`${a.archivo_estimacion}`,"_blank")}}]),A=o([]),D=o([]),k=o([]),T=async()=>{t.loading=!0;const{data:a}=await X(E.params.residentEstimateId);t.data=a,t.file.id_estimacion=a.id_estimacion,v.append("id_estimacion",t.file.id_estimacion),c.value=q(t.data.estatus_semaforo),V(),U(t.data.estatus_estimacion),C(),t.loading=!1},C=async()=>{const{data:a}=await Z(t.file.id_estimacion);a.residente&&(g.value=a.residente),a.area_revisora&&(b.value=a.area_revisora),a.finanzas&&(R.value=a.finanzas),a.tramite_pago&&(y.value=a.tramite_pago)},S=async a=>{await updateResident(a),l.fire("¡Éxito!","Residente actualizado con éxito!","success"),p.push({name:"Resident"})};let v=new FormData;const j=async()=>{try{const{value:a}=await l.fire({title:"Subir Archivo",input:"file",showCancelButton:!0,reverseButtons:!0,inputAttributes:{accept:"application/pdf","aria-label":"Upload your profile picture"}});if(a!=null){const{value:s}=await l.fire({title:"Descripción del archivo",input:"text",showCancelButton:!0,reverseButtons:!0,inputValidator:d=>{if(!d)return"El campo es requerido"}});if(s!==void 0){t.file.descripcionFile=s,t.file.file=a,v.append("archivo_estimacion ",t.file.file),v.append("descripcion_archivo ",t.file.descripcionFile);try{await $(v),C(),l.fire("¡Éxito!","!Archivo guardado con éxito!","success"),t.file.file="",t.file.descripcionFile=""}catch(d){l.fire("Error",`${d.response.data.detail}`,"error")}}}else a===null&&l.fire("No selesccionaste ningun archivo","Agrega uno para continuar","warning")}catch{}},q=a=>{var s=!1;return a==="Residente"&&n==="Residente"&&(s=!0),a==="Area Revisora"&&(n.includes("Área revisora")||n.includes("Obras y Contratos"))&&(s=!0),(a==="Finanzas"||a==="DGPOP")&&n.includes("Finanzas")&&(s=!0),s},V=()=>{w.value=!0,O.value=!0,B.value=!0,z.value=!0},U=a=>{const s=async N=>{window.open(`${N.archivo_estimacion}`,"_blank")},d=async N=>{l.fire({title:"¿Estás seguro que desea eliminar el documento?",text:"Esto quitará el documento",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Si, Eliminar!",reverseButtons:!0}).then(async L=>{if(L.isConfirmed)try{await ee(N.id_archivo_estimacion),await C(),l.fire("Eliminado!","El documento se eliminó","success")}catch(G){l.fire("Error",`${G.response.data.detail}`,"error")}})};a==="Pagada"?(w.value=!0,O.value=!0,B.value=!0,z.value=!0,I.value=[{label:"Descargar",action:s}]):(n.includes("Residente")&&(a==="Capturada por Residente"||a==="Autorizada por Residente"||a==="Regresada al Residente")?A.value=[{label:"Descargar",action:s},{label:"Eliminar",action:d}]:A.value=[],(n.includes("Obras y Contratos")||n.includes("Área revisora"))&&(a==="En validación del área revisora"||a==="Regresada al área revisora")?D.value=[{label:"Descargar",action:s},{label:"Eliminar",action:d}]:D.value=[],n.includes("Finanzas")&&(a==="En validación de Finanzas"||a==="Regresada a Finanzas"||a==="En trámite de pago")?k.value=[{label:"Descargar",action:s},{label:"Eliminar",action:d}]:k.value=[])};return T(),{app:t,filesById:F,saveResident:S,featureOptions:I,featureOptionsResidente:A,featureOptionsAreaRevisora:D,featureOptionsFianzas:k,formData:v,headers:e,fileUpload:j,filesResidente:g,filesAreaRevisora:b,filesTramite_Pago:y,filesFinanzas:R,canAddNew:c,canEditResidente:w,canEditAreaRevisora:O,canEditFinanzas:B,canEditPago:z}}},pe={class:"px-4 mt-10"},ve={class:"flex justify-between"},_e={class:"px-4"},he={class:"flex flex-row justify-between"},ge={class:"font-bold text-lg"},be={class:"font-bold text-lg w-128 text-center"},Re={class:"flex content-start justify-end items-center mb-10"},ye={class:"items-center justify-center"},we=i("h1",{class:"font-bold text-lg text-center"}," Número de la Estimación ",-1),xe={class:"text-center font-semibold text-lg numEstimacion"},Ee={key:1,class:"flex flex-col py-px"},Fe={key:2},Oe={key:3},Be={key:4};function ze(E,p,h,e,t,F){const g=u("arrow-back"),b=u("logout-component"),R=u("title-bar"),y=u("button-base"),n=u("banner"),c=u("table-base");return f(),m("main",pe,[i("div",ve,[r(g),r(b)]),r(R,{title:"Estimación Residente",subtitle:"Archivos"}),i("section",_e,[i("div",he,[i("div",ge,x(e.app.data.numero_contrato),1),i("div",be," Objeto: "+x(e.app.data.objeto_contrato),1),i("div",Re,[i("div",ye,[we,i("p",xe,x(e.app.data.num_consecutivo_estimacion),1)])])]),e.canAddNew?(f(),ne(y,{key:0,label:"Nuevo",onClick:p[0]||(p[0]=w=>e.fileUpload()),class:"mr-0 ml-auto mb-5"})):_("",!0),e.filesResidente.length?(f(),m("div",Ee,[r(n,{title:"Documentos de Residente"}),r(c,{description:"Residente",options:e.featureOptionsResidente.length!==0?e.featureOptionsResidente:e.featureOptions,headers:e.headers,data:e.filesResidente,showOptions:e.canEditResidente,tableName:"residente"},null,8,["options","headers","data","showOptions"])])):_("",!0),e.filesAreaRevisora.length?(f(),m("div",Fe,[r(n,{title:"Documentos de Área Revisora"}),r(c,{description:"Área Revisora",options:e.featureOptionsAreaRevisora.length!==0?e.featureOptionsAreaRevisora:e.featureOptions,headers:e.headers,data:e.filesAreaRevisora,showOptions:e.canEditAreaRevisora,tableName:"area-revisora"},null,8,["options","headers","data","showOptions"])])):_("",!0),e.filesFinanzas.length?(f(),m("div",Oe,[r(n,{title:"Documentos de Finanzas"}),r(c,{description:"Finanzas",options:e.featureOptionsFianzas.length!==0?e.featureOptionsFianzas:e.featureOptions,headers:e.headers,data:e.filesFinanzas,showOptions:e.canEditFinanzas,tableName:"finanzas"},null,8,["options","headers","data","showOptions"])])):_("",!0),e.filesTramite_Pago.length?(f(),m("div",Be,[r(n,{title:"Documentos de Registro de Pago"}),r(c,{description:"Registro de Pago",options:e.featureOptionsFianzas.length!==0?e.featureOptionsFianzas:e.featureOptions,headers:e.headers,data:e.filesTramite_Pago,showOptions:e.canEditPago,tableName:"pago"},null,8,["options","headers","data","showOptions"])])):_("",!0)])])}const Le=P(me,[["render",ze]]);export{Le as default};
