import{I as F}from"./InputBase-bdcef8e0.js";import{B as M}from"./ButtonBase-3a358441.js";import{S as T}from"./SelectBase-05279e57.js";import{T as U}from"./TextAreaBase-a0ee2288.js";import{A as I,T as S}from"./TitleBar-c6610f6e.js";import{u as D,d as N,c as q,e as L}from"./residentEstimate-1a35892d.js";import{_ as C,u as R,k as z,q as O,a as x,o as n,c as l,b as d,t as E,g as r,F as h,d as g,f as v,e as k,l as G}from"./index-e9431c5a.js";import{S as u}from"./sweetalert2.all-281a79b7.js";import{u as P,c as _,m as j,a as w}from"./index-38a598b7.js";const Y={name:"FormResidentEstimate",props:{editMode:{type:Boolean,default:!1},residentEstimate:{type:Object,default:()=>({})}},components:{InputBase:F,ButtonBase:M,SelectBase:T,TextAreaBase:U},setup(s){const o=R(),t=z({residentEstimate:{id_contrato:"",fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",importe_obra_ejecutada:"",importe_pagar:"",grado_avance_obra:"",porcentaje_avance_estimacion:"",porcentaje_avance_estimacion_acumulado:"",porcentaje_Avance_fisico:"",porcensaje_avance_financiero:"",observaciones_residente:""},fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",contratoName:"",estatus_semaforo:"",fileInfo:{type:Object,default:()=>({})},listReviewAreas:[],listEmpleados:[],listContrato:[]}),e=m=>{let i=[];return i=m.split(" "),i=i[0].split("-"),i=i[0]+"-"+i[1]+"-"+i[2],m=i,m},y=()=>{let m=new Date;var i=("0"+m.getDate()).slice(-2),V=("0"+(m.getMonth()+1)).slice(-2),f=m.getFullYear(),A=f+"-"+V+"-"+i;return t.fecha_autorizacion_contratista>A?(console.log("Entro"),!1):!0},b=O(()=>({porcentaje_avance_estimacion:{maxValue:_.withMessage("El valor maximo es 100%",j(100)),minValue:_.withMessage("El valor minimo es 0%",w(0))},porcentaje_avance_estimacion_acumulado:{maxValue:_.withMessage("El valor maximo es 100%",j(100)),minValue:_.withMessage("El valor minimo es 0%",w(0))},porcentaje_Avance_fisico:{maxValue:_.withMessage("El valor maximo es 100%",j(100)),minValue:_.withMessage("El valor minimo es 0%",w(0))},porcensaje_avance_financiero:{maxValue:_.withMessage("El valor maximo es 100%",j(100)),minValue:_.withMessage("El valor minimo es 0%",w(0))},grado_avance_obra:{maxValue:_.withMessage("El valor maximo es 100%",j(100)),minValue:_.withMessage("El valor minimo es 0%",w(0))},fecha_autorizacion_contratista:{fechaActualFunction:_.withMessage("La fecha es mayor al dia de hoy",y)}})),p=P(b,s.residentEstimate);return s.editMode&&(console.log("props.residentEstimate: ",s.residentEstimate),console.log("props: ",s),t.residentEstimate=s.residentEstimate,t.estatus_semaforo=s,t.fecha_recepcion_info_contratista=e(s.residentEstimate.fecha_recepcion_info_contratista),s.residentEstimate.fecha_autorizacion_contratista===null?t.fecha_autorizacion_contratista=null:t.fecha_autorizacion_contratista=e(s.residentEstimate.fecha_autorizacion_contratista),t.fecha_periodo_inicio_estimacion=e(s.residentEstimate.fecha_periodo_inicio_estimacion),t.fecha_periodo_fin_estimacion=e(s.residentEstimate.fecha_periodo_fin_estimacion)),{app:t,editForm:()=>{var i=new Date().toLocaleTimeString("en-GB");console.log(i),t.residentEstimate.fecha_recepcion_info_contratista=t.fecha_recepcion_info_contratista+" "+i,t.fecha_autorizacion_contratista===null||t.fecha_autorizacion_contratista===""?t.residentEstimate.fecha_autorizacion_contratista=null:t.residentEstimate.fecha_autorizacion_contratista=t.fecha_autorizacion_contratista+" "+i,t.residentEstimate.fecha_periodo_inicio_estimacion=t.fecha_periodo_inicio_estimacion+" "+i,t.residentEstimate.fecha_periodo_fin_estimacion=t.fecha_periodo_fin_estimacion+" "+i,u.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async V=>{if(V.isConfirmed)try{const f=await p.value.$validate();console.log("validaciones:",f),console.log("v$:",p),f?(await D(t.residentEstimate),u.fire("¡Éxito!","Actualización con éxito!","success"),o.push({name:"ResidentEstimate"})):u.fire("Error","Revisa bien los datos","error")}catch(f){console.log("error: ",f.response.data.detail),u.fire("Error",`${f.response.data.detail}`,"error")}})},deleteForm:()=>{u.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async m=>{if(m.isConfirmed)try{console.log("app.residentEstimate.observaciones_residente: ",t.residentEstimate.observaciones_residente),console.log("app.residentEstimate.id_estimacion: ",t.residentEstimate.id_estimacion),await N(t.residentEstimate,t.residentEstimate.id_estimacion),u.fire("¡Éxito!","Actualización con éxito!","success"),o.push({name:"ResidentEstimate"})}catch(i){console.log("error: ",i.response.data.detail),u.fire("Error",`${i.response.data.detail}`,"error")}})},sendReviewArea:()=>{var i=new Date().toLocaleTimeString("en-GB");t.fecha_autorizacion_contratista===null?delete t.residentEstimate.fecha_autorizacion_contratista:t.residentEstimate.fecha_autorizacion_contratista=t.fecha_autorizacion_contratista+" "+i,u.fire({title:"Se realizará el envio de la Estimación al área revisora",icon:"question",showCancelButton:!0,text:"¿Está usted seguro?",cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async V=>{if(V.isConfirmed)try{await q(t.residentEstimate),u.fire("¡Éxito!","Estimación enviada al área revisora con éxito!","success"),o.push({name:"ResidentEstimate"})}catch(f){console.log("error: ",f.response.data.detail),u.fire("Error",`${f.response.data.detail}`,"error")}})},goToArchivos:()=>o.push({name:"FilesResidentEstimate",params:{residentEstimateId:t.residentEstimate.id_estimacion}}),formatFecha:e,v$:p}}},H={class:"flex flex-row justify-between"},J={class:"font-bold text-lg"},K={class:"font-bold text-lg w-128"},Q={class:"flex content-start justify-end items-center mb-10"},W={class:"items-center justify-center"},X=d("h1",{class:"font-bold text-lg text-center"}," Número de la Estimación ",-1),Z={class:"text-center font-semibold text-lg numEstimacion"},$={class:"max-w-xl mx-auto"},ee={class:"flex flex-row"},ae={class:"flex justify-between items-center py-4"};function te(s,o,t,e,y,b){const p=x("button-base"),c=x("input-base"),B=x("text-area-base");return n(),l(h,null,[d("div",H,[d("div",J,E(e.app.residentEstimate.numero_contrato),1),d("div",K," Objeto: "+E(e.app.residentEstimate.objeto_contrato),1),d("div",Q,[d("div",W,[X,d("p",Z,E(e.app.residentEstimate.num_consecutivo_estimacion),1)])])]),r(p,{label:"Archivos",onClick:e.goToArchivos,class:"mb-3 mr-0 ml-auto"},null,8,["onClick"]),d("div",$,[r(c,{id:"fecha_recepcion_info_contratista",label:"Fecha de recepción de información del Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_recepcion_info_contratista,"onUpdate:modelValue":o[0]||(o[0]=a=>e.app.fecha_recepcion_info_contratista=a)},null,8,["modelValue"]),r(c,{id:"fecha_autorizacion_contratista",label:"Fecha de autorización al Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_autorizacion_contratista,"onUpdate:modelValue":o[1]||(o[1]=a=>e.app.fecha_autorizacion_contratista=a),disabled:e.app.residentEstimate.estatus_semaforo!=="Residente"},null,8,["modelValue","disabled"]),e.v$.fecha_autorizacion_contratista.$error?(n(!0),l(h,{key:0},g(e.v$.fecha_autorizacion_contratista.$errors,a=>(n(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):v("",!0),d("div",ee,[d("div",null,[r(c,{id:"fecha_periodo_inicio_estimacion",label:"Período de la Estimación",type:"date",modelValue:e.app.fecha_periodo_inicio_estimacion,"onUpdate:modelValue":o[2]||(o[2]=a=>e.app.fecha_periodo_inicio_estimacion=a)},null,8,["modelValue"])]),d("div",null,[r(c,{id:"fecha_periodo_fin_estimacion",label:"al",type:"date",class:"pt-2",modelValue:e.app.fecha_periodo_fin_estimacion,"onUpdate:modelValue":o[3]||(o[3]=a=>e.app.fecha_periodo_fin_estimacion=a)},null,8,["modelValue"])])]),r(c,{id:"importe_obra_ejecutada",label:"Importe de la obra ejecutada",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_obra_ejecutada,"onUpdate:modelValue":o[4]||(o[4]=a=>e.app.residentEstimate.importe_obra_ejecutada=a)},null,8,["modelValue"]),r(c,{id:"importe_pagar",label:"Importe a pagar",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_pagar,"onUpdate:modelValue":o[5]||(o[5]=a=>e.app.residentEstimate.importe_pagar=a)},null,8,["modelValue"]),r(c,{id:"grado_avance_obra",label:"% de grado de avance",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.grado_avance_obra,"onUpdate:modelValue":o[6]||(o[6]=a=>e.app.residentEstimate.grado_avance_obra=a)},null,8,["modelValue"]),e.v$.grado_avance_obra.$error?(n(!0),l(h,{key:1},g(e.v$.grado_avance_obra.$errors,a=>(n(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):v("",!0),r(c,{id:"porcentaje_avance_estimacion",label:"% de avance de la Estimación",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion,"onUpdate:modelValue":o[7]||(o[7]=a=>e.app.residentEstimate.porcentaje_avance_estimacion=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion.$error?(n(!0),l(h,{key:2},g(e.v$.porcentaje_avance_estimacion.$errors,a=>(n(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):v("",!0),r(c,{id:"porcentaje_avance_estimacion_acumulado",label:"% de avance de la Estimación acumulado",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion_acumulado,"onUpdate:modelValue":o[8]||(o[8]=a=>e.app.residentEstimate.porcentaje_avance_estimacion_acumulado=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion_acumulado.$error?(n(!0),l(h,{key:3},g(e.v$.porcentaje_avance_estimacion_acumulado.$errors,a=>(n(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):v("",!0),r(c,{id:"porcentaje_Avance_fisico",label:"% de avance físico",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_Avance_fisico,"onUpdate:modelValue":o[9]||(o[9]=a=>e.app.residentEstimate.porcentaje_Avance_fisico=a)},null,8,["modelValue"]),e.v$.porcentaje_Avance_fisico.$error?(n(!0),l(h,{key:4},g(e.v$.porcentaje_Avance_fisico.$errors,a=>(n(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):v("",!0),r(c,{id:"porcensaje_avance_financiero",label:"% de avance financiero",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcensaje_avance_financiero,"onUpdate:modelValue":o[10]||(o[10]=a=>e.app.residentEstimate.porcensaje_avance_financiero=a)},null,8,["modelValue"]),e.v$.porcensaje_avance_financiero.$error?(n(!0),l(h,{key:5},g(e.v$.porcensaje_avance_financiero.$errors,a=>(n(),l("span",{key:a,class:"text-red font-semibold text-center ml-80"},E(a.$message),1))),128)):v("",!0),r(B,{id:"fecha_inicio_proyecto",label:"Observaciones del Residente",class:"mb-3",modelValue:e.app.residentEstimate.observaciones_residente,"onUpdate:modelValue":o[11]||(o[11]=a=>e.app.residentEstimate.observaciones_residente=a)},null,8,["modelValue"]),d("div",ae,[e.app.residentEstimate.estatus_semaforo==="Residente"?(n(),k(p,{key:0,label:"Actualizar datos",class:"px-4",onClick:e.editForm},null,8,["onClick"])):v("",!0),e.app.residentEstimate.estatus_semaforo==="Residente"?(n(),k(p,{key:1,label:"Eliminar Estimación",class:"px-4",onClick:e.deleteForm},null,8,["onClick"])):v("",!0),e.app.residentEstimate.estatus_semaforo==="Residente"?(n(),k(p,{key:2,label:"Enviar al área revisora",class:"px-4",onClick:e.sendReviewArea},null,8,["onClick"])):v("",!0)])])],64)}const oe=C(Y,[["render",te]]),ie={name:"EditResident",components:{FormResidentEstimate:oe,ArrowBack:I,TitleBar:S},setup(){const s=G(),o=R(),t=z({residentEstimate:{},loading:!0}),e=async()=>{t.loading=!0;const{data:b}=await L(s.params.residentEstimateId);console.log("data: ",b),t.residentEstimate=b,console.log("app.residentEstimate: ",t.residentEstimate),t.loading=!1},y=async b=>{await updateResident(b),u.fire("¡Éxito!","!Estimación residente actualizado con éxito!","success"),o.push({name:"Resident"})};return e(),{app:t,saveResident:y}}},ne={class:"px-4 mt-10"},se={class:"px-4"};function re(s,o,t,e,y,b){const p=x("arrow-back"),c=x("title-bar"),B=x("form-resident-estimate");return n(),l("main",ne,[r(p),r(c,{title:"Semaforos Estimación Residente",subtitle:"Editar"}),d("section",se,[e.app.loading?v("",!0):(n(),k(B,{key:0,residentEstimate:e.app.residentEstimate,editMode:""},null,8,["residentEstimate"]))])])}const be=C(ie,[["render",re]]);export{be as default};
