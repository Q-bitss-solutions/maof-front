import{I as M}from"./InputBase-88596ea4.js";import{B as U}from"./fetchApi-b849a3bc.js";import{S as A}from"./SelectBase-e20657df.js";import{T as N}from"./TextAreaBase-f6450077.js";import{s as S,c as D}from"./residentEstimate-710d6c6b.js";import{_ as C,a as R,u as z,m as F,s as T,b as f,o as s,c,d as r,t as d,e as i,F as u,f as h,h as p,q as $,g as L}from"./index-c1f09a3a.js";import{S as V}from"./sweetalert2.all-281a79b7.js";import{u as O,c as m,m as x,a as y}from"./index-28017459.js";import{A as q}from"./ArrowBack-7a435b28.js";import{T as G}from"./TitleBar-e5c8df83.js";import{a as H}from"./contract-e7012684.js";import{L as P}from"./LogoutComponent-b10e70fb.js";import{H as Y}from"./HomePage-aa58e36f.js";const J={name:"FormResidentEstimate",props:{editMode:{type:Boolean,default:!1},residentEstimate:{type:Object,default:()=>({})}},components:{InputBase:M,ButtonBase:U,SelectBase:A,TextAreaBase:N},setup(v){const o=R(),{rol:E}=o.getAuthData,e=z(),t=F({residentEstimate:{id_contrato:"",fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",importe_obra_ejecutada:"",importe_pagar:"",grado_avance_obra:"",porcentaje_avance_estimacion:"",porcentaje_avance_estimacion_acumulado:"",porcentaje_avance_fisico:"",porcensaje_avance_financiero:""},fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",contratoName:"",fileInfo:{type:Object,default:()=>({})},listReviewAreas:[],listEmpleados:[],listContrato:[]}),g=()=>{let b=new Date;var _=("0"+b.getDate()).slice(-2),w=("0"+(b.getMonth()+1)).slice(-2),j=b.getFullYear(),B=j+"-"+w+"-"+_;return!(t.fecha_autorizacion_contratista>B)},n=T(()=>({porcentaje_avance_estimacion:{maxValue:m.withMessage("El valor maximo es 100%",x(100)),minValue:m.withMessage("El valor minimo es 0%",y(0))},porcentaje_avance_estimacion_acumulado:{maxValue:m.withMessage("El valor maximo es 100%",x(100)),minValue:m.withMessage("El valor minimo es 0%",y(0))},porcentaje_avance_fisico:{maxValue:m.withMessage("El valor maximo es 100%",x(100)),minValue:m.withMessage("El valor minimo es 0%",y(0))},porcensaje_avance_financiero:{maxValue:m.withMessage("El valor maximo es 100%",x(100)),minValue:m.withMessage("El valor minimo es 0%",y(0))},grado_avance_obra:{maxValue:m.withMessage("El valor maximo es 100%",x(100)),minValue:m.withMessage("El valor minimo es 0%",y(0))},fecha_autorizacion_contratista:{fechaActualFunction:m.withMessage("La fecha es mayor al dia de hoy",g)}}));v.editMode&&(t.residentEstimate=v.residentEstimate);const l=O(n,t.residentEstimate);return{app:t,sendForm:()=>{var _=new Date().toLocaleTimeString("en-GB");t.residentEstimate.fecha_recepcion_info_contratista=t.fecha_recepcion_info_contratista+" "+_,t.fecha_autorizacion_contratista===""?delete t.residentEstimate.fecha_autorizacion_contratista:t.residentEstimate.fecha_autorizacion_contratista=t.fecha_autorizacion_contratista+" "+_,t.residentEstimate.fecha_periodo_inicio_estimacion=t.fecha_periodo_inicio_estimacion+" "+_,t.residentEstimate.fecha_periodo_fin_estimacion=t.fecha_periodo_fin_estimacion+" "+_,V.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async w=>{if(w.isConfirmed)try{await l.value.$validate()?(delete t.residentEstimate.num_consecutivo_estimacion,await S(t.residentEstimate),V.fire({title:"Registro dado de alta",text:"¿Desea ingresar los documentos?",icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí",cancelButtonText:"No",reverseButtons:!0}).then(async B=>{if(B.isConfirmed){const{data:k}=await D(),I=k.length-1;t.fileInfo=k[I],e.push({name:"FilesResidentEstimate",params:{residentEstimateId:t.fileInfo.id_estimacion}})}else e.push({name:"ResidentEstimate"})})):V.fire("Error","Revisa bien los datos","error")}catch(j){V.fire("Error",`${j.response.data.detail}`,"error")}})},v$:l,rol:E}}},K={class:"flex flex-row justify-between"},Q={class:"font-bold text-lg"},W={class:"font-bold text-lg w-128"},X={class:"flex content-start justify-end items-center mb-10"},Z={class:"items-center justify-center"},ee=r("h1",{class:"font-bold text-lg"}," Número de la Estimación ",-1),ae={class:"text-center font-semibold text-lg numEstimacion"},te={class:"max-w-xl mx-auto"},oe={class:"flex flex-row"};function ne(v,o,E,e,t,g){const n=f("input-base"),l=f("button-base");return s(),c(u,null,[r("div",K,[r("div",Q,d(e.app.residentEstimate.numero_contrato),1),r("div",W," Objeto: "+d(e.app.residentEstimate.objeto_contrato),1),r("div",X,[r("div",Z,[ee,r("p",ae,d(e.app.residentEstimate.num_consecutivo_estimacion),1)])])]),r("div",te,[i(n,{id:"fecha_recepcion_info_contratista",label:"Fecha de recepción de información del Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_recepcion_info_contratista,"onUpdate:modelValue":o[0]||(o[0]=a=>e.app.fecha_recepcion_info_contratista=a)},null,8,["modelValue"]),i(n,{id:"fecha_autorizacion_contratista",label:"Fecha de autorización al Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_autorizacion_contratista,"onUpdate:modelValue":o[1]||(o[1]=a=>e.app.fecha_autorizacion_contratista=a)},null,8,["modelValue"]),e.v$.fecha_autorizacion_contratista.$error?(s(!0),c(u,{key:0},h(e.v$.fecha_autorizacion_contratista.$errors,a=>(s(),c("span",{key:a,class:"text-red font-semibold text-center ml-80"},d(a.$message),1))),128)):p("",!0),r("div",oe,[r("div",null,[i(n,{id:"fecha_periodo_inicio_estimacion",label:"Período de la Estimación",type:"date",modelValue:e.app.fecha_periodo_inicio_estimacion,"onUpdate:modelValue":o[2]||(o[2]=a=>e.app.fecha_periodo_inicio_estimacion=a)},null,8,["modelValue"])]),r("div",null,[i(n,{id:"fecha_periodo_fin_estimacion",label:"al",type:"date",class:"pt-2",modelValue:e.app.fecha_periodo_fin_estimacion,"onUpdate:modelValue":o[3]||(o[3]=a=>e.app.fecha_periodo_fin_estimacion=a)},null,8,["modelValue"])])]),i(n,{id:"importe_obra_ejecutada",label:"Importe de la obra ejecutada",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_obra_ejecutada,"onUpdate:modelValue":o[4]||(o[4]=a=>e.app.residentEstimate.importe_obra_ejecutada=a)},null,8,["modelValue"]),i(n,{id:"importe_pagar",label:"Importe a pagar",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_pagar,"onUpdate:modelValue":o[5]||(o[5]=a=>e.app.residentEstimate.importe_pagar=a)},null,8,["modelValue"]),i(n,{id:"grado_avance_obra",label:"% de grado de avance",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.grado_avance_obra,"onUpdate:modelValue":o[6]||(o[6]=a=>e.app.residentEstimate.grado_avance_obra=a)},null,8,["modelValue"]),e.v$.grado_avance_obra.$error?(s(!0),c(u,{key:1},h(e.v$.grado_avance_obra.$errors,a=>(s(),c("span",{key:a,class:"text-red font-semibold text-center ml-80"},d(a.$message),1))),128)):p("",!0),i(n,{id:"porcentaje_avance_estimacion",label:"% de avance de la Estimación",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion,"onUpdate:modelValue":o[7]||(o[7]=a=>e.app.residentEstimate.porcentaje_avance_estimacion=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion.$error?(s(!0),c(u,{key:2},h(e.v$.porcentaje_avance_estimacion.$errors,a=>(s(),c("span",{key:a,class:"text-red font-semibold text-center ml-80"},d(a.$message),1))),128)):p("",!0),i(n,{id:"porcentaje_avance_estimacion_acumulado",label:"% de avance de la Estimación acumulado",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion_acumulado,"onUpdate:modelValue":o[8]||(o[8]=a=>e.app.residentEstimate.porcentaje_avance_estimacion_acumulado=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion_acumulado.$error?(s(!0),c(u,{key:3},h(e.v$.porcentaje_avance_estimacion_acumulado.$errors,a=>(s(),c("span",{key:a,class:"text-red font-semibold text-center ml-80"},d(a.$message),1))),128)):p("",!0),i(n,{id:"porcentaje_avance_fisico",label:"% de avance físico",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_fisico,"onUpdate:modelValue":o[9]||(o[9]=a=>e.app.residentEstimate.porcentaje_avance_fisico=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_fisico.$error?(s(!0),c(u,{key:4},h(e.v$.porcentaje_avance_fisico.$errors,a=>(s(),c("span",{key:a,class:"text-red font-semibold text-center ml-80"},d(a.$message),1))),128)):p("",!0),i(n,{id:"porcensaje_avance_financiero",label:"% de avance financiero",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcensaje_avance_financiero,"onUpdate:modelValue":o[10]||(o[10]=a=>e.app.residentEstimate.porcensaje_avance_financiero=a)},null,8,["modelValue"]),e.v$.porcensaje_avance_financiero.$error?(s(!0),c(u,{key:5},h(e.v$.porcensaje_avance_financiero.$errors,a=>(s(),c("span",{key:a,class:"text-red font-semibold text-center ml-80"},d(a.$message),1))),128)):p("",!0),i(l,{label:"Guardar",onClick:e.sendForm,class:"mr-0 ml-auto"},null,8,["onClick"])])],64)}const ie=C(J,[["render",ne]]),se={name:"NewResidentbyId",components:{FormResidentEstimate:ie,ArrowBack:q,TitleBar:G,HomePage:Y,LogoutComponent:P},setup(){const v=R(),{rol:o}=v.getAuthData,E=$(),e=z(),t=F({residentEstimate:{id_contrato:"",num_consecutivo_estimacion:"",numero_contrato:"",objeto_contrato:""},loading:!0}),g=async()=>{t.loading=!0;const{data:l}=await H(E.params.residentEstimateId);t.residentEstimate.num_consecutivo_estimacion=l.contador_siguiente_estimacion,t.residentEstimate.numero_contrato=l.numero_contrato,t.residentEstimate.id_contrato=l.id_contrato,t.residentEstimate.objeto_contrato=l.objeto_contrato,t.loading=!1},n=async l=>{await updateResident(l),V.fire("¡Éxito!","!Estimación residente actualizado con éxito!","success"),e.push({name:"Resident"})};return g(),{app:t,rol:o,saveResident:n}}},re={class:"px-4 mt-10"},ce={class:"flex justify-between"},le={class:"flex justify-center items-center"},me={class:"text-black font-semibold mr-4 items-center content-center"},de={class:"px-4"};function _e(v,o,E,e,t,g){const n=f("arrow-back"),l=f("home-page"),a=f("logout-component"),b=f("title-bar"),_=f("form-resident-estimate");return s(),c("main",re,[r("div",ce,[i(n),r("div",le,[r("p",me,d(e.rol),1),i(l),i(a)])]),i(b,{title:"Estimación Residente",subtitle:"Nuevo"}),r("section",de,[e.app.loading?p("",!0):(s(),L(_,{key:0,residentEstimate:e.app.residentEstimate,"edit-mode":""},null,8,["residentEstimate"]))])])}const Be=C(se,[["render",_e]]);export{Be as default};
