import{F as j}from"./FormResident-da73abbb.js";import{A as G}from"./ArrowBack-d631f0c6.js";import{T}from"./TitleBar-4f600169.js";import{I as q}from"./InputBase-65b6879b.js";import{T as V}from"./TableBase-b6531de1.js";import{B as U}from"./fetchApi-bb7df92b.js";import{L}from"./LogoutComponent-5d00cdfd.js";import{f as Y,g as H,h as J,i as K}from"./residentEstimate-bfb32659.js";import{_ as z,o as d,c as u,d as i,t as F,q as M,u as Q,a as W,m as X,r as n,b as f,e as s,g as Z,h as v}from"./index-bacf06e4.js";import{S as c}from"./sweetalert2.all-281a79b7.js";import"./SelectBase-97fcbf9e.js";import"./reviewArea-f7d21815.js";import"./users-57a7d566.js";const $={name:"Banner",props:{title:{type:String,default:""}}},ee={class:"relative isolate flex-1 items-center gap-x-6 overflow-hidden bg-gray-50 px-4 py-1.5 sm:px-2.5 sm:before:flex"},te=i("div",{class:"absolute left-[max(-7rem,calc(50%-52rem))] top-1/2 -z-10 -translate-y-1/2 transform-gpu blur-2xl","aria-hidden":"true"},[i("div",{class:"aspect-[577/310] w-[36.0625rem] bg-gradient-to-r from-[#808080] to-[#808080] opacity-30",style:{"clip-path":"polygon(74.8% 41.9%, 97.2% 73.2%, 100% 34.9%, 92.5% 0.4%, 87.5% 0%, 75% 28.6%, 58.5% 54.6%, 50.1% 56.8%, 46.9% 44%, 48.3% 17.4%, 24.7% 53.9%, 0% 27.9%, 11.9% 74.2%, 24.9% 54.1%, 68.6% 100%, 74.8% 41.9%)"}})],-1),ae=i("div",{class:"absolute left-[max(45rem,calc(50%+8rem))] top-1/2 -z-10 -translate-y-1/2 transform-gpu blur-2xl","aria-hidden":"true"},[i("div",{class:"aspect-[577/310] w-[36.0625rem] bg-gradient-to-r from-[#808080] to-[#808080] opacity-30",style:{"clip-path":"polygon(74.8% 41.9%, 97.2% 73.2%, 100% 34.9%, 92.5% 0.4%, 87.5% 0%, 75% 28.6%, 58.5% 54.6%, 50.1% 56.8%, 46.9% 44%, 48.3% 17.4%, 24.7% 53.9%, 0% 27.9%, 11.9% 74.2%, 24.9% 54.1%, 68.6% 100%, 74.8% 41.9%)"}})],-1),ie={class:"text-3xl text-center"};function oe(O,m,g,t,a,b){return d(),u("div",ee,[te,ae,i("div",null,[i("h2",ie,F(g.title),1)])])}const se=z($,[["render",oe]]),ne={name:"FilesResidentEstimate",components:{FormResident:j,ArrowBack:G,TitleBar:T,InputBase:q,TableBase:V,ButtonBase:U,Banner:se,LogoutComponent:L},setup(){const O=M(),m=Q(),g=W(),t=[{label:"Id",field:"id_archivo_estimacion"},{label:"Nombre Archivo",field:"ruta_archivo_residente"},{label:"Descripción",field:"descripcion_archivo"}],a=X({file:{id_estimacion:"",file:"",descripcionFile:""},data:{},filesById:[],loading:!0,filesResidente:[],filesAreaRevisora:[],filesFinanzas:[],filesDGPOP:[]}),b=n([]),x=n([]),y=n([]),w=n([]),R=n([]),{rol:o}=g.getAuthData,l=n([]),p=n(!1),E=n(!1),B=n(!1),A=n(!1),k=async()=>{a.loading=!0;const{data:e}=await Y(O.params.residentEstimateId);a.data=e,a.file.id_estimacion=e.id_estimacion,_.append("id_estimacion",a.file.id_estimacion),a.loading=!1,l.value=N(a.data.estatus_semaforo),S(),D()},D=async()=>{const{data:e}=await H(a.file.id_estimacion);b.value=e,e.residente&&(x.value=e.residente),e.area_Revisora&&(y.value=e.area_Revisora),e.finanzas&&(w.value=e.finanzas),e.dgpop&&(R.value=e.dgpop)},P=async e=>{await updateResident(e),c.fire("¡Éxito!","Residente actualizado con éxito!","success"),m.push({name:"Resident"})};let _=new FormData;const I=async()=>{try{const{value:e}=await c.fire({title:"Subir Archivo",input:"file",showCancelButton:!0,reverseButtons:!0,inputAttributes:{accept:"application/pdf","aria-label":"Upload your profile picture"}});if(e!=null){const{value:r}=await c.fire({title:"Descripción del archivo",input:"text",showCancelButton:!0,reverseButtons:!0,inputValidator:h=>{if(!h)return"El campo es requerido"}});if(r!==void 0){a.file.descripcionFile=r,a.file.file=e,_.append("archivo_estimacion ",a.file.file),_.append("descripcion_archivo ",a.file.descripcionFile);try{await J(_),D(),c.fire("¡Éxito!","!Archivo guardado con éxito!","success"),a.file.file="",a.file.descripcionFile=""}catch(h){c.fire("Error",`${h.response.data.detail}`,"error")}}}else e===null&&c.fire("No selesccionaste ningun archivo","Agrega uno para continuar","warning")}catch{}},C=[{label:"Descargar",action:async e=>{window.open(`${e.archivo_estimacion}`,"_blank")}},{label:"Eliminar",action:async e=>{console.log("files: ",e),c.fire({title:"¿Estás seguro que desea eliminar el documento?",text:"Esto quitará el documento",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Si, Eliminar!",reverseButtons:!0}).then(async r=>{if(r.isConfirmed)try{await K(e.id_archivo_estimacion),await D(),c.fire("Eliminado!","El documento se eliminó","success")}catch(h){c.fire("Error",`${h.response.data.detail}`,"error")}})}}],N=e=>{var r=!1;return e==="Residente"&&o=="Residente"&&(r=!0),e==="Area Revisora"&&o.includes("Área revisora")&&(r=!0),(e==="Finanzas"||e==="DGPOP")&&o.includes("Finanzas")&&(r=!0),r},S=()=>{o=="Residente"&&(p.value=!0,E.value=!1,B.value=!1,A.value=!1),o.includes("Área revisora")&&(p.value=!1,E.value=!0,B.value=!1,A.value=!1),o.includes("Finanzas")&&(p.value=!1,E.value=!1,B.value=!0,A.value=!0)};return k(),{app:a,filesById:b,saveResident:P,featureOptions:C,formData:_,headers:t,fileUpload:I,filesResidente:x,filesAreaRevisora:y,filesDGPOP:R,filesFinanzas:w,canAddNew:l,canEditResidente:p,canEditAreaRevisora:E,canEditFinanzas:B,canEditPago:A}}},re={class:"px-4 mt-10"},ce={class:"flex justify-between"},le={class:"px-4"},de={class:"flex flex-row justify-between"},fe={class:"font-bold text-lg"},ue={class:"font-bold text-lg w-128 text-center"},me={class:"flex content-start justify-end items-center mb-10"},pe={class:"items-center justify-center"},_e=i("h1",{class:"font-bold text-lg text-center"}," Número de la Estimación ",-1),he={class:"text-center font-semibold text-lg numEstimacion"},ve={key:1,class:"flex flex-col py-px"},ge={key:2},be={key:3},xe={key:4};function ye(O,m,g,t,a,b){const x=f("arrow-back"),y=f("logout-component"),w=f("title-bar"),R=f("button-base"),o=f("banner"),l=f("table-base");return d(),u("main",re,[i("div",ce,[s(x),s(y)]),s(w,{title:"Estimación Residente",subtitle:"Archivos"}),i("section",le,[i("div",de,[i("div",fe,F(t.app.data.numero_contrato),1),i("div",ue," Objeto: "+F(t.app.data.objeto_contrato),1),i("div",me,[i("div",pe,[_e,i("p",he,F(t.app.data.num_consecutivo_estimacion),1)])])]),t.canAddNew?(d(),Z(R,{key:0,label:"Nuevo",onClick:m[0]||(m[0]=p=>t.fileUpload()),class:"mr-0 ml-auto mb-5"})):v("",!0),t.filesResidente.length?(d(),u("div",ve,[s(o,{title:"Documentos de Residente"}),s(l,{options:t.featureOptions,headers:t.headers,data:t.filesResidente,showOptions:t.canEditResidente},null,8,["options","headers","data","showOptions"])])):v("",!0),t.filesAreaRevisora.length?(d(),u("div",ge,[s(o,{title:"Documentos de Área Revisora"}),s(l,{options:t.featureOptions,headers:t.headers,data:t.filesAreaRevisora,showOptions:t.canEditAreaRevisora},null,8,["options","headers","data","showOptions"])])):v("",!0),t.filesFinanzas.length?(d(),u("div",be,[s(o,{title:"Documentos de Finanzas"}),s(l,{options:t.featureOptions,headers:t.headers,data:t.filesFinanzas,showOptions:t.canEditFinanzas},null,8,["options","headers","data","showOptions"])])):v("",!0),t.filesDGPOP.length?(d(),u("div",xe,[s(o,{title:"Documentos de Registro de Pago"}),s(l,{options:t.featureOptions,headers:t.headers,data:t.filesDGPOP,showOptions:t.canEditPago},null,8,["options","headers","data","showOptions"])])):v("",!0)])])}const Ne=z(ne,[["render",ye]]);export{Ne as default};
