import{F as G}from"./FormResident-73a20b4f.js";import{T as J}from"./TitleBar-95cae43a.js";import{I as K}from"./InputBase-f2420b6e.js";import{T as L}from"./TableBase-7cffe17b.js";import{B as M}from"./fetchApi-ea3a2dff.js";import{a as Q,g as W,h as X,i as Z}from"./residentEstimate-9b67d988.js";import{_ as T,o as f,c as u,d as n,t as y,q as $,u as ee,a as ae,m as te,r as o,b as v,e as r,g as ie,h}from"./index-ae47c3ce.js";import{S as l}from"./sweetalert2.all-281a79b7.js";import{C as oe}from"./CustomHeaderApp-790e617d.js";import"./SelectBase-4b15a31f.js";import"./reviewArea-361aa204.js";import"./users-ed655b29.js";import"./ArrowBack-858e36ad.js";import"./HomePage-790bb899.js";import"./LogoutComponent-26312cbb.js";const ne={name:"Banner",props:{title:{type:String,default:""}}},se={class:"relative isolate flex-1 items-center gap-x-6 overflow-hidden bg-gray-50 px-4 py-1.5 sm:px-2.5 sm:before:flex"},re=n("div",{class:"absolute left-[max(-7rem,calc(50%-52rem))] top-1/2 -z-10 -translate-y-1/2 transform-gpu blur-2xl","aria-hidden":"true"},[n("div",{class:"aspect-[577/310] w-[36.0625rem] bg-gradient-to-r from-[#808080] to-[#808080] opacity-30",style:{"clip-path":"polygon(74.8% 41.9%, 97.2% 73.2%, 100% 34.9%, 92.5% 0.4%, 87.5% 0%, 75% 28.6%, 58.5% 54.6%, 50.1% 56.8%, 46.9% 44%, 48.3% 17.4%, 24.7% 53.9%, 0% 27.9%, 11.9% 74.2%, 24.9% 54.1%, 68.6% 100%, 74.8% 41.9%)"}})],-1),le=n("div",{class:"absolute left-[max(45rem,calc(50%+8rem))] top-1/2 -z-10 -translate-y-1/2 transform-gpu blur-2xl","aria-hidden":"true"},[n("div",{class:"aspect-[577/310] w-[36.0625rem] bg-gradient-to-r from-[#808080] to-[#808080] opacity-30",style:{"clip-path":"polygon(74.8% 41.9%, 97.2% 73.2%, 100% 34.9%, 92.5% 0.4%, 87.5% 0%, 75% 28.6%, 58.5% 54.6%, 50.1% 56.8%, 46.9% 44%, 48.3% 17.4%, 24.7% 53.9%, 0% 27.9%, 11.9% 74.2%, 24.9% 54.1%, 68.6% 100%, 74.8% 41.9%)"}})],-1),ce={class:"text-3xl text-center"};function de(x,p,_,e,t,w){return f(),u("div",se,[re,le,n("div",null,[n("h2",ce,y(_.title),1)])])}const fe=T(ne,[["render",de]]),ue={name:"FilesResidentEstimate",components:{FormResident:G,TitleBar:J,InputBase:K,TableBase:L,ButtonBase:M,Banner:fe,CustomHeaderApp:oe},setup(){const x=$(),p=ee(),_=ae(),e=[{label:"Id",field:"id_archivo_estimacion"},{label:"Nombre archivo",field:"ruta_archivo_residente"},{label:"Descripción",field:"descripcion_archivo"}],t=te({file:{id_estimacion:"",file:"",descripcionFile:""},data:{},filesById:[],loading:!0,filesResidente:[],filesAreaRevisora:[],filesFinanzas:[],filesTramite_Pago:[]}),w=o([]),g=o([]),b=o([]),R=o([]),c=o([]),{rol:i}=_.getAuthData,E=o([]),F=o(!1),O=o(!1),B=o(!1),z=o(!1),I=o([{label:"Descargar",action:async a=>{window.open(`${a.archivo_estimacion}`,"_blank")}}]),A=o([]),C=o([]),D=o([]),P=async()=>{t.loading=!0;const{data:a}=await Q(x.params.residentEstimateId);t.data=a,t.file.id_estimacion=a.id_estimacion,m.append("id_estimacion",t.file.id_estimacion),E.value=q(t.data.estatus_semaforo),V(),H(t.data.estatus_estimacion),N(),t.loading=!1},N=async()=>{const{data:a}=await W(t.file.id_estimacion);a.residente&&(g.value=a.residente),a.area_revisora&&(b.value=a.area_revisora),a.finanzas&&(R.value=a.finanzas),a.tramite_pago&&(c.value=a.tramite_pago)},S=async a=>{await updateResident(a),l.fire("¡Éxito!","Residente actualizado con éxito!","success"),p.push({name:"Resident"})};let m=new FormData;const j=async()=>{try{const{value:a}=await l.fire({title:"Subir Archivo",input:"file",showCancelButton:!0,reverseButtons:!0,inputAttributes:{accept:"application/pdf","aria-label":"Upload your profile picture"}});if(a!=null){const{value:s}=await l.fire({title:"Descripción del archivo",input:"text",showCancelButton:!0,reverseButtons:!0,inputValidator:d=>{if(!d)return"El campo es requerido"}});if(s!==void 0){t.file.descripcionFile=s,t.file.file=a,m.append("archivo_estimacion ",t.file.file),m.append("descripcion_archivo ",t.file.descripcionFile);try{await X(m),N(),l.fire("¡Éxito!","!Archivo guardado con éxito!","success"),t.file.file="",t.file.descripcionFile=""}catch(d){l.fire("Error",`${d.response.data.detail}`,"error")}}}else a===null&&l.fire("No selesccionaste ningun archivo","Agrega uno para continuar","warning")}catch{}},q=a=>{var s=!1;return a==="Residente"&&i==="Residente"&&(s=!0),a==="Area Revisora"&&(i.includes("Área revisora")||i.includes("Obras y Contratos"))&&(s=!0),(a==="Finanzas"||a==="Tramite de Pago")&&i.includes("Finanzas")&&(s=!0),s},V=()=>{F.value=!0,O.value=!0,B.value=!0,z.value=!0},H=a=>{const s=async k=>{window.open(`${k.archivo_estimacion}`,"_blank")},d=async k=>{l.fire({title:"¿Estás seguro que desea eliminar el documento?",text:"Esto quitará el documento",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Si, Eliminar!",reverseButtons:!0}).then(async U=>{if(U.isConfirmed)try{await Z(k.id_archivo_estimacion),await N(),l.fire("Eliminado!","El documento se eliminó","success")}catch(Y){l.fire("Error",`${Y.response.data.detail}`,"error")}})};a==="Pagada"?(F.value=!0,O.value=!0,B.value=!0,z.value=!0,I.value=[{label:"Descargar",action:s}]):(i.includes("Residente")&&(a==="Capturada por Residente"||a==="Autorizada por Residente"||a==="Regresada al Residente")?A.value=[{label:"Descargar",action:s},{label:"Eliminar",action:d}]:A.value=[],(i.includes("Obras y Contratos")||i.includes("Área revisora"))&&(a==="En validación del área revisora"||a==="Regresada al área revisora")?C.value=[{label:"Descargar",action:s},{label:"Eliminar",action:d}]:C.value=[],i.includes("Finanzas")&&(a==="En validación de Finanzas"||a==="Regresada a Finanzas"||a==="En trámite de pago")?D.value=[{label:"Descargar",action:s},{label:"Eliminar",action:d}]:D.value=[])};return P(),{app:t,filesById:w,featureOptions:I,featureOptionsResidente:A,featureOptionsAreaRevisora:C,featureOptionsFianzas:D,formData:m,headers:e,filesResidente:g,filesAreaRevisora:b,filesTramite_Pago:c,filesFinanzas:R,canAddNew:E,canEditResidente:F,canEditAreaRevisora:O,canEditFinanzas:B,canEditPago:z,rol:i,saveResident:S,fileUpload:j}}},pe={class:"px-4 mt-10"},me={class:"px-4"},ve={class:"flex flex-row justify-between"},he={class:"font-bold text-lg"},_e={class:"font-bold text-lg w-128 text-center"},ge={class:"flex content-start justify-end items-center mb-10"},be={class:"items-center justify-center"},Re=n("h1",{class:"font-bold text-lg text-center"}," Número de la Estimación ",-1),ye={class:"text-center font-semibold text-lg numEstimacion"},xe={key:1,class:"flex flex-col py-px"},we={key:2},Ee={key:3},Fe={key:4};function Oe(x,p,_,e,t,w){const g=v("CustomHeaderApp"),b=v("title-bar"),R=v("button-base"),c=v("banner"),i=v("table-base");return f(),u("main",pe,[r(g),r(b,{title:"Estimación Residente",subtitle:"Archivos"}),n("section",me,[n("div",ve,[n("div",he,y(e.app.data.numero_contrato),1),n("div",_e," Objeto: "+y(e.app.data.objeto_contrato),1),n("div",ge,[n("div",be,[Re,n("p",ye,y(e.app.data.num_consecutivo_estimacion),1)])])]),e.canAddNew?(f(),ie(R,{key:0,label:"Nuevo",onClick:p[0]||(p[0]=E=>e.fileUpload()),class:"mr-0 ml-auto mb-5"})):h("",!0),e.filesResidente.length?(f(),u("div",xe,[r(c,{title:"Documentos de Residente"}),r(i,{description:"Residente",options:e.featureOptionsResidente.length!==0?e.featureOptionsResidente:e.featureOptions,headers:e.headers,data:e.filesResidente,showOptions:e.canEditResidente,tableName:"residente"},null,8,["options","headers","data","showOptions"])])):h("",!0),e.filesAreaRevisora.length?(f(),u("div",we,[r(c,{title:"Documentos de Área Revisora"}),r(i,{description:"Área Revisora",options:e.featureOptionsAreaRevisora.length!==0?e.featureOptionsAreaRevisora:e.featureOptions,headers:e.headers,data:e.filesAreaRevisora,showOptions:e.canEditAreaRevisora,tableName:"area-revisora"},null,8,["options","headers","data","showOptions"])])):h("",!0),e.filesFinanzas.length?(f(),u("div",Ee,[r(c,{title:"Documentos de Finanzas"}),r(i,{description:"Finanzas",options:e.featureOptionsFianzas.length!==0?e.featureOptionsFianzas:e.featureOptions,headers:e.headers,data:e.filesFinanzas,showOptions:e.canEditFinanzas,tableName:"finanzas"},null,8,["options","headers","data","showOptions"])])):h("",!0),e.filesTramite_Pago.length?(f(),u("div",Fe,[r(c,{title:"Documentos de Tramite de Pago"}),r(i,{description:"Registro de Pago",options:e.featureOptionsFianzas.length!==0?e.featureOptionsFianzas:e.featureOptions,headers:e.headers,data:e.filesTramite_Pago,showOptions:e.canEditPago,tableName:"pago"},null,8,["options","headers","data","showOptions"])])):h("",!0)])])}const Ue=T(ue,[["render",Oe]]);export{Ue as default};
