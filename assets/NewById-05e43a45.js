import{I}from"./InputBase-c5c29cdd.js";import{B as M}from"./fetchApi-6f7d5678.js";import{S as U}from"./SelectBase-7addb378.js";import{T as A}from"./TextAreaBase-1df588a3.js";import{s as N,c as S}from"./residentEstimate-abbf2f02.js";import{_ as k,a as T,u as R,m as z,s as D,b as V,o as n,c as s,d as c,t as _,e as r,F as u,f as E,h as p,q as $,g as H}from"./index-284224ac.js";import{S as x}from"./sweetalert2.all-281a79b7.js";import{u as L,c as m,m as h,a as g}from"./index-fa5d7ad9.js";import{T as O}from"./TitleBar-e4a4b5bb.js";import{a as q}from"./contract-23dbbb00.js";import{C as G}from"./CustomHeaderApp-9682a33e.js";import"./ArrowBack-8c37bbd5.js";import"./HomePage-45decf19.js";import"./LogoutComponent-990bb1e2.js";import"./ManualComponent-3719973b.js";const P={name:"FormResidentEstimate",props:{editMode:{type:Boolean,default:!1},residentEstimate:{type:Object,default:()=>({})}},components:{InputBase:I,ButtonBase:M,SelectBase:U,TextAreaBase:A},setup(f){const t=T(),{rol:l}=t.getAuthData,e=R(),o=z({residentEstimate:{id_contrato:"",fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",importe_obra_ejecutada:"",importe_pagar:"",grado_avance_obra:"",porcentaje_avance_estimacion:"",porcentaje_avance_estimacion_acumulado:"",porcentaje_avance_fisico:"",porcensaje_avance_financiero:""},fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",contratoName:"",fileInfo:{type:Object,default:()=>({})},listReviewAreas:[],listEmpleados:[],listContrato:[]}),d=()=>{let y=new Date;var b=("0"+y.getDate()).slice(-2),w=("0"+(y.getMonth()+1)).slice(-2),j=y.getFullYear(),B=j+"-"+w+"-"+b;return!(o.fecha_autorizacion_contratista>B)},i=D(()=>({porcentaje_avance_estimacion:{maxValue:m.withMessage("El valor maximo es 100%",h(100)),minValue:m.withMessage("El valor minimo es 0%",g(0))},porcentaje_avance_estimacion_acumulado:{maxValue:m.withMessage("El valor maximo es 100%",h(100)),minValue:m.withMessage("El valor minimo es 0%",g(0))},porcentaje_avance_fisico:{maxValue:m.withMessage("El valor maximo es 100%",h(100)),minValue:m.withMessage("El valor minimo es 0%",g(0))},porcensaje_avance_financiero:{maxValue:m.withMessage("El valor maximo es 100%",h(100)),minValue:m.withMessage("El valor minimo es 0%",g(0))},grado_avance_obra:{maxValue:m.withMessage("El valor maximo es 100%",h(100)),minValue:m.withMessage("El valor minimo es 0%",g(0))},fecha_autorizacion_contratista:{fechaActualFunction:m.withMessage("La fecha es mayor al dia de hoy",d)}}));f.editMode&&(o.residentEstimate=f.residentEstimate);const v=L(i,o.residentEstimate);return{app:o,sendForm:()=>{var b=new Date().toLocaleTimeString("en-GB");o.residentEstimate.fecha_recepcion_info_contratista=o.fecha_recepcion_info_contratista+" "+b,o.fecha_autorizacion_contratista===""?delete o.residentEstimate.fecha_autorizacion_contratista:o.residentEstimate.fecha_autorizacion_contratista=o.fecha_autorizacion_contratista+" "+b,o.residentEstimate.fecha_periodo_inicio_estimacion=o.fecha_periodo_inicio_estimacion+" "+b,o.residentEstimate.fecha_periodo_fin_estimacion=o.fecha_periodo_fin_estimacion+" "+b,x.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async w=>{if(w.isConfirmed)try{await v.value.$validate()?(delete o.residentEstimate.num_consecutivo_estimacion,await N(o.residentEstimate),x.fire({title:"Registro dado de alta",text:"¿Desea ingresar los documentos?",icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí",cancelButtonText:"No",reverseButtons:!0}).then(async B=>{if(B.isConfirmed){const{data:C}=await S(),F=C.length-1;o.fileInfo=C[F],e.push({name:"FilesResidentEstimate",params:{residentEstimateId:o.fileInfo.id_estimacion}})}else e.push({name:"ResidentEstimate"})})):x.fire("Error","Revisa bien los datos","error")}catch(j){x.fire("Error",`${j.response.data.detail}`,"error")}})},v$:v,rol:l}}},Y={class:"flex flex-row justify-between"},J={class:"font-bold text-lg"},K={class:"font-bold text-lg w-128"},Q={class:"flex content-start justify-end items-center mb-10"},W={class:"items-center justify-center"},X=c("h1",{class:"font-bold text-lg"}," Número de la Estimación ",-1),Z={class:"text-center font-semibold text-lg numEstimacion"},ee={class:"max-w-xl mx-auto"},ae={class:"flex flex-row"};function te(f,t,l,e,o,d){const i=V("input-base"),v=V("button-base");return n(),s(u,null,[c("div",Y,[c("div",J,_(e.app.residentEstimate.numero_contrato),1),c("div",K," Objeto: "+_(e.app.residentEstimate.objeto_contrato),1),c("div",Q,[c("div",W,[X,c("p",Z,_(e.app.residentEstimate.num_consecutivo_estimacion),1)])])]),c("div",ee,[r(i,{id:"fecha_recepcion_info_contratista",label:"Fecha de recepción de información del Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_recepcion_info_contratista,"onUpdate:modelValue":t[0]||(t[0]=a=>e.app.fecha_recepcion_info_contratista=a)},null,8,["modelValue"]),r(i,{id:"fecha_autorizacion_contratista",label:"Fecha de autorización al Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_autorizacion_contratista,"onUpdate:modelValue":t[1]||(t[1]=a=>e.app.fecha_autorizacion_contratista=a)},null,8,["modelValue"]),e.v$.fecha_autorizacion_contratista.$error?(n(!0),s(u,{key:0},E(e.v$.fecha_autorizacion_contratista.$errors,a=>(n(),s("span",{key:a,class:"text-red font-semibold text-center ml-80"},_(a.$message),1))),128)):p("",!0),c("div",ae,[c("div",null,[r(i,{id:"fecha_periodo_inicio_estimacion",label:"Período de la Estimación",type:"date",modelValue:e.app.fecha_periodo_inicio_estimacion,"onUpdate:modelValue":t[2]||(t[2]=a=>e.app.fecha_periodo_inicio_estimacion=a)},null,8,["modelValue"])]),c("div",null,[r(i,{id:"fecha_periodo_fin_estimacion",label:"al",type:"date",class:"pt-2",modelValue:e.app.fecha_periodo_fin_estimacion,"onUpdate:modelValue":t[3]||(t[3]=a=>e.app.fecha_periodo_fin_estimacion=a)},null,8,["modelValue"])])]),r(i,{id:"importe_obra_ejecutada",label:"Importe de la obra ejecutada",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_obra_ejecutada,"onUpdate:modelValue":t[4]||(t[4]=a=>e.app.residentEstimate.importe_obra_ejecutada=a)},null,8,["modelValue"]),r(i,{id:"importe_pagar",label:"Importe a pagar",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_pagar,"onUpdate:modelValue":t[5]||(t[5]=a=>e.app.residentEstimate.importe_pagar=a)},null,8,["modelValue"]),r(i,{id:"grado_avance_obra",label:"% de grado de avance",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.grado_avance_obra,"onUpdate:modelValue":t[6]||(t[6]=a=>e.app.residentEstimate.grado_avance_obra=a)},null,8,["modelValue"]),e.v$.grado_avance_obra.$error?(n(!0),s(u,{key:1},E(e.v$.grado_avance_obra.$errors,a=>(n(),s("span",{key:a,class:"text-red font-semibold text-center ml-80"},_(a.$message),1))),128)):p("",!0),r(i,{id:"porcentaje_avance_estimacion",label:"% de avance de la Estimación",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion,"onUpdate:modelValue":t[7]||(t[7]=a=>e.app.residentEstimate.porcentaje_avance_estimacion=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion.$error?(n(!0),s(u,{key:2},E(e.v$.porcentaje_avance_estimacion.$errors,a=>(n(),s("span",{key:a,class:"text-red font-semibold text-center ml-80"},_(a.$message),1))),128)):p("",!0),r(i,{id:"porcentaje_avance_estimacion_acumulado",label:"% de avance de la Estimación acumulado",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion_acumulado,"onUpdate:modelValue":t[8]||(t[8]=a=>e.app.residentEstimate.porcentaje_avance_estimacion_acumulado=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion_acumulado.$error?(n(!0),s(u,{key:3},E(e.v$.porcentaje_avance_estimacion_acumulado.$errors,a=>(n(),s("span",{key:a,class:"text-red font-semibold text-center ml-80"},_(a.$message),1))),128)):p("",!0),r(i,{id:"porcentaje_avance_fisico",label:"% de avance físico",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_fisico,"onUpdate:modelValue":t[9]||(t[9]=a=>e.app.residentEstimate.porcentaje_avance_fisico=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_fisico.$error?(n(!0),s(u,{key:4},E(e.v$.porcentaje_avance_fisico.$errors,a=>(n(),s("span",{key:a,class:"text-red font-semibold text-center ml-80"},_(a.$message),1))),128)):p("",!0),r(i,{id:"porcensaje_avance_financiero",label:"% de avance financiero",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcensaje_avance_financiero,"onUpdate:modelValue":t[10]||(t[10]=a=>e.app.residentEstimate.porcensaje_avance_financiero=a)},null,8,["modelValue"]),e.v$.porcensaje_avance_financiero.$error?(n(!0),s(u,{key:5},E(e.v$.porcensaje_avance_financiero.$errors,a=>(n(),s("span",{key:a,class:"text-red font-semibold text-center ml-80"},_(a.$message),1))),128)):p("",!0),r(v,{label:"Guardar",onClick:e.sendForm,class:"mr-0 ml-auto"},null,8,["onClick"])])],64)}const oe=k(P,[["render",te]]),ie={name:"NewResidentbyId",components:{FormResidentEstimate:oe,TitleBar:O,CustomHeaderApp:G},setup(){const f=$(),t=R(),l=z({residentEstimate:{id_contrato:"",num_consecutivo_estimacion:"",numero_contrato:"",objeto_contrato:""},loading:!0}),e=async()=>{l.loading=!0;const{data:d}=await q(f.params.residentEstimateId);l.residentEstimate.num_consecutivo_estimacion=d.contador_siguiente_estimacion,l.residentEstimate.numero_contrato=d.numero_contrato,l.residentEstimate.id_contrato=d.id_contrato,l.residentEstimate.objeto_contrato=d.objeto_contrato,l.loading=!1},o=async d=>{await updateResident(d),x.fire("¡Éxito!","!Estimación residente actualizado con éxito!","success"),t.push({name:"Resident"})};return e(),{app:l,saveResident:o}}},ne={class:"px-4 mt-10"},se={class:"px-4"};function re(f,t,l,e,o,d){const i=V("CustomHeaderApp"),v=V("title-bar"),a=V("form-resident-estimate");return n(),s("main",ne,[r(i),r(v,{title:"Estimación Residente",subtitle:"Nuevo"}),c("section",se,[e.app.loading?p("",!0):(n(),H(a,{key:0,residentEstimate:e.app.residentEstimate,"edit-mode":""},null,8,["residentEstimate"]))])])}const ye=k(ie,[["render",re]]);export{ye as default};
