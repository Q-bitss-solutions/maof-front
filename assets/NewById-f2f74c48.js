import{I}from"./InputBase-bdcef8e0.js";import{B as z}from"./ButtonBase-3a358441.js";import{S as A}from"./SelectBase-05279e57.js";import{T as F}from"./TextAreaBase-a0ee2288.js";import{A as M,T as U}from"./TitleBar-c6610f6e.js";import{s as N,b as T}from"./residentEstimate-1a35892d.js";import{_ as B,u as k,k as R,q as S,a as E,o as i,c as r,b as l,t as _,g as n,F as f,d as b,f as v,l as D,e as O}from"./index-e9431c5a.js";import{S as y}from"./sweetalert2.all-281a79b7.js";import{u as L,c as d,m as x,a as V}from"./index-38a598b7.js";import{a as $}from"./contract-fcebeb16.js";const q={name:"FormResidentEstimate",props:{editMode:{type:Boolean,default:!1},residentEstimate:{type:Object,default:()=>({})}},components:{InputBase:I,ButtonBase:z,SelectBase:A,TextAreaBase:F},setup(p){const o=k(),t=R({residentEstimate:{id_contrato:"",fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",importe_obra_ejecutada:"",importe_pagar:"",grado_avance_obra:"",porcentaje_avance_estimacion:"",porcentaje_avance_estimacion_acumulado:"",porcentaje_Avance_fisico:"",porcensaje_avance_financiero:"",observaciones_residente:""},fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",contratoName:"",fileInfo:{type:Object,default:()=>({})},listReviewAreas:[],listEmpleados:[],listContrato:[]}),e=()=>{let u=new Date;var m=("0"+u.getDate()).slice(-2),a=("0"+(u.getMonth()+1)).slice(-2),h=u.getFullYear(),j=h+"-"+a+"-"+m;return t.fecha_autorizacion_contratista>j?(console.log("Entro"),!1):!0},g=S(()=>({porcentaje_avance_estimacion:{maxValue:d.withMessage("El valor maximo es 100%",x(100)),minValue:d.withMessage("El valor minimo es 0%",V(0))},porcentaje_avance_estimacion_acumulado:{maxValue:d.withMessage("El valor maximo es 100%",x(100)),minValue:d.withMessage("El valor minimo es 0%",V(0))},porcentaje_Avance_fisico:{maxValue:d.withMessage("El valor maximo es 100%",x(100)),minValue:d.withMessage("El valor minimo es 0%",V(0))},porcensaje_avance_financiero:{maxValue:d.withMessage("El valor maximo es 100%",x(100)),minValue:d.withMessage("El valor minimo es 0%",V(0))},grado_avance_obra:{maxValue:d.withMessage("El valor maximo es 100%",x(100)),minValue:d.withMessage("El valor minimo es 0%",V(0))},fecha_autorizacion_contratista:{fechaActualFunction:d.withMessage("La fecha es mayor al dia de hoy",e)}}));p.editMode&&(console.log("props.residentEstimate: ",p.residentEstimate),t.residentEstimate=p.residentEstimate);const c=L(g,t.residentEstimate);return{app:t,sendForm:()=>{var m=new Date().toLocaleTimeString("en-GB");console.log(m),t.residentEstimate.fecha_recepcion_info_contratista=t.fecha_recepcion_info_contratista+" "+m,t.fecha_autorizacion_contratista===""?delete t.residentEstimate.fecha_autorizacion_contratista:t.residentEstimate.fecha_autorizacion_contratista=t.fecha_autorizacion_contratista+" "+m,t.residentEstimate.fecha_periodo_inicio_estimacion=t.fecha_periodo_inicio_estimacion+" "+m,t.residentEstimate.fecha_periodo_fin_estimacion=t.fecha_periodo_fin_estimacion+" "+m,y.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async a=>{if(a.isConfirmed)try{await c.value.$validate()?(delete t.residentEstimate.num_consecutivo_estimacion,console.log("residentEstimate Post: ",t.residentEstimate),await N(t.residentEstimate),y.fire({title:"Registro dado de alta",text:"¿Desea ingresar los documentos?",icon:"success",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No",reverseButtons:!0}).then(async j=>{if(j.isConfirmed){const{data:w}=await T(),C=w.length-1;t.fileInfo=w[C],console.log("fileInfo: ",t.fileInfo.id_estimacion),o.push({name:"FilesResidentEstimate",params:{residentEstimateId:t.fileInfo.id_estimacion}})}else o.push({name:"ResidentEstimate"})})):y.fire("Error","Revisa bien los datos","error")}catch(h){console.log("error: ",h.response.data.detail),y.fire("Error",`${h.response.data.detail}`,"error")}})},v$:c}}},G={class:"flex flex-row justify-between"},P={class:"font-bold text-lg"},Y={class:"font-bold text-lg w-128"},H={class:"flex content-start justify-end items-center mb-10"},J={class:"items-center justify-center"},K=l("h1",{class:"font-bold text-lg"}," Número de la Estimación ",-1),Q={class:"text-center font-semibold text-lg numEstimacion"},W={class:"max-w-xl mx-auto"},X={class:"flex flex-row"};function Z(p,o,t,e,g,c){const s=E("input-base"),u=E("text-area-base"),m=E("button-base");return i(),r(f,null,[l("div",G,[l("div",P,_(e.app.residentEstimate.numero_contrato),1),l("div",Y," Objeto: "+_(e.app.residentEstimate.objeto_contrato),1),l("div",H,[l("div",J,[K,l("p",Q,_(e.app.residentEstimate.num_consecutivo_estimacion),1)])])]),l("div",W,[n(s,{id:"fecha_recepcion_info_contratista",label:"Fecha de recepción de información del Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_recepcion_info_contratista,"onUpdate:modelValue":o[0]||(o[0]=a=>e.app.fecha_recepcion_info_contratista=a)},null,8,["modelValue"]),n(s,{id:"fecha_autorizacion_contratista",label:"Fecha de autorización al Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_autorizacion_contratista,"onUpdate:modelValue":o[1]||(o[1]=a=>e.app.fecha_autorizacion_contratista=a)},null,8,["modelValue"]),e.v$.fecha_autorizacion_contratista.$error?(i(!0),r(f,{key:0},b(e.v$.fecha_autorizacion_contratista.$errors,a=>(i(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},_(a.$message),1))),128)):v("",!0),l("div",X,[l("div",null,[n(s,{id:"fecha_periodo_inicio_estimacion",label:"Período de la Estimación",type:"date",modelValue:e.app.fecha_periodo_inicio_estimacion,"onUpdate:modelValue":o[2]||(o[2]=a=>e.app.fecha_periodo_inicio_estimacion=a)},null,8,["modelValue"])]),l("div",null,[n(s,{id:"fecha_periodo_fin_estimacion",label:"al",type:"date",class:"pt-2",modelValue:e.app.fecha_periodo_fin_estimacion,"onUpdate:modelValue":o[3]||(o[3]=a=>e.app.fecha_periodo_fin_estimacion=a)},null,8,["modelValue"])])]),n(s,{id:"importe_obra_ejecutada",label:"Importe de la obra ejecutada",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_obra_ejecutada,"onUpdate:modelValue":o[4]||(o[4]=a=>e.app.residentEstimate.importe_obra_ejecutada=a)},null,8,["modelValue"]),n(s,{id:"importe_pagar",label:"Importe a pagar",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_pagar,"onUpdate:modelValue":o[5]||(o[5]=a=>e.app.residentEstimate.importe_pagar=a)},null,8,["modelValue"]),n(s,{id:"grado_avance_obra",label:"% de grado de avance",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.grado_avance_obra,"onUpdate:modelValue":o[6]||(o[6]=a=>e.app.residentEstimate.grado_avance_obra=a)},null,8,["modelValue"]),e.v$.grado_avance_obra.$error?(i(!0),r(f,{key:1},b(e.v$.grado_avance_obra.$errors,a=>(i(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},_(a.$message),1))),128)):v("",!0),n(s,{id:"porcentaje_avance_estimacion",label:"% de avance de la Estimación",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion,"onUpdate:modelValue":o[7]||(o[7]=a=>e.app.residentEstimate.porcentaje_avance_estimacion=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion.$error?(i(!0),r(f,{key:2},b(e.v$.porcentaje_avance_estimacion.$errors,a=>(i(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},_(a.$message),1))),128)):v("",!0),n(s,{id:"porcentaje_avance_estimacion_acumulado",label:"% de avance de la Estimación acumulado",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion_acumulado,"onUpdate:modelValue":o[8]||(o[8]=a=>e.app.residentEstimate.porcentaje_avance_estimacion_acumulado=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion_acumulado.$error?(i(!0),r(f,{key:3},b(e.v$.porcentaje_avance_estimacion_acumulado.$errors,a=>(i(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},_(a.$message),1))),128)):v("",!0),n(s,{id:"porcentaje_Avance_fisico",label:"% de avance físico",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_Avance_fisico,"onUpdate:modelValue":o[9]||(o[9]=a=>e.app.residentEstimate.porcentaje_Avance_fisico=a)},null,8,["modelValue"]),e.v$.porcentaje_Avance_fisico.$error?(i(!0),r(f,{key:4},b(e.v$.porcentaje_Avance_fisico.$errors,a=>(i(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},_(a.$message),1))),128)):v("",!0),n(s,{id:"porcensaje_avance_financiero",label:"% de avance financiero",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcensaje_avance_financiero,"onUpdate:modelValue":o[10]||(o[10]=a=>e.app.residentEstimate.porcensaje_avance_financiero=a)},null,8,["modelValue"]),e.v$.porcensaje_avance_financiero.$error?(i(!0),r(f,{key:5},b(e.v$.porcensaje_avance_financiero.$errors,a=>(i(),r("span",{key:a,class:"text-red font-semibold text-center ml-80"},_(a.$message),1))),128)):v("",!0),n(u,{id:"fecha_inicio_proyecto",label:"Observaciones del Residente",class:"mb-3",modelValue:e.app.residentEstimate.observaciones_residente,"onUpdate:modelValue":o[11]||(o[11]=a=>e.app.residentEstimate.observaciones_residente=a)},null,8,["modelValue"]),n(m,{label:"Guardar",onClick:e.sendForm,class:"mr-0 ml-auto"},null,8,["onClick"])])],64)}const ee=B(q,[["render",Z]]),ae={name:"NewResidentbyId",components:{FormResidentEstimate:ee,ArrowBack:M,TitleBar:U},setup(){const p=D(),o=k(),t=R({residentEstimate:{id_contrato:"",num_consecutivo_estimacion:"",numero_contrato:"",objeto_contrato:""},loading:!0}),e=async()=>{t.loading=!0;const{data:c}=await $(p.params.residentEstimateId);console.log(c),t.residentEstimate.num_consecutivo_estimacion=c.contador_siguiente_estimacion,t.residentEstimate.numero_contrato=c.numero_contrato,t.residentEstimate.id_contrato=c.id_contrato,t.residentEstimate.objeto_contrato=c.objeto_contrato,console.log("app.residentEstimate",t.residentEstimate),t.loading=!1},g=async c=>{await updateResident(c),y.fire("¡Éxito!","!Estimación residente actualizado con éxito!","success"),o.push({name:"Resident"})};return e(),{app:t,saveResident:g}}},te={class:"px-4 mt-10"},oe={class:"px-4"};function ie(p,o,t,e,g,c){const s=E("arrow-back"),u=E("title-bar"),m=E("form-resident-estimate");return i(),r("main",te,[n(s),n(u,{title:"Estimación Residente By Id",subtitle:"Nuevo"}),l("section",oe,[e.app.loading?v("",!0):(i(),O(m,{key:0,residentEstimate:e.app.residentEstimate,"edit-mode":""},null,8,["residentEstimate"]))])])}const fe=B(ae,[["render",ie]]);export{fe as default};
