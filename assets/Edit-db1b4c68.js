import{I as A}from"./InputBase-6bc46bdf.js";import{B as F}from"./ButtonBase-8cf21474.js";import{S as M}from"./SelectBase-004dd447.js";import{T}from"./TextAreaBase-82740e33.js";import{A as U,T as I}from"./TitleBar-ba83f74c.js";import{u as S,d as N,c as q,e as D}from"./residentEstimate-8f8c2b68.js";import{_ as C,u as k,k as R,q as O,a as x,o as c,c as d,b as l,t as f,g as n,F as h,d as V,f as b,e as z,l as L}from"./index-00892325.js";import{S as m}from"./sweetalert2.all-281a79b7.js";import{u as G,c as u,m as y,a as j}from"./index-a9d1baa9.js";const P={name:"FormResidentEstimate",props:{editMode:{type:Boolean,default:!1},residentEstimate:{type:Object,default:()=>({})}},components:{InputBase:A,ButtonBase:F,SelectBase:M,TextAreaBase:T},setup(s){const o=k(),t=R({residentEstimate:{id_contrato:"",fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",importe_obra_ejecutada:"",importe_pagar:"",grado_avance_obra:"",porcentaje_avance_estimacion:"",porcentaje_avance_estimacion_acumulado:"",porcentaje_Avance_fisico:"",porcensaje_avance_financiero:"",observaciones_residente:""},fecha_recepcion_info_contratista:"",fecha_autorizacion_contratista:"",fecha_periodo_inicio_estimacion:"",fecha_periodo_fin_estimacion:"",contratoName:"",estatus_semaforo:"",fileInfo:{type:Object,default:()=>({})},listReviewAreas:[],listEmpleados:[],listContrato:[]}),e=E=>{let i=[];return i=E.split(" "),i=i[0].split("-"),i=i[0]+"-"+i[1]+"-"+i[2],E=i,E},g=O(()=>({porcentaje_avance_estimacion:{maxValue:u.withMessage("El valor maximo es 100%",y(100)),minValue:u.withMessage("El valor minimo es 0%",j(0))},porcentaje_avance_estimacion_acumulado:{maxValue:u.withMessage("El valor maximo es 100%",y(100)),minValue:u.withMessage("El valor minimo es 0%",j(0))},porcentaje_Avance_fisico:{maxValue:u.withMessage("El valor maximo es 100%",y(100)),minValue:u.withMessage("El valor minimo es 0%",j(0))},porcensaje_avance_financiero:{maxValue:u.withMessage("El valor maximo es 100%",y(100)),minValue:u.withMessage("El valor minimo es 0%",j(0))},grado_avance_obra:{maxValue:u.withMessage("El valor maximo es 100%",y(100)),minValue:u.withMessage("El valor minimo es 0%",j(0))}})),_=G(g,s.residentEstimate);return s.editMode&&(console.log("props.residentEstimate: ",s.residentEstimate),console.log("props: ",s),t.residentEstimate=s.residentEstimate,t.estatus_semaforo=s,t.fecha_recepcion_info_contratista=e(s.residentEstimate.fecha_recepcion_info_contratista),s.residentEstimate.fecha_autorizacion_contratista===null?t.fecha_autorizacion_contratista=null:t.fecha_autorizacion_contratista=e(s.residentEstimate.fecha_autorizacion_contratista),t.fecha_periodo_inicio_estimacion=e(s.residentEstimate.fecha_periodo_inicio_estimacion),t.fecha_periodo_fin_estimacion=e(s.residentEstimate.fecha_periodo_fin_estimacion)),{app:t,editForm:()=>{var i=new Date().toLocaleTimeString("en-GB");console.log(i),t.residentEstimate.fecha_recepcion_info_contratista=t.fecha_recepcion_info_contratista+" "+i,t.fecha_autorizacion_contratista===null||t.fecha_autorizacion_contratista===""?delete t.residentEstimate.fecha_autorizacion_contratista:t.residentEstimate.fecha_autorizacion_contratista=t.fecha_autorizacion_contratista+" "+i,t.residentEstimate.fecha_periodo_inicio_estimacion=t.fecha_periodo_inicio_estimacion+" "+i,t.residentEstimate.fecha_periodo_fin_estimacion=t.fecha_periodo_fin_estimacion+" "+i,m.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async B=>{if(B.isConfirmed)try{const p=await _.value.$validate();console.log("validaciones:",p),console.log("v$:",_),p?(await S(t.residentEstimate),m.fire("¡Éxito!","Actualización con éxito!","success"),o.push({name:"ResidentEstimate"})):m.fire("Error","Revisa bien los datos","error")}catch(p){console.log("error: ",p.response.data.detail),m.fire("Error",`${p.response.data.detail}`,"error")}})},deleteForm:()=>{m.fire({title:"¿Confirma los cambios ?",icon:"question",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async E=>{if(E.isConfirmed)try{console.log("app.residentEstimate.observaciones_residente: ",t.residentEstimate.observaciones_residente),console.log("app.residentEstimate.id_estimacion: ",t.residentEstimate.id_estimacion),await N(t.residentEstimate,t.residentEstimate.id_estimacion),m.fire("¡Éxito!","Actualización con éxito!","success"),o.push({name:"ResidentEstimate"})}catch(i){console.log("error: ",i.response.data.detail),m.fire("Error",`${i.response.data.detail}`,"error")}})},sendReviewArea:()=>{var i=new Date().toLocaleTimeString("en-GB");t.fecha_autorizacion_contratista===null?delete t.residentEstimate.fecha_autorizacion_contratista:t.residentEstimate.fecha_autorizacion_contratista=t.fecha_autorizacion_contratista+" "+i,m.fire({title:"Se realizará el envio de la Estimación al área revisora",icon:"question",showCancelButton:!0,text:"¿Está usted seguro?",cancelButtonColor:"#d33",confirmButtonColor:"#3085d6",confirmButtonText:"Continuar",reverseButtons:!0}).then(async B=>{if(B.isConfirmed)try{await q(t.residentEstimate),m.fire("¡Éxito!","Estimación enviada al área revisora con éxito!","success"),o.push({name:"ResidentEstimate"})}catch(p){console.log("error: ",p.response.data.detail),m.fire("Error",`${p.response.data.detail}`,"error")}})},goToArchivos:()=>o.push({name:"FilesResidentEstimate",params:{residentEstimateId:t.residentEstimate.id_estimacion}}),formatFecha:e,v$:_}}},H={class:"flex flex-row justify-between"},J={class:"font-bold text-lg"},K={class:"font-bold text-lg w-128"},Q={class:"flex content-start justify-end items-center mb-10"},W={class:"items-center justify-center"},X=l("h1",{class:"font-bold text-lg text-center"}," Número de la Estimación ",-1),Y={class:"text-center font-semibold text-lg numEstimacion"},Z={class:"max-w-xl mx-auto"},$={class:"flex flex-row"},ee={class:"flex justify-between items-center py-4"};function ae(s,o,t,e,g,_){const v=x("button-base"),r=x("input-base"),w=x("text-area-base");return c(),d(h,null,[l("div",H,[l("div",J,f(e.app.residentEstimate.numero_contrato),1),l("div",K," Objeto: "+f(e.app.residentEstimate.objeto_contrato),1),l("div",Q,[l("div",W,[X,l("p",Y,f(e.app.residentEstimate.num_consecutivo_estimacion),1)])])]),n(v,{label:"Archivos",onClick:e.goToArchivos,class:"mb-3 mr-0 ml-auto"},null,8,["onClick"]),l("div",Z,[n(r,{id:"fecha_recepcion_info_contratista",label:"Fecha de recepción de información del Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_recepcion_info_contratista,"onUpdate:modelValue":o[0]||(o[0]=a=>e.app.fecha_recepcion_info_contratista=a)},null,8,["modelValue"]),n(r,{id:"fecha_autorizacion_contratista",label:"Fecha de autorización al Contratista",type:"date",class:"mb-3",modelValue:e.app.fecha_autorizacion_contratista,"onUpdate:modelValue":o[1]||(o[1]=a=>e.app.fecha_autorizacion_contratista=a),disabled:e.app.residentEstimate.fecha_autorizacion_contratista!==null},null,8,["modelValue","disabled"]),l("div",$,[l("div",null,[n(r,{id:"fecha_periodo_inicio_estimacion",label:"Período de la Estimación",type:"date",modelValue:e.app.fecha_periodo_inicio_estimacion,"onUpdate:modelValue":o[2]||(o[2]=a=>e.app.fecha_periodo_inicio_estimacion=a)},null,8,["modelValue"])]),l("div",null,[n(r,{id:"fecha_periodo_fin_estimacion",label:"al",type:"date",class:"pt-2",modelValue:e.app.fecha_periodo_fin_estimacion,"onUpdate:modelValue":o[3]||(o[3]=a=>e.app.fecha_periodo_fin_estimacion=a)},null,8,["modelValue"])])]),n(r,{id:"importe_obra_ejecutada",label:"Importe de la obra ejecutada",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_obra_ejecutada,"onUpdate:modelValue":o[4]||(o[4]=a=>e.app.residentEstimate.importe_obra_ejecutada=a)},null,8,["modelValue"]),n(r,{id:"importe_pagar",label:"Importe a pagar",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.importe_pagar,"onUpdate:modelValue":o[5]||(o[5]=a=>e.app.residentEstimate.importe_pagar=a)},null,8,["modelValue"]),n(r,{id:"grado_avance_obra",label:"% de grado de avance",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.grado_avance_obra,"onUpdate:modelValue":o[6]||(o[6]=a=>e.app.residentEstimate.grado_avance_obra=a)},null,8,["modelValue"]),e.v$.grado_avance_obra.$error?(c(!0),d(h,{key:0},V(e.v$.grado_avance_obra.$errors,a=>(c(),d("span",{key:a,class:"text-red font-semibold text-center ml-80"},f(a.$message),1))),128)):b("",!0),n(r,{id:"porcentaje_avance_estimacion",label:"% de avance de la Estimación",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion,"onUpdate:modelValue":o[7]||(o[7]=a=>e.app.residentEstimate.porcentaje_avance_estimacion=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion.$error?(c(!0),d(h,{key:1},V(e.v$.porcentaje_avance_estimacion.$errors,a=>(c(),d("span",{key:a,class:"text-red font-semibold text-center ml-80"},f(a.$message),1))),128)):b("",!0),n(r,{id:"porcentaje_avance_estimacion_acumulado",label:"% de avance de la Estimación acumulado",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_avance_estimacion_acumulado,"onUpdate:modelValue":o[8]||(o[8]=a=>e.app.residentEstimate.porcentaje_avance_estimacion_acumulado=a)},null,8,["modelValue"]),e.v$.porcentaje_avance_estimacion_acumulado.$error?(c(!0),d(h,{key:2},V(e.v$.porcentaje_avance_estimacion_acumulado.$errors,a=>(c(),d("span",{key:a,class:"text-red font-semibold text-center ml-80"},f(a.$message),1))),128)):b("",!0),n(r,{id:"porcentaje_Avance_fisico",label:"% de avance físico",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcentaje_Avance_fisico,"onUpdate:modelValue":o[9]||(o[9]=a=>e.app.residentEstimate.porcentaje_Avance_fisico=a)},null,8,["modelValue"]),e.v$.porcentaje_Avance_fisico.$error?(c(!0),d(h,{key:3},V(e.v$.porcentaje_Avance_fisico.$errors,a=>(c(),d("span",{key:a,class:"text-red font-semibold text-center ml-80"},f(a.$message),1))),128)):b("",!0),n(r,{id:"porcensaje_avance_financiero",label:"% de avance financiero",type:"number",class:"mb-3",modelValue:e.app.residentEstimate.porcensaje_avance_financiero,"onUpdate:modelValue":o[10]||(o[10]=a=>e.app.residentEstimate.porcensaje_avance_financiero=a)},null,8,["modelValue"]),e.v$.porcensaje_avance_financiero.$error?(c(!0),d(h,{key:4},V(e.v$.porcensaje_avance_financiero.$errors,a=>(c(),d("span",{key:a,class:"text-red font-semibold text-center ml-80"},f(a.$message),1))),128)):b("",!0),n(w,{id:"fecha_inicio_proyecto",label:"Observaciones del Residente",class:"mb-3",modelValue:e.app.residentEstimate.observaciones_residente,"onUpdate:modelValue":o[11]||(o[11]=a=>e.app.residentEstimate.observaciones_residente=a)},null,8,["modelValue"]),l("div",ee,[n(v,{label:"Actualizar Datos",class:"px-4",onClick:e.editForm},null,8,["onClick"]),n(v,{label:"Eliminar Estimacion",class:"px-4",onClick:e.deleteForm},null,8,["onClick"]),e.app.residentEstimate.estatus_semaforo==="Residente"?(c(),z(v,{key:0,label:"Enviar al area revisora",class:"px-4",onClick:e.sendReviewArea},null,8,["onClick"])):b("",!0)])])],64)}const te=C(P,[["render",ae]]),oe={name:"EditResident",components:{FormResidentEstimate:te,ArrowBack:U,TitleBar:I},setup(){const s=L(),o=k(),t=R({residentEstimate:{},loading:!0}),e=async()=>{t.loading=!0;const{data:_}=await D(s.params.residentEstimateId);console.log("data: ",_),t.residentEstimate=_,console.log("app.residentEstimate: ",t.residentEstimate),t.loading=!1},g=async _=>{await updateResident(_),m.fire("¡Éxito!","!Estimación residente actualizado con éxito!","success"),o.push({name:"Resident"})};return e(),{app:t,saveResident:g}}},ie={class:"px-4 mt-10"},ne={class:"px-4"};function se(s,o,t,e,g,_){const v=x("arrow-back"),r=x("title-bar"),w=x("form-resident-estimate");return c(),d("main",ie,[n(v),n(r,{title:"Semaforos Estimación Residente",subtitle:"Editar"}),l("section",ne,[e.app.loading?b("",!0):(c(),z(w,{key:0,residentEstimate:e.app.residentEstimate,editMode:""},null,8,["residentEstimate"]))])])}const ve=C(oe,[["render",se]]);export{ve as default};
