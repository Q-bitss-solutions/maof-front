import{F as Y}from"./FormResident-5180ee83.js";import{A as G}from"./ArrowBack-6ae4d345.js";import{T as J}from"./TitleBar-0fee8479.js";import{I as K}from"./InputBase-09aa8ac6.js";import{T as M}from"./TableBase-e0f00363.js";import{B as Q}from"./fetchApi-f8af7d53.js";import{L as W}from"./LogoutComponent-47cddd42.js";import{a as X,g as Z,h as $,i as ee}from"./residentEstimate-11392e02.js";import{_ as P,o as u,c as p,d as i,t as g,q as te,u as ae,a as ie,m as oe,r as o,b as m,e as s,g as ne,h as v}from"./index-77c78547.js";import{S as l}from"./sweetalert2.all-281a79b7.js";import{H as se}from"./HomePage-b55c9dba.js";import"./SelectBase-64c29a6c.js";import"./reviewArea-13f3c089.js";import"./users-34b49293.js";const re={name:"Banner",props:{title:{type:String,default:""}}},le={class:"relative isolate flex-1 items-center gap-x-6 overflow-hidden bg-gray-50 px-4 py-1.5 sm:px-2.5 sm:before:flex"},ce=i("div",{class:"absolute left-[max(-7rem,calc(50%-52rem))] top-1/2 -z-10 -translate-y-1/2 transform-gpu blur-2xl","aria-hidden":"true"},[i("div",{class:"aspect-[577/310] w-[36.0625rem] bg-gradient-to-r from-[#808080] to-[#808080] opacity-30",style:{"clip-path":"polygon(74.8% 41.9%, 97.2% 73.2%, 100% 34.9%, 92.5% 0.4%, 87.5% 0%, 75% 28.6%, 58.5% 54.6%, 50.1% 56.8%, 46.9% 44%, 48.3% 17.4%, 24.7% 53.9%, 0% 27.9%, 11.9% 74.2%, 24.9% 54.1%, 68.6% 100%, 74.8% 41.9%)"}})],-1),de=i("div",{class:"absolute left-[max(45rem,calc(50%+8rem))] top-1/2 -z-10 -translate-y-1/2 transform-gpu blur-2xl","aria-hidden":"true"},[i("div",{class:"aspect-[577/310] w-[36.0625rem] bg-gradient-to-r from-[#808080] to-[#808080] opacity-30",style:{"clip-path":"polygon(74.8% 41.9%, 97.2% 73.2%, 100% 34.9%, 92.5% 0.4%, 87.5% 0%, 75% 28.6%, 58.5% 54.6%, 50.1% 56.8%, 46.9% 44%, 48.3% 17.4%, 24.7% 53.9%, 0% 27.9%, 11.9% 74.2%, 24.9% 54.1%, 68.6% 100%, 74.8% 41.9%)"}})],-1),fe={class:"text-3xl text-center"};function me(F,_,b,e,a,B){return u(),p("div",le,[ce,de,i("div",null,[i("h2",fe,g(b.title),1)])])}const ue=P(re,[["render",me]]),pe={name:"FilesResidentEstimate",components:{FormResident:Y,ArrowBack:G,TitleBar:J,InputBase:K,TableBase:M,ButtonBase:Q,HomePage:se,Banner:ue,LogoutComponent:W},setup(){const F=te(),_=ae(),b=ie(),e=[{label:"Id",field:"id_archivo_estimacion"},{label:"Nombre archivo",field:"ruta_archivo_residente"},{label:"Descripción",field:"descripcion_archivo"}],a=oe({file:{id_estimacion:"",file:"",descripcionFile:""},data:{},filesById:[],loading:!0,filesResidente:[],filesAreaRevisora:[],filesFinanzas:[],filesTramite_Pago:[]}),B=o([]),R=o([]),y=o([]),x=o([]),w=o([]),{rol:r}=b.getAuthData,d=o([]),c=o(!1),E=o(!1),O=o(!1),z=o(!1),I=o([{label:"Descargar",action:async t=>{window.open(`${t.archivo_estimacion}`,"_blank")}}]),A=o([]),D=o([]),k=o([]),T=async()=>{a.loading=!0;const{data:t}=await X(F.params.residentEstimateId);a.data=t,a.file.id_estimacion=t.id_estimacion,h.append("id_estimacion",a.file.id_estimacion),d.value=q(a.data.estatus_semaforo),V(),U(a.data.estatus_estimacion),C(),a.loading=!1},C=async()=>{const{data:t}=await Z(a.file.id_estimacion);t.residente&&(R.value=t.residente),t.area_revisora&&(y.value=t.area_revisora),t.finanzas&&(x.value=t.finanzas),t.tramite_pago&&(w.value=t.tramite_pago)},j=async t=>{await updateResident(t),l.fire("¡Éxito!","Residente actualizado con éxito!","success"),_.push({name:"Resident"})};let h=new FormData;const S=async()=>{try{const{value:t}=await l.fire({title:"Subir Archivo",input:"file",showCancelButton:!0,reverseButtons:!0,inputAttributes:{accept:"application/pdf","aria-label":"Upload your profile picture"}});if(t!=null){const{value:n}=await l.fire({title:"Descripción del archivo",input:"text",showCancelButton:!0,reverseButtons:!0,inputValidator:f=>{if(!f)return"El campo es requerido"}});if(n!==void 0){a.file.descripcionFile=n,a.file.file=t,h.append("archivo_estimacion ",a.file.file),h.append("descripcion_archivo ",a.file.descripcionFile);try{await $(h),C(),l.fire("¡Éxito!","!Archivo guardado con éxito!","success"),a.file.file="",a.file.descripcionFile=""}catch(f){l.fire("Error",`${f.response.data.detail}`,"error")}}}else t===null&&l.fire("No selesccionaste ningun archivo","Agrega uno para continuar","warning")}catch{}},q=t=>{var n=!1;return t==="Residente"&&r==="Residente"&&(n=!0),t==="Area Revisora"&&(r.includes("Área revisora")||r.includes("Obras y Contratos"))&&(n=!0),(t==="Finanzas"||t==="Tramite de Pago")&&r.includes("Finanzas")&&(n=!0),n},V=()=>{c.value=!0,E.value=!0,O.value=!0,z.value=!0},U=t=>{const n=async N=>{window.open(`${N.archivo_estimacion}`,"_blank")},f=async N=>{l.fire({title:"¿Estás seguro que desea eliminar el documento?",text:"Esto quitará el documento",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Si, Eliminar!",reverseButtons:!0}).then(async H=>{if(H.isConfirmed)try{await ee(N.id_archivo_estimacion),await C(),l.fire("Eliminado!","El documento se eliminó","success")}catch(L){l.fire("Error",`${L.response.data.detail}`,"error")}})};t==="Pagada"?(c.value=!0,E.value=!0,O.value=!0,z.value=!0,I.value=[{label:"Descargar",action:n}]):(r.includes("Residente")&&(t==="Capturada por Residente"||t==="Autorizada por Residente"||t==="Regresada al Residente")?A.value=[{label:"Descargar",action:n},{label:"Eliminar",action:f}]:A.value=[],(r.includes("Obras y Contratos")||r.includes("Área revisora"))&&(t==="En validación del área revisora"||t==="Regresada al área revisora")?D.value=[{label:"Descargar",action:n},{label:"Eliminar",action:f}]:D.value=[],r.includes("Finanzas")&&(t==="En validación de Finanzas"||t==="Regresada a Finanzas"||t==="En trámite de pago")?k.value=[{label:"Descargar",action:n},{label:"Eliminar",action:f}]:k.value=[])};return T(),{app:a,filesById:B,featureOptions:I,featureOptionsResidente:A,featureOptionsAreaRevisora:D,featureOptionsFianzas:k,formData:h,headers:e,filesResidente:R,filesAreaRevisora:y,filesTramite_Pago:w,filesFinanzas:x,canAddNew:d,canEditResidente:c,canEditAreaRevisora:E,canEditFinanzas:O,canEditPago:z,rol:r,saveResident:j,fileUpload:S}}},_e={class:"px-4 mt-10"},he={class:"flex justify-between"},ve={class:"flex justify-center items-center"},ge={class:"text-black font-semibold mr-4 items-center content-center"},be={class:"px-4"},Re={class:"flex flex-row justify-between"},ye={class:"font-bold text-lg"},xe={class:"font-bold text-lg w-128 text-center"},we={class:"flex content-start justify-end items-center mb-10"},Ee={class:"items-center justify-center"},Fe=i("h1",{class:"font-bold text-lg text-center"}," Número de la Estimación ",-1),Be={class:"text-center font-semibold text-lg numEstimacion"},Oe={key:1,class:"flex flex-col py-px"},ze={key:2},Ae={key:3},De={key:4};function ke(F,_,b,e,a,B){const R=m("arrow-back"),y=m("home-page"),x=m("logout-component"),w=m("title-bar"),r=m("button-base"),d=m("banner"),c=m("table-base");return u(),p("main",_e,[i("div",he,[s(R),i("div",ve,[i("p",ge,g(e.rol),1),s(y),s(x)])]),s(w,{title:"Estimación Residente",subtitle:"Archivos"}),i("section",be,[i("div",Re,[i("div",ye,g(e.app.data.numero_contrato),1),i("div",xe," Objeto: "+g(e.app.data.objeto_contrato),1),i("div",we,[i("div",Ee,[Fe,i("p",Be,g(e.app.data.num_consecutivo_estimacion),1)])])]),e.canAddNew?(u(),ne(r,{key:0,label:"Nuevo",onClick:_[0]||(_[0]=E=>e.fileUpload()),class:"mr-0 ml-auto mb-5"})):v("",!0),e.filesResidente.length?(u(),p("div",Oe,[s(d,{title:"Documentos de Residente"}),s(c,{description:"Residente",options:e.featureOptionsResidente.length!==0?e.featureOptionsResidente:e.featureOptions,headers:e.headers,data:e.filesResidente,showOptions:e.canEditResidente,tableName:"residente"},null,8,["options","headers","data","showOptions"])])):v("",!0),e.filesAreaRevisora.length?(u(),p("div",ze,[s(d,{title:"Documentos de Área Revisora"}),s(c,{description:"Área Revisora",options:e.featureOptionsAreaRevisora.length!==0?e.featureOptionsAreaRevisora:e.featureOptions,headers:e.headers,data:e.filesAreaRevisora,showOptions:e.canEditAreaRevisora,tableName:"area-revisora"},null,8,["options","headers","data","showOptions"])])):v("",!0),e.filesFinanzas.length?(u(),p("div",Ae,[s(d,{title:"Documentos de Finanzas"}),s(c,{description:"Finanzas",options:e.featureOptionsFianzas.length!==0?e.featureOptionsFianzas:e.featureOptions,headers:e.headers,data:e.filesFinanzas,showOptions:e.canEditFinanzas,tableName:"finanzas"},null,8,["options","headers","data","showOptions"])])):v("",!0),e.filesTramite_Pago.length?(u(),p("div",De,[s(d,{title:"Documentos de Tramite de Pago"}),s(c,{description:"Registro de Pago",options:e.featureOptionsFianzas.length!==0?e.featureOptionsFianzas:e.featureOptions,headers:e.headers,data:e.filesTramite_Pago,showOptions:e.canEditPago,tableName:"pago"},null,8,["options","headers","data","showOptions"])])):v("",!0)])])}const Je=P(pe,[["render",ke]]);export{Je as default};
